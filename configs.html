<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConfiguraÃ§Ãµes - Micro Front-End Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            color: #333333;
            height: 100vh;
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-mode {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        .config-container {
            width: 100%;
            height: 100vh;
            position: relative;
            padding: 40px;
            background: inherit;
        }

        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        body.dark-mode .config-header {
            border-bottom-color: #444444;
        }

        .config-title {
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-btn {
            background: #ff4757;
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #ff3742;
        }

        .config-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body.dark-mode .config-section {
            background: #2d2d2d;
            border-color: #444444;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
        }

        .config-label {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 500;
        }

        .config-description {
            font-size: 14px;
            color: #666666;
            margin-top: 4px;
        }

        body.dark-mode .config-description {
            color: #bbbbbb;
        }

        /* Toggle Switch Styles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .version-info {
            position: absolute;
            bottom: 20px;
            left: 40px;
            font-size: 12px;
            color: #888888;
        }

        body.dark-mode .version-info {
            color: #bbbbbb;
        }

        /* Estilos para ordenaÃ§Ã£o de MFEs */
        .order-button {
            background: #007bff;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .order-button:hover {
            background: #0056b3;
        }

        .order-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: none;
            width: 80%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
            transition: background-color 0.3s ease;
        }

        body.dark-mode .modal-content {
            background-color: #2d2d2d;
            color: #ffffff;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        body.dark-mode .modal-header {
            border-bottom-color: #444444;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin: 0;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .close-modal:hover {
            background: #f0f0f0;
            color: #333;
        }

        body.dark-mode .close-modal:hover {
            background: #444;
            color: #fff;
        }

        .order-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .order-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body.dark-mode .order-item {
            background: #3a3a3a;
            border-color: #555;
        }

        .order-item:hover {
            background: #e9ecef;
        }

        body.dark-mode .order-item:hover {
            background: #444;
        }

        .project-name {
            font-weight: 500;
            font-size: 16px;
        }

        .order-controls {
            display: flex;
            gap: 8px;
        }

        .move-btn {
            background: #6c757d;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            outline: none;
        }

        .move-btn:hover {
            background: #545b62;
            transform: scale(1.1);
        }

        .move-btn:focus {
            background: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.3);
            transform: scale(1.1);
        }

        .move-btn:active {
            background: #0056b3;
            transform: scale(0.95);
        }

        .move-btn:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            transform: none;
        }

        .move-btn:disabled:hover,
        .move-btn:disabled:focus {
            background: #adb5bd;
            transform: none;
            box-shadow: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="config-container">
        <div class="config-header">
            <h1 class="config-title">ðŸ”§ ConfiguraÃ§Ãµes</h1>
            <button class="close-btn" onclick="closeConfig()">&times;</button>
        </div>

        <div class="config-section">
            <div class="config-item">
                <div>
                    <div class="config-label">ðŸŒƒ Modo Escuro</div>
                    <div class="config-description">Altera a aparÃªncia do aplicativo para cores escuras</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="config-section">
            <div class="config-item">
                <div>
                    <div class="config-label">ðŸ“‹ Ordem dos MFEs PAS</div>
                    <div class="config-description">Configure a ordem de exibiÃ§Ã£o dos projetos PAS (mp-pas-*)</div>
                </div>
                <button class="order-button" onclick="openOrderModal('pas')">Configurar Ordem</button>
            </div>
        </div>

        <div class="config-section">
            <div class="config-item">
                <div>
                    <div class="config-label">ðŸ“‹ Ordem dos MFEs PAMP</div>
                    <div class="config-description">Configure a ordem de exibiÃ§Ã£o dos projetos PAMP (mp-pamp-*)</div>
                </div>
                <button class="order-button" onclick="openOrderModal('pamp')">Configurar Ordem</button>
            </div>
        </div>

        <div class="version-info">
            Micro Front-End Manager v0.0.7
        </div>
    </div>

    <!-- Modal para configuraÃ§Ã£o de ordem -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle" class="modal-title">Configurar Ordem dos MFEs</h2>
                <button class="close-modal" onclick="closeOrderModal()">&times;</button>
            </div>
            <div id="modalBody">
                <p>Use os botÃµes â–² e â–¼ para reorganizar a ordem dos projetos:</p>
                <ul id="orderList" class="order-list">
                    <!-- Lista serÃ¡ preenchida dinamicamente -->
                </ul>
                <p style="margin-top: 20px; font-size: 14px; color: #666; text-align: center;">
                    ðŸ’¡ As alteraÃ§Ãµes sÃ£o salvas automaticamente quando vocÃª move os projetos
                </p>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        let currentProjects = [];
        let currentOrderType = '';
        let currentOrder = [];

        // Carrega as configuraÃ§Ãµes ao iniciar a pÃ¡gina
        document.addEventListener('DOMContentLoaded', () => {
            loadConfigs();
            loadProjects();
        });

        // FunÃ§Ã£o para carregar as configuraÃ§Ãµes
        function loadConfigs() {
            ipcRenderer.send('load-configs');
        }

        // FunÃ§Ã£o para carregar os projetos
        function loadProjects() {
            ipcRenderer.send('load-projects');
        }

        // Recebe as configuraÃ§Ãµes do processo principal
        ipcRenderer.on('configs-loaded', (event, configs) => {
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            // Aplica o modo escuro se estiver habilitado
            if (configs.darkMode) {
                darkModeToggle.checked = true;
                document.body.classList.add('dark-mode');
            }
        });

        // Recebe os projetos do processo principal
        ipcRenderer.on('projects-loaded', (event, projects) => {
            currentProjects = projects;
        });

        // FunÃ§Ã£o para alternar o modo escuro
        function toggleDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const isDarkMode = darkModeToggle.checked;
            
            // Aplica/remove a classe dark-mode
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            
            // Salva a configuraÃ§Ã£o
            ipcRenderer.send('save-config', { key: 'darkMode', value: isDarkMode });
            
            // Envia para a janela principal aplicar o modo escuro tambÃ©m
            ipcRenderer.send('apply-dark-mode', isDarkMode);
        }

        // FunÃ§Ã£o para abrir modal de ordenaÃ§Ã£o
        function openOrderModal(type) {
            currentOrderType = type;
            const modal = document.getElementById('orderModal');
            const modalTitle = document.getElementById('modalTitle');
            
            if (type === 'pas') {
                modalTitle.textContent = 'Configurar Ordem dos MFEs PAS';
                loadPasProjects();
            } else {
                modalTitle.textContent = 'Configurar Ordem dos MFEs PAMP';
                loadPampProjects();
            }
            
            modal.style.display = 'block';
            
            // Fecha modal ao clicar fora dele
            modal.onclick = function(event) {
                if (event.target === modal) {
                    closeOrderModal();
                }
            };
        }

        // FunÃ§Ã£o para fechar modal
        function closeOrderModal() {
            const modal = document.getElementById('orderModal');
            modal.style.display = 'none';
            currentOrderType = '';
            currentOrder = [];
        }

        // Carrega projetos PAS
        function loadPasProjects() {
            const pasProjects = currentProjects.filter(p => p.name && !p.name.startsWith('mp-pamp'));
            
            ipcRenderer.send('get-project-order', 'pas');
            
            // Listener temporÃ¡rio para receber a ordem
            ipcRenderer.once('project-order-loaded', (event, { type, order }) => {
                if (type === 'pas') {
                    displayProjectOrder(pasProjects, order);
                }
            });
        }

        // Carrega projetos PAMP
        function loadPampProjects() {
            const pampProjects = currentProjects.filter(p => p.name && p.name.startsWith('mp-pamp'));
            
            ipcRenderer.send('get-project-order', 'pamp');
            
            // Listener temporÃ¡rio para receber a ordem
            ipcRenderer.once('project-order-loaded', (event, { type, order }) => {
                if (type === 'pamp') {
                    displayProjectOrder(pampProjects, order);
                }
            });
        }

        // Exibe a ordem dos projetos no modal
        function displayProjectOrder(projects, savedOrder) {
            const orderList = document.getElementById('orderList');
            orderList.innerHTML = '';
            
            // Ordena projetos baseado na ordem salva ou ordem padrÃ£o
            let orderedProjects = [...projects];
            if (savedOrder && savedOrder.length > 0) {
                orderedProjects = [];
                // Primeiro, adiciona projetos na ordem salva
                savedOrder.forEach(projectName => {
                    const project = projects.find(p => p.name === projectName);
                    if (project) {
                        orderedProjects.push(project);
                    }
                });
                // Depois, adiciona projetos que nÃ£o estÃ£o na ordem salva
                projects.forEach(project => {
                    if (!savedOrder.includes(project.name)) {
                        orderedProjects.push(project);
                    }
                });
            }
            
            currentOrder = orderedProjects.map(p => p.name);
            
            orderedProjects.forEach((project, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'order-item';
                listItem.innerHTML = `
                    <span class="project-name">${project.name}</span>
                    <div class="order-controls">
                        <button class="move-btn" onclick="moveProject(${index}, 'up')" ${index === 0 ? 'disabled' : ''}>â–²</button>
                        <button class="move-btn" onclick="moveProject(${index}, 'down')" ${index === orderedProjects.length - 1 ? 'disabled' : ''}>â–¼</button>
                    </div>
                `;
                orderList.appendChild(listItem);
            });
        }

        // Move projeto para cima ou para baixo
        function moveProject(index, direction) {
            let newIndex = index;
            let projectName = currentOrder[index];
            
            if (direction === 'up' && index > 0) {
                // Troca com o item acima
                [currentOrder[index], currentOrder[index - 1]] = [currentOrder[index - 1], currentOrder[index]];
                newIndex = index - 1;
            } else if (direction === 'down' && index < currentOrder.length - 1) {
                // Troca com o item abaixo
                [currentOrder[index], currentOrder[index + 1]] = [currentOrder[index + 1], currentOrder[index]];
                newIndex = index + 1;
            }
            
            // Salva automaticamente apÃ³s o movimento
            saveOrderAutomatically();
            
            // Recarrega a exibiÃ§Ã£o
            const projects = currentProjects.filter(p => {
                if (currentOrderType === 'pas') {
                    return p.name && !p.name.startsWith('mp-pamp');
                } else {
                    return p.name && p.name.startsWith('mp-pamp');
                }
            });
            
            displayProjectOrder(projects, currentOrder);
            
            // ApÃ³s recarregar, foca no projeto que foi movido
            setTimeout(() => {
                focusOnMovedProject(projectName, direction);
            }, 50);
        }

        // Foca no projeto que foi movido para manter o cursor na posiÃ§Ã£o correta
        function focusOnMovedProject(projectName, direction) {
            const orderList = document.getElementById('orderList');
            const items = orderList.getElementsByClassName('order-item');
            
            // Encontra o item que foi movido pela nova posiÃ§Ã£o
            for (let i = 0; i < items.length; i++) {
                const nameElement = items[i].querySelector('.project-name');
                if (nameElement && nameElement.textContent === projectName) {
                    // Encontra o botÃ£o correto (up ou down) dentro deste item
                    const buttons = items[i].querySelectorAll('.move-btn');
                    let targetButton = null;
                    
                    if (direction === 'up') {
                        // Se moveu para cima, foca no botÃ£o "â–²" da nova posiÃ§Ã£o
                        targetButton = Array.from(buttons).find(btn => btn.textContent === 'â–²' && !btn.disabled);
                    } else if (direction === 'down') {
                        // Se moveu para baixo, foca no botÃ£o "â–¼" da nova posiÃ§Ã£o
                        targetButton = Array.from(buttons).find(btn => btn.textContent === 'â–¼' && !btn.disabled);
                    }
                    
                    // Aplica o foco e um destaque visual
                    if (targetButton) {
                        targetButton.focus();
                        
                        // Adiciona um destaque visual temporÃ¡rio
                        const item = items[i];
                        const isDarkMode = document.body.classList.contains('dark-mode');
                        
                        // Cores diferentes para modo claro e escuro
                        const highlightColor = isDarkMode ? '#264653' : '#e3f2fd';
                        
                        item.style.backgroundColor = highlightColor;
                        item.style.transform = 'scale(1.02)';
                        item.style.transition = 'all 0.3s ease';
                        item.style.boxShadow = isDarkMode ? '0 0 10px rgba(33, 150, 243, 0.3)' : '0 0 10px rgba(0, 123, 255, 0.2)';
                        
                        // Remove o destaque apÃ³s um tempo
                        setTimeout(() => {
                            item.style.backgroundColor = '';
                            item.style.transform = '';
                            item.style.boxShadow = '';
                            setTimeout(() => {
                                item.style.transition = '';
                            }, 300);
                        }, 800);
                    }
                    break;
                }
            }
        }

        // Salva a ordem automaticamente (nova funÃ§Ã£o)
        function saveOrderAutomatically() {
            if (currentOrder.length === 0) {
                console.log('Nenhuma ordem para salvar automaticamente');
                return;
            }
            
            console.log(`ðŸ”„ Salvamento automÃ¡tico: ${currentOrderType.toUpperCase()}`, currentOrder);
            
            ipcRenderer.send('save-project-order', {
                type: currentOrderType,
                order: currentOrder
            });
            
            // Listener temporÃ¡rio para confirmar salvamento automÃ¡tico
            ipcRenderer.once('project-order-saved', (event, { success, type }) => {
                if (success) {
                    console.log(`âœ… Ordem dos projetos ${type.toUpperCase()} salva automaticamente!`);
                    // Mostra uma pequena notificaÃ§Ã£o visual sem interromper o usuÃ¡rio
                    showAutoSaveNotification();
                } else {
                    console.error('âŒ Erro no salvamento automÃ¡tico');
                }
            });
        }

        // Mostra notificaÃ§Ã£o sutil de salvamento automÃ¡tico
        function showAutoSaveNotification() {
            const modalTitle = document.getElementById('modalTitle');
            const originalText = modalTitle.textContent;
            
            // Mostra "Salvo âœ“" brevemente
            modalTitle.textContent = originalText + ' - Salvo âœ“';
            modalTitle.style.color = '#28a745';
            
            // Volta ao normal apÃ³s 1.5 segundos
            setTimeout(() => {
                modalTitle.textContent = originalText;
                modalTitle.style.color = '';
            }, 1500);
        }

        // FunÃ§Ã£o para fechar a janela de configuraÃ§Ãµes
        function closeConfig() {
            console.log('Fechando janela de configuraÃ§Ãµes...');
            try {
                ipcRenderer.send('close-config-window');
            } catch (error) {
                console.error('Erro ao fechar janela:', error);
                // Fallback: tentar fechar via window
                if (window.close) {
                    window.close();
                }
            }
        }

        // TambÃ©m permite fechar com a tecla ESC e navegaÃ§Ã£o por teclado
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const modal = document.getElementById('orderModal');
                if (modal.style.display === 'block') {
                    closeOrderModal();
                } else {
                    closeConfig();
                }
            }
            
            // NavegaÃ§Ã£o por teclado no modal de ordenaÃ§Ã£o
            const modal = document.getElementById('orderModal');
            if (modal.style.display === 'block') {
                const focusedElement = document.activeElement;
                
                // Se estÃ¡ focado em um botÃ£o de movimento
                if (focusedElement && focusedElement.classList.contains('move-btn')) {
                    const orderList = document.getElementById('orderList');
                    const items = Array.from(orderList.getElementsByClassName('order-item'));
                    const currentItem = focusedElement.closest('.order-item');
                    const currentIndex = items.indexOf(currentItem);
                    
                    if (event.key === 'ArrowUp' && currentIndex > 0) {
                        // Move o foco para o item acima
                        event.preventDefault();
                        const prevItem = items[currentIndex - 1];
                        const upButton = prevItem.querySelector('.move-btn[onclick*="up"]');
                        if (upButton && !upButton.disabled) {
                            upButton.focus();
                        }
                    } else if (event.key === 'ArrowDown' && currentIndex < items.length - 1) {
                        // Move o foco para o item abaixo
                        event.preventDefault();
                        const nextItem = items[currentIndex + 1];
                        const downButton = nextItem.querySelector('.move-btn[onclick*="down"]');
                        if (downButton && !downButton.disabled) {
                            downButton.focus();
                        }
                    } else if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                        // Alterna entre botÃµes â–² e â–¼ do mesmo item
                        event.preventDefault();
                        const buttons = currentItem.querySelectorAll('.move-btn:not(:disabled)');
                        const currentButtonIndex = Array.from(buttons).indexOf(focusedElement);
                        const nextButtonIndex = currentButtonIndex === 0 ? 1 : 0;
                        if (buttons[nextButtonIndex]) {
                            buttons[nextButtonIndex].focus();
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
