<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Fira Code', monospace;
      background-color: #121212;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      overflow: hidden;
    }

    #close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: #fff;
      font-size: 18px;
      cursor: pointer;
    }

    #close:hover {
      color: #ff4d4d;
    }

    pre {
      background: #000;
      color: #0f0;
      padding: 10px;
      width: 95%;
      height: 85%;
      overflow-y: auto;
      border-radius: 5px;
      margin-top: 40px;
      font-family: monospace;
    }

    pre:focus {
      outline: none;
    }
  </style>
</head>
<body>
  <button id="close">[x]</button>
  <pre id="terminal"></pre>
  <script>
    const { ipcRenderer } = require('electron');
    const terminal = document.getElementById('terminal');

    // Adiciona mensagem inicial
    function addLog(message) {
      const timestamp = new Date().toLocaleTimeString();
      terminal.innerText += `[${timestamp}] ${message}\n`;
      terminal.scrollTop = terminal.scrollHeight;
    }

    // Adiciona mensagem inicial
    addLog('ðŸ” Iniciando verificaÃ§Ã£o de status do Nexus...');

    // Escuta logs de verificaÃ§Ã£o
    ipcRenderer.on('verify-status-log', (event, { message, type }) => {
      addLog(message);
    });

    // Escuta resultado da verificaÃ§Ã£o
    ipcRenderer.on('verify-status-result', (event, { isLoggedIn, username, registry, reason }) => {
      addLog('');
      addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
      
      if (isLoggedIn) {
        addLog('ðŸŽ‰ RESULTADO: VOCÃŠ ESTÃ CONECTADO AO NEXUS! âœ…');
        addLog('');
        addLog(`ðŸ‘¤ UsuÃ¡rio logado: ${username}`);
        addLog(`ðŸŒ Registry: ${registry}`);
        addLog('');
        addLog('âœ… Tudo funcionando! VocÃª pode usar os repositÃ³rios privados.');
      } else {
        addLog('âŒ RESULTADO: VOCÃŠ NÃƒO ESTÃ CONECTADO AO NEXUS');
        addLog('');
        
        switch (reason) {
          case 'no-projects':
            addLog('ðŸ“ Motivo: Nenhum projeto configurado com arquivo .npmrc');
            addLog('ðŸ’¡ SoluÃ§Ã£o: Configure pelo menos um projeto para verificar o login.');
            break;
          case 'ping-success-no-auth':
            addLog('ðŸŒ Motivo: Servidor acessÃ­vel, mas vocÃª nÃ£o estÃ¡ autenticado');
            addLog(`ðŸ“ Registry: ${registry}`);
            addLog('ðŸ’¡ SoluÃ§Ã£o: FaÃ§a login usando "DependÃªncias â†’ Login npm"');
            break;
          case 'both-failed':
            addLog('ðŸ”Œ Motivo: Falha na comunicaÃ§Ã£o com o servidor');
            addLog(`ðŸ“ Registry: ${registry}`);
            addLog('ðŸ’¡ SoluÃ§Ã£o: Verifique sua conexÃ£o de rede');
            break;
          case 'error':
            addLog('ðŸ’¥ Motivo: Erro tÃ©cnico durante a verificaÃ§Ã£o');
            addLog('ðŸ’¡ SoluÃ§Ã£o: Tente novamente ou verifique os logs');
            break;
        }
      }
      
      addLog('');
      addLog('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
      addLog('âœ… VerificaÃ§Ã£o concluÃ­da. VocÃª pode fechar esta janela.');
    });

    // BotÃ£o fechar
    document.getElementById('close').addEventListener('click', () => {
      ipcRenderer.send('close-verify-status-window');
    });

    // Permite fechar com ESC
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        ipcRenderer.send('close-verify-status-window');
      }
    });

    // Inicia a verificaÃ§Ã£o automaticamente
    setTimeout(() => {
      ipcRenderer.send('start-nexus-verification');
    }, 500);
  </script>
</body>
</html>
