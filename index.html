<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Micro Front-End Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    /* Aplica a fonte Fira Code em todo o app */
    body {
      font-family: 'Fira Code', monospace;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
      color: #333;
      max-width: 1200px;
      margin: 0 auto;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Modo Escuro */
    body.dark-mode {
      background-color: #1e1e1e;
      color: #ffffff;
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      margin-bottom: 20px;
    }

     h1 {
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
      transition: border-color 0.3s ease;
    }

    body.dark-mode h1 {
      border-bottom-color: #555;
    }

    input, button {
      font-family: 'Fira Code', monospace;
    }

    button {
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #e0e0e0;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Container para os controles principais */
    .main-controls {
      margin-bottom: 20px;
    }

    /* Estilos para MFEs containers */
    #pamp-mfes, #projects {
      margin-top: 15px;
    }

    /* Estilos para os cards de projeto */
    .project-card {
      position: relative;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 5px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    body.dark-mode .project-card {
      background-color: #2d2d2d;
      border-color: #555;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* Status indicators - Nova vers√£o com layout flex√≠vel */
    .status-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 500;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-badge.logged-in {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
    }

    .status-badge.logged-out {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    .status-badge.unknown {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    .status-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .status-badge .status-icon {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Badges de Vers√£o (Node.js e Angular) */
    .version-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: bold;
      border-radius: 12px;
      transition: all 0.2s ease;
      cursor: help;
    }

    .version-badge.node {
      background: #68a063;
      color: white;
    }

    .version-badge.angular {
      background: #dd0031;
      color: white;
    }

    .version-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0.9;
    }

    .version-badge img {
      width: 12px;
      height: 12px;
      object-fit: contain;
    }

    .version-badge .version-text {
      font-weight: bold;
    }

    /* Bot√£o de toggle para mostrar/esconder badges */
    .toggle-versions-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 4px;
      color: #ffffff;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .toggle-versions-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .toggle-versions-btn:active {
      transform: scale(0.95);
    }

    /* Badges escondidos por padr√£o */
    .version-badges-container {
      display: none;
      gap: 8px;
    }

    .version-badges-container.visible {
      display: inline-flex;
    }

    /* Remover estilos antigos */
    #pinter-status, #status {
      display: none !important;
    }

    /* ===== SISTEMA DE ABAS (TABS) ===== */
    .toggle-buttons-container {
      display: flex;
      gap: 0;
      margin-bottom: 0;
      border-bottom: 2px solid #ddd;
    }

    body.dark-mode .toggle-buttons-container {
      border-bottom-color: #444;
    }

    .toggle-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      border-radius: 0;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .toggle-btn .toggle-text {
      font-weight: 500;
    }

    .toggle-btn .toggle-count {
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 4px;
    }

    /* ==== TEMA CLARO (Light Mode) ==== */
    body:not(.dark-mode) .toggle-btn {
      color: #666;
    }

    body:not(.dark-mode) .toggle-btn:hover {
      color: #000;
      background-color: rgba(0, 0, 0, 0.02);
    }

    body:not(.dark-mode) .toggle-btn.expanded {
      color: #000;
      border-bottom-color: #000;
      font-weight: 600;
    }

    body:not(.dark-mode) .toggle-btn .toggle-count {
      background: #e0e0e0;
      color: #666;
    }

    body:not(.dark-mode) .toggle-btn.expanded .toggle-count {
      background: #000;
      color: #fff;
    }

    /* ==== TEMA ESCURO (Dark Mode) ==== */
    body.dark-mode .toggle-btn {
      color: #999;
    }

    body.dark-mode .toggle-btn:hover {
      color: #fff;
      background-color: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .toggle-btn.expanded {
      color: #fff;
      border-bottom-color: #fff;
      font-weight: 600;
    }

    body.dark-mode .toggle-btn .toggle-count {
      background: #444;
      color: #999;
    }

    body.dark-mode .toggle-btn.expanded .toggle-count {
      background: #fff;
      color: #000;
    }

    /* Conte√∫do das abas */
    #pamp-mfes, #projects {
      padding: 20px 0;
      min-height: 200px;
    }

    /* Version info */
    .version-info {
      margin-top: 10px;
      margin-bottom: 20px;
    }

    /* Input com √≠cone de pasta */
    .input-with-folder {
      position: relative;
      display: block;
      width: 100%;
      box-sizing: border-box;
    }

    .folder-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      cursor: pointer;
      z-index: 10;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .folder-icon:hover {
      opacity: 1;
    }

    .folder-icon:disabled,
    .folder-icon.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Ajusta o padding do input para dar espa√ßo ao √≠cone */
    .input-with-folder input {
      width: 100% !important;
      box-sizing: border-box !important;
      padding-right: 35px !important;
      padding-left: 8px !important;
      padding-top: 6px !important;
      padding-bottom: 6px !important;
      background-color: #ffffff;
      border: 1px solid #ccc;
      color: #333;
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    /* Estilos para inputs no modo escuro */
    body.dark-mode input {
      background-color: #3a3a3a;
      border-color: #555;
      color: #ffffff;
    }

    body.dark-mode input::placeholder {
      color: #aaa;
    }

    /* Console logs no modo escuro */
    body.dark-mode div[id*="log-"] {
      background: #000 !important;
      color: #0f0 !important;
    }

    /* Estilos para exibi√ß√£o de porta */
    span[id*="port-"], span[id*="pamp-port-"] {
      display: inline-block;
      padding: 8px 12px; /* Mesmo padding dos bot√µes */
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      white-space: nowrap;
      transition: all 0.3s ease;
      user-select: none;
      height: auto; /* Altura autom√°tica para coincidir com bot√µes */
      line-height: 1.2; /* Line height consistente */
      vertical-align: middle; /* Alinhamento vertical */
      box-sizing: border-box; /* Include padding in height calculation */
      min-height: 32px; /* Altura m√≠nima igual aos bot√µes */
      display: inline-flex; /* Flexbox para melhor alinhamento */
      align-items: center; /* Centralizar verticalmente o texto */
      justify-content: center; /* Centralizar horizontalmente o texto */
    }

    /* Port status colors */
    .port-starting {
      background-color: #ff8c00 !important;
      color: white !important;
      cursor: default !important;
    }

    .port-in-use {
      background-color: #dc3545 !important;
      color: white !important;
      cursor: default !important;
    }

    .port-running {
      background-color: #28a745 !important;
      color: white !important;
      cursor: pointer !important;
    }

    .port-running:hover {
      background-color: #218838 !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Help icon styles */
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: #007acc;
      color: white;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      margin-left: 5px;
      transition: all 0.3s ease;
      position: relative;
      vertical-align: middle;
    }

    .help-icon:hover {
      background-color: #005a9e;
      transform: scale(1.1);
    }

    /* Editor icon styles */
    .editor-icon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      opacity: 0.8;
      transition: all 0.3s ease;
      margin-right: 5px;
    }

    .editor-icon:hover {
      opacity: 1;
      transform: scale(1.05);
    }

    .editor-icon.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    body.dark-mode .help-icon {
      background-color: #4CAF50;
    }

    body.dark-mode .help-icon:hover {
      background-color: #45a049;
    }

    /* Tooltip styles */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 380px;
      background-color: #2c2c2c;
      color: #fff;
      text-align: left;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      font-size: 13px;
      line-height: 1.5;
      box-shadow: 0 8px 16px rgba(0,0,0,0.4);
      border: 1px solid #555;
      max-height: 400px;
      overflow-y: auto;
    }

    /* Tooltip fica vis√≠vel quando hover no container pai OU no pr√≥prio tooltip */
    .tooltip:hover .tooltiptext,
    .tooltiptext:hover {
      visibility: visible;
      opacity: 1;
    }

    /* Estilo especial para manter tooltip vis√≠vel */
    .tooltip .tooltiptext.show {
      visibility: visible;
      opacity: 1;
    }

    /* Remove a seta por enquanto para simplificar */
    .tooltip .tooltiptext::after {
      display: none;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    body.dark-mode .tooltip .tooltiptext {
      background-color: #333;
      border: 1px solid #555;
    }

    body.dark-mode .tooltip .tooltiptext::after {
      border-color: #333 transparent transparent transparent;
    }

    .tooltip-link {
      color: #4CAF50;
      text-decoration: underline;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .tooltip-link:hover {
      color: #45a049;
    }

    .tooltip-link.disabled {
      color: #888;
      cursor: not-allowed;
      opacity: 0.5;
      pointer-events: none;
    }

    /* Dark mode compatibility for port display */
    body.dark-mode .port-starting,
    body.dark-mode .port-in-use,
    body.dark-mode .port-running {
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>
  <h1>
    Micro Front-Ends 
    <span id="dependencies-status" style="font-size: 12px; margin-left: 10px;"></span>
    <span style="font-size: 10px; margin-left: 20px; color: #666; font-style: italic;" title="Atalhos para reiniciar">
      üí° Ctrl+R ou F5 = Reiniciar
    </span>
  </h1>

  <!-- Nova se√ß√£o de status com layout melhorado -->
  <div class="status-container">
    <div id="nexus-status-badge" class="status-badge unknown" title="Status do login no Nexus">
      <span class="status-icon"></span>
      <span class="status-text">Verificando Nexus...</span>
    </div>
  </div>

  <!-- Elementos antigos mantidos para compatibilidade (ocultos) -->
  <div id="pinter-status"></div>
  <div id="status" title="N√£o logado"></div>
  
  <div class="main-controls">
    <!-- Bot√µes Toggle Modernos para MFEs -->
    <div class="toggle-buttons-container">
      <button id="toggle-mfes" class="toggle-btn pas-btn">
        <span class="toggle-text">PAS</span>
        <span class="toggle-count" id="pas-count">0</span>
      </button>
      <button id="toggle-pamp-mfes" class="toggle-btn pamp-btn">
        <span class="toggle-text">PAMP</span>
        <span class="toggle-count" id="pamp-count">0</span>
      </button>
    </div>
  </div>
  
  <div id="pamp-mfes" style="display: none;"></div>
  <div id="projects" style="display: none;"></div>
  
  <script>
  const { ipcRenderer } = require('electron');
  const path = require('path');
  
  // Store projects globally for reference
  let currentProjects = [];
  let currentIDE = { id: 'vscode', name: 'Visual Studio Code', icon: 'vscode.png' };

  // ===== FUN√á√ÉO PARA OBTER √çCONE DA IDE ATUAL =====
  function getCurrentIDEIcon() {
    return `assets/${currentIDE.icon}`;
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR √çCONES DE IDE =====
  function updateIDEIcons() {
    const ideIcon = getCurrentIDEIcon();
    
    // Atualiza todos os √≠cones de IDE
    const ideImages = document.querySelectorAll('img[id*="btn-editor"], img[id*="pamp-btn-editor"]');
    ideImages.forEach(img => {
      img.src = ideIcon;
      img.title = `Abrir projeto no ${currentIDE.name}`;
    });
  }

  // Fun√ß√£o para aplicar tema
  function applyTheme() {
    // Carrega as configura√ß√µes (incluindo modo escuro)
    ipcRenderer.send('load-configs');
  }

  // Fun√ß√£o para obter o √≠cone de terminal correto baseado no tema
  function getTerminalIcon() {
    const isDarkMode = document.body.classList.contains('dark-mode');
    return isDarkMode ? 'terminal_branco.png' : 'terminal.png';
  }

  // Fun√ß√£o para atualizar √≠cones de terminal baseado no tema
  function updateTerminalIcons() {
    const terminalIcon = getTerminalIcon();
    
    // Atualiza todos os √≠cones de terminal
    const terminalImages = document.querySelectorAll('img[id*="terminal"]');
    terminalImages.forEach(img => {
      if (img.src.includes('terminal.png') || img.src.includes('terminal_branco.png')) {
        img.src = terminalIcon;
      }
    });
  }

  // ===== FUN√á√ÉO PARA ABRIR PROJETO NO EDITOR =====
  function openProjectInEditor(projectIndex, isPamp) {
    // Verifica se j√° est√° processando para evitar m√∫ltiplos cliques
    const editorButtonId = isPamp ? `pamp-btn-editor-${projectIndex}` : `btn-editor-${projectIndex}`;
    const editorButton = document.getElementById(editorButtonId);
    
    if (!editorButton || editorButton.classList.contains('disabled')) {
      console.log('Editor j√° est√° sendo aberto, aguarde...');
      return;
    }
    
    // Pega o caminho do projeto
    const inputId = isPamp ? `pamp-input-${projectIndex}` : `input-${projectIndex}`;
    const inputElement = document.getElementById(inputId);
    
    if (!inputElement || !inputElement.value.trim()) {
      alert('Caminho do projeto n√£o est√° configurado.\nConfigure o caminho do projeto primeiro.');
      return;
    }
    
    const projectPath = inputElement.value.trim();
    
    // Desabilita o bot√£o por 5 segundos
    editorButton.classList.add('disabled');
    editorButton.title = 'Abrindo editor...';
    
    console.log(`[DEBUG] Abrindo editor para projeto: ${projectPath}`);
    
    // Envia comando para abrir o projeto no editor
    ipcRenderer.send('open-project-in-editor', { 
      projectPath: projectPath,
      projectIndex: projectIndex,
      isPamp: isPamp
    });
    
    // Reabilita o bot√£o ap√≥s 5 segundos
    setTimeout(() => {
      editorButton.classList.remove('disabled');
      editorButton.title = 'Abrir projeto no editor de c√≥digo';
    }, 5000);
  }

  // ===== FUN√á√ïES PARA CONTROLE INTELIGENTE DO TOOLTIP =====
  let tooltipTimeouts = {};

  function showTooltip(event, projectIndex) {
    // Cancela qualquer timeout de hide pendente
    if (tooltipTimeouts[projectIndex]) {
      clearTimeout(tooltipTimeouts[projectIndex]);
      delete tooltipTimeouts[projectIndex];
    }

    const tooltip = document.getElementById(`tooltip-${projectIndex}`);
    if (!tooltip) return;

    // Calcula posi√ß√£o inteligente
    const rect = event.target.getBoundingClientRect();
    const tooltipWidth = 380;
    const tooltipHeight = 400; // altura m√°xima aproximada
    
    // Posi√ß√£o horizontal - sempre √† esquerda do √≠cone para n√£o sair da tela
    let left = rect.left - tooltipWidth - 10;
    if (left < 10) {
      // Se sair pela esquerda, posiciona √† direita
      left = rect.right + 10;
      // Se ainda sair pela direita, centraliza
      if (left + tooltipWidth > window.innerWidth - 10) {
        left = (window.innerWidth - tooltipWidth) / 2;
      }
    }
    
    // Posi√ß√£o vertical - preferencialmente acima
    let top = rect.top - tooltipHeight - 10;
    if (top < 10) {
      // Se sair por cima, posiciona embaixo
      top = rect.bottom + 10;
      // Se ainda sair por baixo, centraliza verticalmente
      if (top + tooltipHeight > window.innerHeight - 10) {
        top = (window.innerHeight - tooltipHeight) / 2;
      }
    }

    // Aplica posicionamento
    tooltip.style.left = Math.max(10, left) + 'px';
    tooltip.style.top = Math.max(10, top) + 'px';
    
    // Mostra tooltip
    tooltip.classList.add('show');
  }

  function hideTooltip(projectIndex) {
    // Delay para permitir mover o mouse para o tooltip
    tooltipTimeouts[projectIndex] = setTimeout(() => {
      const tooltip = document.getElementById(`tooltip-${projectIndex}`);
      if (tooltip) {
        tooltip.classList.remove('show');
      }
      delete tooltipTimeouts[projectIndex];
    }, 200);
  }

  function keepTooltipVisible(projectIndex) {
    // Cancela o hide quando mouse entra no tooltip
    if (tooltipTimeouts[projectIndex]) {
      clearTimeout(tooltipTimeouts[projectIndex]);
      delete tooltipTimeouts[projectIndex];
    }
  }

  function hideTooltipDelayed(projectIndex) {
    // Hide com delay quando mouse sai do tooltip
    tooltipTimeouts[projectIndex] = setTimeout(() => {
      const tooltip = document.getElementById(`tooltip-${projectIndex}`);
      if (tooltip) {
        tooltip.classList.remove('show');
      }
      delete tooltipTimeouts[projectIndex];
    }, 300);
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR TOOLTIP COM PORTA =====
  function updateTooltipWithPort(projectIndex, port, isPamp) {
    if (!isPamp) return; // S√≥ atualiza para projetos PAMP
    
    const tooltipElement = document.getElementById(`tooltip-${projectIndex}`);
    if (tooltipElement) {
      const inputElement = document.getElementById(`pamp-input-${projectIndex}`);
      const currentPath = inputElement ? inputElement.value : '';
      
      const tooltipContent = `
        <strong>üîß Configura√ß√£o para desenvolvimento local:</strong><br><br>
        Para usar este micro front-end localmente, voc√™ precisa alterar o arquivo <code>environment.ts</code> do projeto <strong>mp-pamp</strong>.<br><br>
        <strong>üìç Caminho:</strong> <code>mp-pamp/src/environments/environment.ts</code><br><br>
        <strong>üìù Como alterar:</strong><br>
        1. Encontre a se√ß√£o <code>mfe: { ... }</code><br>
        2. Procure pela propriedade que corresponde a este MFE<br>
        3. Substitua a URL atual pela URL local: <code>http://localhost:${port}/remoteEntry.js</code><br>
        4. Salve o arquivo e recompile o projeto mp-pamp<br><br>
        <span class="tooltip-link" onclick="openEnvironmentFile('${currentPath}')">üîó Abrir arquivo environment.ts</span>
      `;
      tooltipElement.innerHTML = tooltipContent;
    }
  }

  // ===== FUN√á√ÉO PARA ABRIR ARQUIVO ENVIRONMENT.TS =====
  function openEnvironmentFile(currentProjectPath) {
    // Verifica se j√° est√° processando para evitar m√∫ltiplos cliques
    if (window.openingEnvironmentFile) {
      console.log('J√° est√° abrindo arquivo environment.ts, aguarde...');
      return;
    }
    
    // Busca o projeto mp-pamp na lista de projetos carregados
    const mpPampProject = currentProjects.find(p => p.name === 'mp-pamp');
    
    if (!mpPampProject || !mpPampProject.path) {
      alert('Projeto mp-pamp n√£o encontrado ou n√£o configurado.\nVerifique se o mp-pamp est√° na lista de projetos e tem um caminho v√°lido.');
      return;
    }
    
    // Marca como processando
    window.openingEnvironmentFile = true;
    
    // Desabilita todos os links do tooltip
    const allTooltipLinks = document.querySelectorAll('.tooltip-link');
    allTooltipLinks.forEach(link => {
      link.style.opacity = '0.5';
      link.style.cursor = 'not-allowed';
      link.style.pointerEvents = 'none';
      link.innerHTML = '‚è≥ Abrindo arquivo...';
    });
    
    // Usa o caminho do mp-pamp e adiciona o sufixo do arquivo
    const mpPampPath = mpPampProject.path;
    let environmentPath;
    
    // Detecta o sistema operacional pelos separadores no caminho
    if (mpPampPath.includes('\\')) {
      // Windows
      environmentPath = mpPampPath + '\\src\\environments\\environment.ts';
    } else {
      // Linux/macOS
      environmentPath = mpPampPath + '/src/environments/environment.ts';
    }
    
    console.log(`[DEBUG] Projeto mp-pamp encontrado: ${mpPampPath}`);
    console.log(`[DEBUG] Caminho final do environment.ts: ${environmentPath}`);
    
    // Envia comando para abrir o arquivo
    ipcRenderer.send('open-environment-file', { 
      filePath: environmentPath,
      mpPampPath: mpPampPath
    });
    
    // Reabilita os links ap√≥s 3 segundos (tempo suficiente para o arquivo abrir)
    setTimeout(() => {
      window.openingEnvironmentFile = false;
      allTooltipLinks.forEach(link => {
        link.style.opacity = '1';
        link.style.cursor = 'pointer';
        link.style.pointerEvents = 'auto';
        link.innerHTML = 'üîó Abrir arquivo environment.ts';
      });
    }, 3000);
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR BRANCH (GIT PULL) =====
  function handleUpdateBranch(projectIndex, projectName, projectPath, isPamp) {
    console.log(`[DEBUG] handleUpdateBranch chamada:`, { projectIndex, projectName, projectPath, isPamp });
    
    if (!projectPath || projectPath.trim() === '') {
      console.log(`[ERROR] Projeto ${projectName} n√£o tem caminho v√°lido:`, projectPath);
      alert('Projeto precisa ter um caminho v√°lido para ser atualizado.');
      return;
    }

    // Confirma a a√ß√£o
    const confirmed = confirm(`Atualizar branch do projeto ${projectName}?\n\nIsso executar√° um 'git pull origin' no diret√≥rio:\n${projectPath}`);
    
    if (!confirmed) {
      console.log(`[INFO] Usu√°rio cancelou git pull para ${projectName}`);
      return;
    }

    console.log(`[INFO] Usu√°rio confirmou git pull para ${projectName}`);

    // Muda o visual da tag para indicar que est√° processando
    const commitsTagId = isPamp ? `pamp-commits-${projectIndex}` : `pas-commits-${projectIndex}`;
    const commitsTag = document.getElementById(commitsTagId);
    
    console.log(`[DEBUG] Procurando tag com ID: ${commitsTagId}`, commitsTag);
    
    if (commitsTag) {
      commitsTag.style.background = '#6c757d'; // Cinza para indicar processamento
      commitsTag.innerHTML = '‚è≥ Atualizando...';
      commitsTag.style.cursor = 'not-allowed';
      commitsTag.onclick = null; // Remove o clique durante o processamento
      console.log(`[INFO] Tag visual atualizada para estado "processando"`);
    } else {
      console.log(`[WARN] Tag commits n√£o encontrada: ${commitsTagId}`);
    }

    // Mostra log imediato no console do projeto
    const logContainer = isPamp ? `pamp-log-${projectIndex}` : `log-${projectIndex}`;
    const logDiv = document.getElementById(logContainer);
    if (logDiv) {
      logDiv.style.display = 'block';
      logDiv.innerHTML += `<div style="color: #ffff00;">[${new Date().toLocaleTimeString()}] üîÑ Iniciando git pull para ${projectName}...</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[INFO] Log adicionado ao container: ${logContainer}`);
    } else {
      console.log(`[WARN] Container de log n√£o encontrado: ${logContainer}`);
    }

    // Envia comando para o backend
    const data = {
      projectIndex: projectIndex,
      projectName: projectName,
      projectPath: projectPath,
      isPamp: isPamp
    };
    
    console.log(`[DEBUG] Enviando comando git-pull-branch:`, data);
    ipcRenderer.send('git-pull-branch', data);
    console.log(`[INFO] Comando git-pull-branch enviado para o backend`);
  }

  // ===== FUN√á√ïES PARA BOT√ïES TOGGLE MODERNOS =====
  function updateToggleButton(button, isExpanded, count = 0) {
    const countElement = button.querySelector('.toggle-count');
    
    // Atualiza estado de expandido
    if (isExpanded) {
      button.classList.add('expanded');
    } else {
      button.classList.remove('expanded');
    }
    
    // Atualiza contador
    if (countElement) {
      countElement.textContent = count.toString();
    }
  }

  // Toggle para PAMP (Painel Admin)
  const togglePampBtn = document.getElementById('toggle-pamp-mfes');
  const pampContainer = document.getElementById('pamp-mfes');
  let pampVisible = false;
  
  togglePampBtn.addEventListener('click', () => {
    pampVisible = !pampVisible;
    pampContainer.style.display = pampVisible ? 'block' : 'none';
    
    // Conta projetos PAMP vis√≠veis
    const pampCount = pampContainer.querySelectorAll('.project-card').length;
    updateToggleButton(togglePampBtn, pampVisible, pampCount);
  });

  // Toggle para PAS (Site Principal)
  const toggleBtn = document.getElementById('toggle-mfes');
  const projectsContainer = document.getElementById('projects');
  let mfesVisible = false;
  
  toggleBtn.addEventListener('click', () => {
    mfesVisible = !mfesVisible;
    projectsContainer.style.display = mfesVisible ? 'block' : 'none';
    
    // Conta projetos PAS vis√≠veis
    const pasCount = projectsContainer.querySelectorAll('.project-card').length;
    updateToggleButton(toggleBtn, mfesVisible, pasCount);
  });

  ipcRenderer.send('load-projects');
  
  // Handler para resultado do git pull
  ipcRenderer.on('git-pull-result', (event, { projectIndex, projectName, success, output, isPamp }) => {
    console.log(`üìù Resultado git pull para ${projectName}:`, { success, output });

    const commitsTagId = isPamp ? `pamp-commits-${projectIndex}` : `pas-commits-${projectIndex}`;
    const commitsTag = document.getElementById(commitsTagId);
    
    // Sempre mostra os logs no console do projeto
    const logContainer = isPamp ? `pamp-log-${projectIndex}` : `log-${projectIndex}`;
    const logDiv = document.getElementById(logContainer);
    
    if (logDiv) {
      logDiv.style.display = 'block';
      
      if (success) {
        logDiv.innerHTML += `<div style="color: #00ff00;">[${new Date().toLocaleTimeString()}] ‚úÖ Branch atualizada com sucesso!</div>`;
      } else {
        logDiv.innerHTML += `<div style="color: #ff6b35;">[${new Date().toLocaleTimeString()}] ‚ö†Ô∏è Pull executado com avisos</div>`;
      }
      
      // Mostra TODOS os logs do git pull
      if (output && output.trim()) {
        const lines = output.split('\n');
        lines.forEach(line => {
          if (line.trim()) {
            const color = line.includes('fatal') || line.includes('error') ? '#ff4444' : 
                         line.includes('From https://') || line.includes('branch') ? '#00aaff' :
                         line.includes('*') || line.includes('->') ? '#ffaa00' : '#ffffff';
            logDiv.innerHTML += `<div style="color: ${color};">[${new Date().toLocaleTimeString()}] ${line}</div>`;
          }
        });
      }
      
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    if (success) {
      // Sucesso REAL - remove a tag de commits pendentes
      if (commitsTag) {
        commitsTag.remove();
      }
      
      // Atualiza o projeto no array local
      if (currentProjects[projectIndex]) {
        currentProjects[projectIndex].pendingCommits = 0;
        currentProjects[projectIndex].hasUpdates = false;
      }
      
    } else {
      // Problema/Warning - badge permanece para nova tentativa
      if (commitsTag) {
        const hasConflict = output && (output.includes('would be overwritten') || output.includes('Aborting'));
        
        if (hasConflict) {
          commitsTag.style.background = '#ff6b35'; // Laranja para conflitos
          commitsTag.innerHTML = `‚ö†Ô∏è Conflito`;
          commitsTag.title = 'Conflito de merge. Resolva os conflitos locais primeiro.';
        } else {
          commitsTag.style.background = '#dc3545'; // Vermelho para erros
          commitsTag.innerHTML = '‚ùå Erro';
          commitsTag.title = 'Erro na atualiza√ß√£o. Clique para tentar novamente.';
        }
        
        commitsTag.style.cursor = 'pointer';
        commitsTag.onclick = () => handleUpdateBranch(projectIndex, projectName, currentProjects[projectIndex].path, isPamp);
      }
    }
  });
  
  // Recebe as configura√ß√µes e aplica o modo escuro se necess√°rio
  ipcRenderer.on('configs-loaded', (event, configs) => {
    if (configs.darkMode) {
      document.body.classList.add('dark-mode');
    }
    // Atualiza os √≠cones de terminal ap√≥s aplicar o tema
    updateTerminalIcons();
  });

  // Escuta mudan√ßas do modo escuro vindas da janela de configura√ß√µes
  ipcRenderer.on('apply-dark-mode', (event, isDarkMode) => {
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
    // Atualiza os √≠cones de terminal ap√≥s mudan√ßa de tema
    updateTerminalIcons();
  });

  // ===== LISTENERS PARA ABERTURA DO ENVIRONMENT.TS =====
  // Escuta quando o arquivo foi aberto com sucesso
  ipcRenderer.on('environment-file-opened', (event, { success, filePath }) => {
    console.log(`‚úÖ Arquivo environment.ts aberto com sucesso: ${filePath}`);
    reEnableTooltipLinks();
  });

  // Escuta quando houve erro ao abrir o arquivo
  ipcRenderer.on('environment-file-error', (event, { error, message }) => {
    console.error(`‚ùå Erro ao abrir environment.ts: ${error}`);
    reEnableTooltipLinks();
  });

  // Fun√ß√£o para reabilitar os links do tooltip
  function reEnableTooltipLinks() {
    window.openingEnvironmentFile = false;
    const allTooltipLinks = document.querySelectorAll('.tooltip-link');
    allTooltipLinks.forEach(link => {
      link.style.opacity = '1';
      link.style.cursor = 'pointer';
      link.style.pointerEvents = 'auto';
      link.innerHTML = 'üîó Abrir arquivo environment.ts';
    });
  }

  // ===== LISTENERS PARA CONFIGURA√á√ÉO DE IDE =====
  // Escuta quando a IDE √© alterada
  ipcRenderer.on('ide-changed', (event, { id, name, icon }) => {
    console.log(`üîß IDE alterada para: ${name}`);
    currentIDE = { id, name, icon };
    updateIDEIcons();
  });

  // Carrega a IDE atual na inicializa√ß√£o
  ipcRenderer.send('get-current-ide');

  // Escuta resposta da IDE atual
  ipcRenderer.on('current-ide', (event, ide) => {
    console.log(`üîß IDE atual carregada: ${ide.name}`);
    currentIDE = ide;
    updateIDEIcons();
  });

  ipcRenderer.on('projects-loaded', (event, projects) => {
    // Store projects globally
    currentProjects = projects;
    
    console.log('[DEBUG] Projetos recebidos com dados Git:', projects.map(p => ({
      name: p.name,
      branch: p.gitBranch,
      pendingCommits: p.pendingCommits,
      hasUpdates: p.hasUpdates
    })));

    // PAMP
    const pampProjects = projects.filter(p => p.name && p.name.startsWith('mp-pamp'));
    const pampContainer = document.getElementById('pamp-mfes');
    pampContainer.innerHTML = '';

  pampProjects.forEach((project, index) => {
      // Descubra o √≠ndice real no array projects
    const realIndex = projects.findIndex(p => p.name === project.name);
    const div = document.createElement('div');
    div.innerHTML = `
       <div class="project-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <p style="margin: 0;"><strong>${project.name}</strong></p>
            <span class="toggle-versions-btn" onclick="toggleVersionBadges(${realIndex}, true)" title="Mostrar/Esconder badges">‚Ä∫</span>
            <div class="version-badges-container" id="pamp-version-badges-${realIndex}">
              <span id="pamp-node-version-${realIndex}" class="version-badge node"><img src="assets/node.png" alt="Node.js" /><span class="version-text">...</span></span>
              <span id="pamp-angular-version-${realIndex}" class="version-badge angular"><img src="assets/angular.png" alt="Angular" /><span class="version-text">...</span></span>
              ${project.gitBranch ? `<span id="pamp-branch-${realIndex}" style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;"><img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${project.gitBranch}</span>` : ''}
              ${project.pendingCommits && project.pendingCommits > 0 ? `<span id="pamp-commits-${realIndex}" style="background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer;" title="Clique para atualizar branch" onclick="handleUpdateBranch(${realIndex}, '${project.name}', \`${project.path.replace(/\\/g, '\\\\')}\`, true)">‚Üì ${project.pendingCommits}</span>` : ''}
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 5px;">
            <img id="pamp-btn-editor-${realIndex}" src="${getCurrentIDEIcon()}" class="editor-icon" style="${!project.path ? 'display: none' : ''}" title="Abrir projeto no ${currentIDE.name}" alt="Editor" onclick="openProjectInEditor('${realIndex}', true)" />
            <img id="pamp-btn-terminal-${realIndex}" src="${getTerminalIcon()}" style="width: 24px; height: 24px; cursor: pointer; ${!project.path ? 'display: none' : ''}" title="Abrir terminal na pasta do projeto" alt="Terminal" />
            ${project.name !== 'mp-pamp' ? `
            <div class="tooltip" onmouseenter="showTooltip(event, ${realIndex})" onmouseleave="hideTooltip(${realIndex})">
              <span class="help-icon" title="Clique para ajuda sobre configura√ß√£o MFE">‚ìò</span>
              <span class="tooltiptext" id="tooltip-${realIndex}" onmouseenter="keepTooltipVisible(${realIndex})" onmouseleave="hideTooltipDelayed(${realIndex})">
                <strong>üîß Configura√ß√£o para desenvolvimento local:</strong><br><br>
                Para usar este micro front-end localmente, voc√™ precisa alterar o arquivo <code>environment.ts</code> do projeto <strong>mp-pamp</strong>.<br><br>
                <strong>üìç Caminho:</strong> <code>mp-pamp/src/environments/environment.ts</code><br><br>
                <strong>üìù Como alterar:</strong><br>
                1. Encontre a se√ß√£o <code>mfe: { ... }</code><br>
                2. Procure pela propriedade que corresponde a este MFE<br>
                3. Substitua a URL atual pela URL local: <code>http://localhost:[PORTA]/remoteEntry.js</code><br>
                4. Use a porta mostrada ao lado do bot√£o "Iniciar" quando o projeto estiver rodando<br><br>
                <span class="tooltip-link" onclick="openEnvironmentFile('${project.path}')">üîó Abrir arquivo environment.ts</span>
              </span>
            </div>
            ` : ''}
          </div>
        </div>
        <div class="input-with-folder" style="margin-bottom: 10px;">
          <input id="pamp-input-${realIndex}" data-path="${project.path}" type="text" value="${project.path}" placeholder="Insira o caminho do projeto" />
          <img id="pamp-folder-icon-${realIndex}" src="pasta.png" class="folder-icon" title="Procurar projeto existente" alt="Procurar pasta" />
        </div>
        <button id="pamp-btn-download-${realIndex}" style="margin-right: 10px; ${project.path ? 'display: none' : ''}">Baixar Projeto</button>
        <button id="pamp-btn-start-${realIndex}" style="margin-right: 10px;" ${!project.path ? 'disabled' : ''}>Iniciar</button>
        <span id="pamp-port-${realIndex}" style="display: none; margin-right: 10px; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: default;"></span>
        <button id="pamp-btn-cancel-${realIndex}" style="display: none; margin-right: 10px; background-color: #dc3545; color: white;" title="Cancelar inicializa√ß√£o">‚úï Cancelar</button>
        <button id="pamp-btn-stop-${realIndex}" style="display: none;">Parar</button>
        <button id="pamp-btn-move-${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #5a6c7d; color: white;">Mover para...</button>
        <button id="pamp-btn-delete-${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #8b5a5a; color: white;">Deletar</button>
        <div id="pamp-log-${realIndex}" style="display: none; background: #000; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; font-family: monospace; border-radius: 5px; margin-top: 10px;"></div>
      </div>
    `;
    pampContainer.appendChild(div);

    const pampInput = document.getElementById(`pamp-input-${realIndex}`);
    const pampDownloadButton = document.getElementById(`pamp-btn-download-${realIndex}`);
    const pampFolderIcon = document.getElementById(`pamp-folder-icon-${realIndex}`);
    const pampStartButton = document.getElementById(`pamp-btn-start-${realIndex}`);
    const pampCancelButton = document.getElementById(`pamp-btn-cancel-${realIndex}`);
    const pampStopButton = document.getElementById(`pamp-btn-stop-${realIndex}`);
    const pampTerminalButton = document.getElementById(`pamp-btn-terminal-${realIndex}`);
    const pampMoveButton = document.getElementById(`pamp-btn-move-${realIndex}`);
    const pampDeleteButton = document.getElementById(`pamp-btn-delete-${realIndex}`);
    const pampLogDiv = document.getElementById(`pamp-log-${realIndex}`);
    const pampEditorButton = document.getElementById(`pamp-btn-editor-${realIndex}`);

    // Event listeners para projetos PAMP
    pampInput.addEventListener('blur', () => {
      ipcRenderer.send('update-project-path', { index: realIndex, path: pampInput.value });
      if (pampInput.value.trim()) {
          pampDownloadButton.style.display = 'none';
          pampStartButton.disabled = false;
          pampMoveButton.style.display = 'inline-block';
          pampDeleteButton.style.display = 'inline-block';
          pampEditorButton.style.display = 'inline-block';
          pampTerminalButton.style.display = 'inline-block';
      }else {
          pampDeleteButton.style.display = 'none';
          pampMoveButton.style.display = 'none';
          pampDownloadButton.style.display = 'inline-block';
          pampStartButton.disabled = true;
          pampEditorButton.style.display = 'none';
          pampTerminalButton.style.display = 'none';
      }
    });

    pampDownloadButton.addEventListener('click', () => {
      pampFolderIcon.classList.add('disabled');
      ipcRenderer.send('download-project', { name: project.name, index: realIndex });
    });

    pampFolderIcon.addEventListener('click', () => {
      ipcRenderer.send('browse-project-folder', { index: realIndex, projectName: project.name });
    });

    pampMoveButton.addEventListener('click', () => {
      if (pampInput.value.trim()) {
        if (pampStartButton.innerText === 'Rodando ‚úì') {
          alert('N√£o √© poss√≠vel mover o projeto enquanto ele estiver rodando. Pare o projeto primeiro.');
          return;
        }
        
        pampMoveButton.disabled = true;
        pampMoveButton.innerText = 'Movendo...';
        ipcRenderer.send('move-project', { 
          index: realIndex, 
          currentPath: pampInput.value, 
          projectName: project.name 
        });
      } else {
        alert('Projeto precisa ter um caminho v√°lido para ser movido.');
      }
    });

    pampDeleteButton.addEventListener('click', () => {
      if (confirm(`Tem certeza que deseja deletar o projeto ${project.name}?`)) {
        pampDeleteButton.disabled = true;
        pampFolderIcon.classList.add('disabled');
        ipcRenderer.send('delete-project', { index: realIndex, path: pampInput.value });
      }
    });

    pampStartButton.addEventListener('click', (event) => {
      // Limpa o console antes de iniciar
      const pampLogDiv = document.getElementById(`pamp-log-${realIndex}`);
      if (pampLogDiv) {
        pampLogDiv.innerText = ''; // Zera os logs antigos
        pampLogDiv.style.display = 'none'; // Esconde at√© aparecer novos logs
      }
      
      pampStartButton.disabled = true;
      pampStartButton.innerText = 'Executando...';
      pampCancelButton.style.display = 'inline-block';
      pampFolderIcon.classList.add('disabled');
      if (pampDeleteButton) pampDeleteButton.disabled = true;      
      ipcRenderer.send('start-project-pamp', { projectPath: pampInput.value, port: project.port });
    });

    pampCancelButton.addEventListener('click', () => {
      ipcRenderer.send('cancel-project-startup', { projectPath: pampInput.value, isPamp: true, index: realIndex });
      
      pampStartButton.disabled = false;
      pampStartButton.innerText = 'Iniciar';
      pampCancelButton.style.display = 'none';
      pampFolderIcon.classList.remove('disabled');
      if (pampDeleteButton) pampDeleteButton.disabled = false;
    });

    pampTerminalButton.addEventListener('click', () => {
      if (pampInput.value.trim()) {
        pampTerminalButton.style.opacity = '0.5';
        pampTerminalButton.style.pointerEvents = 'none';
        pampTerminalButton.title = 'Abrindo terminal...';
        
        ipcRenderer.send('open-terminal', { projectPath: pampInput.value });
        
        setTimeout(() => {
          pampTerminalButton.style.opacity = '1';
          pampTerminalButton.style.pointerEvents = 'auto';
          pampTerminalButton.title = 'Abrir terminal na pasta do projeto';
        }, 5000);
      } else {
        alert('Projeto precisa ter um caminho v√°lido para abrir o terminal.');
      }
    });

    pampStopButton.addEventListener('click', () => {
      ipcRenderer.send('stop-project', { projectPath: pampInput.value, port: project.port });
    });

  });  
    
  // Projects PAS
  const pasProjects = projects.filter(p => p.name && !p.name.startsWith('mp-pamp'));
  const container = document.getElementById('projects');
  container.innerHTML = '';

  pasProjects.forEach((project, pasIndex) => {
    const realIndex = projects.findIndex(p => p.name === project.name);
    const div = document.createElement('div');
    div.innerHTML = `
      <div class="project-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <p style="margin: 0;"><strong>${project.name}</strong></p>
            <span class="toggle-versions-btn" onclick="toggleVersionBadges(${realIndex}, false)" title="Mostrar/Esconder badges">‚Ä∫</span>
            <div class="version-badges-container" id="pas-version-badges-${realIndex}">
              <span id="pas-node-version-${realIndex}" class="version-badge node"><img src="assets/node.png" alt="Node.js" /><span class="version-text">...</span></span>
              <span id="pas-angular-version-${realIndex}" class="version-badge angular"><img src="assets/angular.png" alt="Angular" /><span class="version-text">...</span></span>
              ${project.gitBranch ? `<span id="pas-branch-${realIndex}" style="background: #007bff; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;"><img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${project.gitBranch}</span>` : ''}
              ${project.pendingCommits && project.pendingCommits > 0 ? `<span id="pas-commits-${realIndex}" style="background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer;" title="Clique para atualizar branch" onclick="handleUpdateBranch(${realIndex}, '${project.name}', \`${project.path.replace(/\\/g, '\\\\')}\`, false)">‚Üì ${project.pendingCommits}</span>` : ''}
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 5px;">
            <img id="btn-editor-${realIndex}" src="${getCurrentIDEIcon()}" class="editor-icon" style="${!project.path ? 'display: none' : ''}" title="Abrir projeto no ${currentIDE.name}" alt="Editor" onclick="openProjectInEditor('${realIndex}', false)" />
            <img id="btn-terminal-${realIndex}" src="${getTerminalIcon()}" style="width: 24px; height: 24px; cursor: pointer; ${!project.path ? 'display: none' : ''}" title="Abrir terminal na pasta do projeto" alt="Terminal" />
          </div>
        </div>
        <div class="input-with-folder" style="margin-bottom: 10px;">
          <input id="input-${realIndex}" type="text" value="${project.path}" placeholder="Insira o caminho do projeto" />
          <img id="folder-icon-${realIndex}" src="pasta.png" class="folder-icon" title="Procurar projeto existente" alt="Procurar pasta" />
        </div>
        <button id="btn-download-${realIndex}" style="margin-right: 10px; ${project.path ? 'display: none' : ''}">Baixar Projeto</button>
        <button id="btn-start-${realIndex}" data-index="${realIndex}" style="margin-right: 10px;" ${!project.path ? 'disabled' : ''}>Iniciar</button>
        <span id="port-${realIndex}" style="display: none; margin-right: 10px; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: default;"></span>
        <button id="btn-cancel-${realIndex}" style="display: none; margin-right: 10px; background-color: #dc3545; color: white;" title="Cancelar inicializa√ß√£o">‚úï Cancelar</button>
        <button id="btn-stop-${realIndex}" style="display: none;">Parar</button>
        <button id="btn-move-${realIndex}" data-index="${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #5a6c7d; color: white;">Mover para...</button>
        <button id="btn-delete-${realIndex}" data-index="${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #8b5a5a; color: white;">Deletar</button>
        <div id="log-${realIndex}" style="display: none; background: #000; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; font-family: monospace; border-radius: 5px; margin-top: 10px;"></div>
      </div>
    `;
    container.appendChild(div);

    const input = document.getElementById(`input-${realIndex}`);
    const downloadButton = document.getElementById(`btn-download-${realIndex}`);
    const folderIcon = document.getElementById(`folder-icon-${realIndex}`);
    const startButton = document.getElementById(`btn-start-${realIndex}`);
    const cancelButton = document.getElementById(`btn-cancel-${realIndex}`);
    const stopButton = document.getElementById(`btn-stop-${realIndex}`);
    const terminalButton = document.getElementById(`btn-terminal-${realIndex}`);
    const editorButton = document.getElementById(`btn-editor-${realIndex}`);
    const moveButton = document.getElementById(`btn-move-${realIndex}`);
    const deleteButton = document.getElementById(`btn-delete-${realIndex}`);
    const logDiv = document.getElementById(`log-${realIndex}`);
  
    // Event listeners para projetos PAS
    input.addEventListener('blur', () => {
      ipcRenderer.send('update-project-path', { index: realIndex, path: input.value });
      if (input.value.trim()) {
          downloadButton.style.display = 'none';
          startButton.disabled = false;
          moveButton.style.display = 'inline-block';
          deleteButton.style.display = 'inline-block';
          editorButton.style.display = 'inline-block';
          terminalButton.style.display = 'inline-block';
      }else {
        deleteButton.style.display = 'none';
        moveButton.style.display = 'none';
        downloadButton.style.display = 'inline-block';
        editorButton.style.display = 'none';
        terminalButton.style.display = 'none';
      }
    });
  
    downloadButton.addEventListener('click', () => {
      ipcRenderer.send('download-project', { name: project.name, index: realIndex });
    });

    folderIcon.addEventListener('click', () => {
      ipcRenderer.send('browse-project-folder', { index: realIndex, projectName: project.name });
    });
  
    startButton.addEventListener('click', (event) => {
      // Limpa o console antes de iniciar
      const logDiv = document.getElementById(`log-${realIndex}`);
      if (logDiv) {
        logDiv.innerText = ''; // Zera os logs antigos
        logDiv.style.display = 'none'; // Esconde at√© aparecer novos logs
      }
      
      startButton.disabled = true;
      startButton.innerText = 'Executando...';
      cancelButton.style.display = 'inline-block';
      const deleteButton = document.getElementById(`btn-delete-${event.currentTarget.getAttribute('data-index')}`);
      if (deleteButton) deleteButton.disabled = true;      
      ipcRenderer.send('start-project', { projectPath: input.value, port: project.port });
    });
  
    cancelButton.addEventListener('click', () => {
      ipcRenderer.send('cancel-project-startup', { projectPath: input.value, isPamp: false, index: realIndex });
      
      startButton.disabled = false;
      startButton.innerText = 'Iniciar';
      cancelButton.style.display = 'none';
      const deleteButton = document.getElementById(`btn-delete-${realIndex}`);
      if (deleteButton) deleteButton.disabled = false;
    });

    terminalButton.addEventListener('click', () => {
      if (input.value.trim()) {
        terminalButton.style.opacity = '0.5';
        terminalButton.style.pointerEvents = 'none';
        terminalButton.title = 'Abrindo terminal...';
        
        ipcRenderer.send('open-terminal', { projectPath: input.value });
        
        setTimeout(() => {
          terminalButton.style.opacity = '1';
          terminalButton.style.pointerEvents = 'auto';
          terminalButton.title = 'Abrir terminal na pasta do projeto';
        }, 5000);
      } else {
        alert('Projeto precisa ter um caminho v√°lido para abrir o terminal.');
      }
    });
  
    stopButton.addEventListener('click', () => {
      ipcRenderer.send('stop-project', { projectPath: input.value, port: project.port });
    });

    moveButton.addEventListener('click', () => {
      if (input.value.trim()) {
        if (startButton.innerText === 'Rodando ‚úì') {
          alert('N√£o √© poss√≠vel mover o projeto enquanto ele estiver rodando. Pare o projeto primeiro.');
          return;
        }
        
        moveButton.disabled = true;
        moveButton.innerText = 'Movendo...';
        ipcRenderer.send('move-project', { 
          index: realIndex, 
          currentPath: input.value, 
          projectName: project.name 
        });
      } else {
        alert('Projeto precisa ter um caminho v√°lido para ser movido.');
      }
    });

    deleteButton.addEventListener('click', () => {
      if (confirm(`Tem certeza que deseja deletar o projeto ${project.name}?`)) {
        deleteButton.disabled = true;
        ipcRenderer.send('delete-project', { index: realIndex, path: input.value });
      }
    });
    
    });

    // ===== ATUALIZA CONTADORES DOS BOT√ïES TOGGLE AP√ìS CARREGAMENTO =====
    // Aguarda um pequeno delay para garantir que todos os elementos foram renderizados
    setTimeout(() => {
      // Atualiza contador PAMP (Painel Admin)
      const pampCount = document.getElementById('pamp-mfes').querySelectorAll('.project-card').length;
      const pampCountElement = document.getElementById('pamp-count');
      if (pampCountElement) {
        pampCountElement.textContent = pampCount.toString();
      }
      
      // Atualiza contador PAS (Site Principal)  
      const pasCount = document.getElementById('projects').querySelectorAll('.project-card').length;
      const pasCountElement = document.getElementById('pas-count');
      if (pasCountElement) {
        pasCountElement.textContent = pasCount.toString();
      }
      
      console.log(`üìä Contadores atualizados ap√≥s carregamento completo: PAMP Admin=${pampCount}, PAS Site=${pasCount}`);
      
      // Atualiza os √≠cones de terminal ap√≥s carregar projetos
      updateTerminalIcons();
      
      // ‚ö° DISPARA VERIFICA√á√ÉO GIT EM SEGUNDO PLANO ‚ö°
      console.log('[GIT-BG] üöÄ Disparando verifica√ß√£o Git em segundo plano...');
      ipcRenderer.send('start-background-git-check');
      
      // ‚ö° ATUALIZA BADGES DE VERS√ÉO (Node.js e Angular CLI) ‚ö°
      console.log('[VERSION-BADGES] üîÑ Atualizando badges de vers√£o dos projetos...');
      updateAllProjectVersionBadges();
    }, 200);
  });

  // ===== LISTENER PARA ATUALIZA√á√ïES GIT EM SEGUNDO PLANO =====
  ipcRenderer.on('git-status-updated', (event, { projectIndex, gitStatus }) => {
    console.log(`[GIT-BG] üì® RECEBIDA MENSAGEM IPC para projeto ${projectIndex}:`, gitStatus);
    
    if (!gitStatus || projectIndex < 0 || projectIndex >= currentProjects.length) {
      console.log(`[GIT-BG] ‚ùå Dados inv√°lidos para atualiza√ß√£o, ignorando:`, { 
        gitStatusExists: !!gitStatus,
        projectIndex,
        currentProjectsLength: currentProjects.length 
      });
      return;
    }
    
    const project = currentProjects[projectIndex];
    console.log(`[GIT-BG] üìã Processando projeto: ${project.name}`);
    
    // Atualiza os dados do projeto na mem√≥ria
    currentProjects[projectIndex] = {
      ...currentProjects[projectIndex],
      gitBranch: gitStatus.branch,
      pendingCommits: gitStatus.pendingCommits,
      hasUpdates: gitStatus.hasUpdates
    };
    
    const isPamp = project.name && project.name.startsWith('mp-pamp');
    console.log(`[GIT-BG] üè∑Ô∏è Projeto tipo: ${isPamp ? 'PAMP' : 'PAS'}`);
    
    // Atualiza a interface da branch - CORRIGIDO OS IDs
    const branchElementId = isPamp ? `pamp-branch-${projectIndex}` : `pas-branch-${projectIndex}`;
    let branchElement = document.getElementById(branchElementId);
    
    if (gitStatus.branch) {
      // Se o elemento de branch n√£o existe, cria dentro do container
      if (!branchElement) {
        const badgesContainerId = isPamp ? `pamp-version-badges-${projectIndex}` : `pas-version-badges-${projectIndex}`;
        const badgesContainer = document.getElementById(badgesContainerId);
        if (badgesContainer) {
          const branchSpan = document.createElement('span');
          branchSpan.id = branchElementId;
          const branchColor = isPamp ? '#28a745' : '#007bff';
          branchSpan.style.cssText = `background: ${branchColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;`;
          badgesContainer.appendChild(branchSpan);
          branchElement = branchSpan;
          console.log(`[GIT-BG] üÜï Badge de branch criado para ${project.name}`);
        }
      }
      
      if (branchElement) {
        branchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${gitStatus.branch}`;
        console.log(`[GIT-BG] ‚úÖ Branch atualizada para ${project.name}: ${gitStatus.branch}`);
      } else {
        console.log(`[GIT-BG] ‚ö†Ô∏è Elemento branch n√£o encontrado: ${branchElementId}`);
      }
    }
    
    // Atualiza o badge de commits pendentes - CORRIGIDO OS IDs
    const commitsElementId = isPamp ? `pamp-commits-${projectIndex}` : `pas-commits-${projectIndex}`;
    let commitsElement = document.getElementById(commitsElementId);
    console.log(`[GIT-BG] üîç Procurando elemento commits: ${commitsElementId}`, { existe: !!commitsElement });
    
    if (gitStatus.pendingCommits > 0) {
      console.log(`[GIT-BG] üìä ${gitStatus.pendingCommits} commits pendentes - criando/atualizando badge`);
      // Se n√£o existe o elemento, cria dentro do container de badges
      if (!commitsElement) {
        const badgesContainerId = isPamp ? `pamp-version-badges-${projectIndex}` : `pas-version-badges-${projectIndex}`;
        const badgesContainer = document.getElementById(badgesContainerId);
        if (badgesContainer) {
          const commitsSpan = document.createElement('span');
          commitsSpan.id = commitsElementId;
          commitsSpan.style.cssText = 'background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer;';
          commitsSpan.title = 'Clique para atualizar branch';
          commitsSpan.onclick = () => handleUpdateBranch(projectIndex, project.name, project.path, isPamp);
          badgesContainer.appendChild(commitsSpan);
          commitsElement = commitsSpan;
          console.log(`[GIT-BG] üÜï Badge de commits criado para ${project.name}`);
        } else {
          console.log(`[GIT-BG] ‚ùå N√£o foi poss√≠vel criar badge - container n√£o encontrado`);
        }
      }
      
      if (commitsElement) {
        commitsElement.innerHTML = `‚Üì ${gitStatus.pendingCommits}`;
        commitsElement.style.display = 'flex';
        commitsElement.style.background = '#ff6b35';
        commitsElement.style.cursor = 'pointer';
        commitsElement.title = 'Clique para atualizar branch';
        commitsElement.onclick = () => handleUpdateBranch(projectIndex, project.name, project.path, isPamp);
        console.log(`[GIT-BG] ‚úÖ Badge de commits atualizado para ${project.name}: ${gitStatus.pendingCommits} commits pendentes`);
      }
    } else {
      console.log(`[GIT-BG] ‚úÖ 0 commits pendentes - mostrando badge "Atualizado"`);
      // Mostra "Atualizado" quando n√£o h√° commits pendentes
      if (!commitsElement) {
        const badgesContainerId = isPamp ? `pamp-version-badges-${projectIndex}` : `pas-version-badges-${projectIndex}`;
        const badgesContainer = document.getElementById(badgesContainerId);
        if (badgesContainer) {
          const commitsSpan = document.createElement('span');
          commitsSpan.id = commitsElementId;
          commitsSpan.style.cssText = 'background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;';
          badgesContainer.appendChild(commitsSpan);
          commitsElement = commitsSpan;
          console.log(`[GIT-BG] üÜï Badge "Atualizado" criado para ${project.name}`);
        } else {
          console.log(`[GIT-BG] ‚ùå N√£o foi poss√≠vel criar badge "Atualizado" - container n√£o encontrado`);
        }
      }
      
      if (commitsElement) {
        commitsElement.innerHTML = '‚úì Atualizado';
        commitsElement.style.display = 'flex';
        commitsElement.style.background = '#28a745';
        commitsElement.style.cursor = 'default';
        commitsElement.title = 'Projeto est√° atualizado';
        commitsElement.onclick = null;
        console.log(`[GIT-BG] ‚úÖ Badge "Atualizado" mostrado para ${project.name} (0 commits pendentes)`);
      }
    }
    
    // Atualiza contadores se necess√°rio
    updateProjectCounters();
  });

  // ===== ATUALIZA√á√ÉO INICIAL DOS CONTADORES (REMOVIDA - AGORA FEITA AP√ìS CARREGAMENTO) =====
  // A atualiza√ß√£o dos contadores agora √© feita no final do handler 'projects-loaded'
  // para garantir que todos os dados Git estejam processados

  // IPC Listeners globais
  
  // Listener espec√≠fico para este projeto PAMP
  ipcRenderer.on('pamp-log', (event, { path, message, index, name, error, nodeVersionError, isImportant }) => {
    const pampLogDiv = document.getElementById(`pamp-log-${index}`);
    
    if (!message || !message.trim()) {
      return;
    }
    
    // ‚ö° NOVA L√ìGICA INTELIGENTE PARA REBUILDS E ERROS ‚ö°
    const lowerMessage = message.toLowerCase();
    
    // Detecta rebuilds e recompila√ß√µes
    const isRebuildMessage = 
      lowerMessage.includes('file change detected') ||
      lowerMessage.includes('rebuilding') ||
      lowerMessage.includes('recompiling') ||
      lowerMessage.includes('compilation started') ||
      lowerMessage.includes('webpack building') ||
      lowerMessage.includes('webpack compilation started') ||
      lowerMessage.includes('compiling') ||
      lowerMessage.includes('building') ||
      lowerMessage.includes('bundle generation') ||
      lowerMessage.includes('chunk ') ||
      lowerMessage.includes('emitted') ||
      lowerMessage.includes('hash:') ||
      lowerMessage.includes('time:') ||
      lowerMessage.includes('built at:');
    
    // Detecta compila√ß√£o completa
    const isCompilationComplete = 
      lowerMessage.includes('compiled successfully') ||
      lowerMessage.includes('compilation complete') ||
      lowerMessage.includes('webpack compiled') ||
      lowerMessage.includes('build complete') ||
      lowerMessage.includes('‚àö compiled successfully') ||
      lowerMessage.includes('‚úì compiled successfully') ||
      lowerMessage.includes('webpack: compiled successfully') ||
      lowerMessage.includes('compiled with') ||
      lowerMessage.includes('warnings but no errors') ||
      (lowerMessage.includes('compiled') && lowerMessage.includes('ms'));
    
    // Detecta warnings (N√ÉO devem ser tratados como erros cr√≠ticos)
    const isWarning = 
      lowerMessage.includes('warn') ||
      lowerMessage.includes('warning');
    
    // Detecta erros de compila√ß√£o (EXCETO warnings)
    const isCompilationError = 
      !isWarning && (
        lowerMessage.includes('compilation error') ||
        lowerMessage.includes('build error') ||
        lowerMessage.includes('typescript error') ||
        lowerMessage.includes('webpack error') ||
        lowerMessage.includes('failed to compile') ||
        lowerMessage.includes('compilation failed') ||
        lowerMessage.includes('build failed') ||
        (lowerMessage.includes('compiled with') && lowerMessage.includes('error'))
      );
    
    // Trata `error` do IPC: se √© warning, ignora o flag de erro
    const isTrueError = error === true && !isWarning;
    
    // üêõ DEBUG: Log para entender o que est√° acontecendo
    if (error === true) {
      console.log(`üêõ [DEBUG] error=true recebido | message="${message}" | isWarning=${isWarning} | isTrueError=${isTrueError}`);
    }

    // ‚ö° SEMPRE EXIBE REBUILDS, ERROS E MENSAGENS IMPORTANTES ‚ö°
    let shouldShow = isImportant || isRebuildMessage || isCompilationComplete || isCompilationError || isTrueError || isWarning;
    
    // Para outras mensagens, verifica duplica√ß√£o
    if (!shouldShow && pampLogDiv) {
      const currentText = pampLogDiv.innerText;
      const lines = currentText.split('\n');
      const lastLine = lines[lines.length - 1];
      
      // S√≥ ignora mensagens duplicadas que N√ÉO s√£o rebuilds, compila√ß√µes ou erros
      if (lastLine === message && 
          !message.includes('npm install') &&
          !isRebuildMessage &&
          !isCompilationComplete &&
          !isCompilationError) {
        return;
      }
      shouldShow = true;
    }

    if (!shouldShow) return;

    console.log(`üìù [PAMP-LOG] ${isImportant ? '[IMPORTANTE] ' : ''}${error ? '[ERRO] ' : ''}${message}`);
    
    if (pampLogDiv) {
      pampLogDiv.style.display = 'block';
      
      // ‚ö° FORMATA√á√ÉO ESPECIAL PARA DIFERENTES TIPOS DE MENSAGEM ‚ö°
      let formattedMessage = message;
      
      if (isWarning) {
        // Warnings n√£o recebem √≠cone de erro, apenas mostra a mensagem
        formattedMessage = message;
      } else if (isRebuildMessage) {
        formattedMessage = `üîÑ [REBUILD] ${message}`;
      } else if (isCompilationComplete) {
        formattedMessage = `‚úÖ [SUCESSO] ${message}`;
      } else if (isCompilationError || isTrueError) {
        formattedMessage = `‚ùå [ERRO] ${message}`;
      } else if (isImportant) {
        formattedMessage = `‚ö° [IMPORTANTE] ${message}`;
      }
      
      pampLogDiv.innerText += `\n${formattedMessage}`;
      pampLogDiv.scrollTop = pampLogDiv.scrollHeight;
      
      if (message.includes('existe em')) {
        console.log('Mensagem cont√©m "existe em", tentando extrair caminho');
        try {
          const existingPath = path;
          console.log(`Caminho extra√≠do: ${existingPath}`);
          
          const pampInput = document.getElementById(`pamp-input-${index}`);
          const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
          const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
          const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
          
          if (pampInput) {
            pampInput.value = existingPath;
            console.log(`Input atualizado com caminho: ${existingPath}`);
            
            if (pampDownloadButton) pampDownloadButton.style.display = 'none';
            if (pampStartButton) pampStartButton.disabled = false;
            if (pampDeleteButton) pampDeleteButton.style.display = 'inline-block';
            
            ipcRenderer.send('update-project-path', { index: index, path: existingPath });
          }
        } catch (error) {
          console.error('Erro ao extrair caminho:', error);
        }
      }

      // S√≥ mostra aviso de erro se a mensagem foi marcada explicitamente como erro
      if (data.error && message.includes('terminou com c√≥digo') && message.includes('1')) {
        const nodeVersionSpan = document.getElementById('node-version');
        const currentNodeVersion = nodeVersionSpan.innerText.replace('Node.js: ', '');
        
        let warningMessage;

        if (currentNodeVersion === 'v16.10.0') {
          warningMessage = `\n\n‚ö†Ô∏è AVISO: O projeto apresentou erro de compila√ß√£o. 
          Verifique seu c√≥digo fonte por poss√≠veis problemas como:
          ‚Ä¢ Depend√™ncias incompat√≠veis
          ‚Ä¢ Erros de sintaxe
          ‚Ä¢ Problemas de configura√ß√£o
          ‚Ä¢ Comandos de shell n√£o dispon√≠veis (como 'sed')`;
        } else {
          warningMessage = `\n\n‚ö†Ô∏è AVISO: O erro acima pode ser causado pela vers√£o incompat√≠vel do Node.js (${currentNodeVersion}).
          Projetos PAMP requerem Node.js v16.10.0. Por favor, instale a vers√£o correta para evitar erros de sintaxe.`;
        }
        
        if (pampLogDiv) {
          pampLogDiv.style.display = 'block';
          pampLogDiv.innerHTML += `<div style="color: yellow; margin-top: 10px; border-top: 1px solid #444; padding-top: 10px;">${warningMessage}</div>`;
          pampLogDiv.scrollTop = pampLogDiv.scrollHeight;
        }
      }
      
      if (message.includes('Caminho do projeto:') || message.includes('Projeto baixado')) {
        const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
        if (pampDownloadButton) pampDownloadButton.style.display = 'none';
      }
    } else {
      console.error(`Elemento log n√£o encontrado para √≠ndice ${index}`);
    }
  });
  
  // Listener para atualiza√ß√µes de status de projetos
  ipcRenderer.on('status-update', (event, { path, status, isPamp, index }) => {
    console.log(`*** FRONTEND STATUS UPDATE: path=${path}, status=${status}, isPamp=${isPamp}, index=${index}`);
    
    if (isPamp) {
      // Tratamento para projetos PAMP
      const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
      const pampCancelButton = document.getElementById(`pamp-btn-cancel-${index}`);
      const pampStopButton = document.getElementById(`pamp-btn-stop-${index}`);
      const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
      const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
      const pampFolderIcon = document.getElementById(`pamp-folder-icon-${index}`);
      
      console.log(`Atualizando status do projeto PAMP ${index} para ${status}`);
      
      if (status === 'running') {
        if (pampStartButton) {
          pampStartButton.innerText = 'Rodando ‚úì';
          pampStartButton.disabled = true;
          pampStartButton.style.backgroundColor = 'green';
          pampStartButton.style.color = 'white';
        }
        if (pampCancelButton) pampCancelButton.style.display = 'none';
        if (pampMoveButton) pampMoveButton.style.display = 'none';
        if (pampDeleteButton) pampDeleteButton.style.display = 'none';
        if (pampStopButton) pampStopButton.style.display = 'inline-block';
        if (pampFolderIcon) pampFolderIcon.classList.add('disabled');
      } else if (status === 'stopping') {
        if (pampStopButton) {
          pampStopButton.innerText = 'Parando...';
          pampStopButton.disabled = true;
        }
        if (pampMoveButton) pampMoveButton.disabled = true;
        if (pampDeleteButton) pampDeleteButton.disabled = true;
        if (pampFolderIcon) pampFolderIcon.classList.add('disabled');
      } else if (status === 'stopped') {
        if (pampStartButton) {
          pampStartButton.innerText = 'Iniciar';
          pampStartButton.disabled = false;
          pampStartButton.style.backgroundColor = '';
          pampStartButton.style.color = '';
        }
        if (pampCancelButton) pampCancelButton.style.display = 'none';
        if (pampStopButton) {
          pampStopButton.style.display = 'none';
          pampStopButton.disabled = false;
          pampStopButton.innerText = 'Parar';
        }
        if (pampMoveButton) {
          pampMoveButton.style.display = 'inline-block';
          pampMoveButton.disabled = false;
        }
        if (pampDeleteButton) {
          pampDeleteButton.style.display = 'inline-block';
          pampDeleteButton.disabled = false;
        }
        if (pampFolderIcon) pampFolderIcon.classList.remove('disabled');
      }
    } else {
      // Tratamento para projetos PAS
      let projectIndex = index;
      if (projectIndex === undefined || projectIndex === null) {
        projectIndex = currentProjects.findIndex((project) => project.path === path);
      }
      
      if (projectIndex !== -1) {
        const startButton = document.getElementById(`btn-start-${projectIndex}`);
        const cancelButton = document.getElementById(`btn-cancel-${projectIndex}`);
        const stopButton = document.getElementById(`btn-stop-${projectIndex}`);
        const moveButton = document.getElementById(`btn-move-${projectIndex}`);
        const deleteButton = document.getElementById(`btn-delete-${projectIndex}`);

        if (status === 'running') {
          if (startButton) {
            startButton.innerText = 'Rodando ‚úì';
            startButton.disabled = true;
            startButton.style.backgroundColor = 'green';
            startButton.style.color = 'white';
          }
          if (cancelButton) cancelButton.style.display = 'none';
          if (moveButton) moveButton.style.display = 'none';
          if (deleteButton) deleteButton.style.display = 'none';
          if (stopButton) stopButton.style.display = 'inline-block';
        } else if (status === 'stopping') {
          if (stopButton) {
            stopButton.innerText = 'Parando...';
            stopButton.disabled = true;
          }
          if (moveButton) moveButton.disabled = true;
          if (deleteButton) deleteButton.disabled = true;
        } else if (status === 'stopped') {
          if (startButton) {
            startButton.innerText = 'Iniciar';
            startButton.disabled = false;
            startButton.style.backgroundColor = '';
            startButton.style.color = 'black';
          }
          if (cancelButton) cancelButton.style.display = 'none';
          if (stopButton) {
            stopButton.style.display = 'none';
            stopButton.disabled = false;
            stopButton.innerText = 'Parar';
          }
          if (moveButton) {
            moveButton.style.display = 'inline-block';
            moveButton.disabled = false;
          }
          if (deleteButton) {
            deleteButton.style.display = 'inline-block';
            deleteButton.disabled = false;
          }
        }
      }
    }
  });

  // Outros listeners IPC necess√°rios
  
  ipcRenderer.on('delete-project-log', (event, { path, message, success, index }) => {
    let console = document.getElementById(`pamp-log-${index}`);
    if (!console) {
      console = document.getElementById(`log-${index}`);
    }
    
    if (console && message) {
      console.style.display = 'block';
      console.innerText += `\n${message}`;
      console.scrollTop = console.scrollHeight;
    }
    
    if(message && message.includes('pode encontrar o arquivo especificado')) {
      const deleteBtn = document.getElementById(`pamp-btn-delete-${index}`) || document.getElementById(`btn-delete-${index}`);
      const folderIcon = document.getElementById(`pamp-folder-icon-${index}`) || document.getElementById(`folder-icon-${index}`);
      if (deleteBtn) deleteBtn.disabled = false;
      if (folderIcon) folderIcon.classList.remove('disabled');
      return;
    }
    
     if (success) {
      const deleteBtn = document.getElementById(`pamp-btn-delete-${index}`) || document.getElementById(`btn-delete-${index}`);
      const moveBtn = document.getElementById(`pamp-btn-move-${index}`) || document.getElementById(`btn-move-${index}`);
      const downloadBtn = document.getElementById(`pamp-btn-download-${index}`) || document.getElementById(`btn-download-${index}`);
      const startBtn = document.getElementById(`pamp-btn-start-${index}`) || document.getElementById(`btn-start-${index}`);
      const stopBtn = document.getElementById(`pamp-btn-stop-${index}`) || document.getElementById(`btn-stop-${index}`);
      const input = document.getElementById(`pamp-input-${index}`) || document.getElementById(`input-${index}`);
      const folderIcon = document.getElementById(`pamp-folder-icon-${index}`) || document.getElementById(`folder-icon-${index}`);
      
      if (deleteBtn) deleteBtn.style.display = 'none';
      if (moveBtn) moveBtn.style.display = 'none';
      if (downloadBtn) downloadBtn.style.display = 'inline-block';
      if (startBtn) {
        startBtn.style.display = 'inline-block';
        startBtn.disabled = true;
      }
      if (stopBtn) stopBtn.style.display = 'none';
      if (input) {
        input.value = '';
      }
      if (folderIcon) folderIcon.classList.remove('disabled');
      
      setTimeout(() => {
        if (console) {
          console.innerText = '';
          console.style.display = 'none';
        }
      }, 2000);
    } else {
      const deleteBtn = document.getElementById(`pamp-btn-delete-${index}`) || document.getElementById(`btn-delete-${index}`);
      if (deleteBtn) deleteBtn.disabled = false;
    }
    });

  // Listeners para o processo de mover projetos
  ipcRenderer.on('move-project-log', (event, { index, message, success }) => {
    const pampLogDiv = document.getElementById(`pamp-log-${index}`);
    const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
    const logDiv = document.getElementById(`log-${index}`);
    const moveButton = document.getElementById(`btn-move-${index}`);
    
    if (pampLogDiv && pampMoveButton) {
      pampLogDiv.style.display = 'block';
      pampLogDiv.innerText += `\n${message}`;
      pampLogDiv.scrollTop = pampLogDiv.scrollHeight;
      
      pampMoveButton.disabled = false;
      pampMoveButton.innerText = 'Mover para...';
    } else if (logDiv && moveButton) {
      logDiv.style.display = 'block';
      logDiv.innerText += `\n${message}`;
      logDiv.scrollTop = logDiv.scrollHeight;
      
      moveButton.disabled = false;
      moveButton.innerText = 'Mover para...';
    }
  });

  ipcRenderer.on('update-project-path', (event, { index, path }) => {
    const project = currentProjects[index];
    const isPampProject = project && project.name && project.name.startsWith('mp-pamp');
    
    if (isPampProject) {
      const pampInput = document.getElementById(`pamp-input-${index}`);
      if (pampInput) {
        pampInput.value = path;
      } else {
        console.error(`Input PAMP n√£o encontrado para √≠ndice ${index}`);
      }
    } else {
      const input = document.getElementById(`input-${index}`);
      if (input) {
        input.value = path;
      } else {
        console.error(`Input PAS n√£o encontrado para √≠ndice ${index}`);
      }
    }
  });

  ipcRenderer.on('show-console', (event, { path, index, isPamp }) => {
    if (isPamp) {
      const pampLogDiv = document.getElementById(`pamp-log-${index}`);
      if (pampLogDiv) {
        pampLogDiv.style.display = 'block';
      }
    } else {
      const projectIndex = currentProjects.findIndex((project) => project.path === path);
      if (projectIndex !== -1) {
        const logDiv = document.getElementById(`log-${projectIndex}`);
        if (logDiv) {
          logDiv.style.display = 'block';
        }
      }
    }
  });

  // ===== NOVA FUN√á√ÉO PARA ATUALIZAR STATUS BADGE =====
  function updateNexusStatusBadge(isLoggedIn, message = '') {
    const statusBadge = document.getElementById('nexus-status-badge');
    const statusIcon = statusBadge.querySelector('.status-icon');
    const statusText = statusBadge.querySelector('.status-text');
    
    // Remove classes anteriores
    statusBadge.classList.remove('logged-in', 'logged-out', 'unknown');
    
    if (isLoggedIn === true) {
      statusBadge.classList.add('logged-in');
      statusText.textContent = 'Nexus Conectado';
      statusBadge.title = 'Logado com sucesso no Nexus';
    } else if (isLoggedIn === false) {
      statusBadge.classList.add('logged-out');
      statusText.textContent = 'Nexus Desconectado';
      statusBadge.title = 'N√£o logado no Nexus';
    } else {
      statusBadge.classList.add('unknown');
      statusText.textContent = 'Verificando Nexus...';
      statusBadge.title = 'Verificando status do Nexus';
    }
    
    // Adiciona detalhes extras se houver mensagem
    if (message) {
      statusBadge.title += ` - ${message}`;
    }
  }

  // Atualiza o status de login - VERS√ÉO MELHORADA
  ipcRenderer.on('log', (event, { message, path, error, isImportant }) => {
      // Atualiza sistema antigo para compatibilidade
      const statusDiv = document.getElementById('status');
      if (message.includes('Logado no Nexus com sucesso')) {
        statusDiv.innerText = 'Logado no Nexus ‚úì';
        statusDiv.style.background = 'green';
        // Atualiza novo sistema
        updateNexusStatusBadge(true, 'Login realizado com sucesso');
      } else if (message.includes('Erro no login')) {
        statusDiv.innerText = 'Erro no login ‚úó';
        statusDiv.style.background = 'red';
        // Atualiza novo sistema
        updateNexusStatusBadge(false, 'Erro no login');
      }
      
      // ‚ö° NOVA L√ìGICA MELHORADA PARA LOGS DE PROJETOS PAS ‚ö°
      const lowerMessage = message.toLowerCase();
      
      // Detecta rebuilds e recompila√ß√µes
      const isRebuildMessage = 
        lowerMessage.includes('file change detected') ||
        lowerMessage.includes('rebuilding') ||
        lowerMessage.includes('recompiling') ||
        lowerMessage.includes('compilation started') ||
        lowerMessage.includes('webpack building') ||
        lowerMessage.includes('webpack compilation started') ||
        lowerMessage.includes('compiling') ||
        lowerMessage.includes('building') ||
        lowerMessage.includes('bundle generation') ||
        lowerMessage.includes('chunk ') ||
        lowerMessage.includes('emitted') ||
        lowerMessage.includes('hash:') ||
        lowerMessage.includes('time:') ||
        lowerMessage.includes('built at:');
      
      // Detecta compila√ß√£o completa
      const isCompilationComplete = 
        lowerMessage.includes('compiled successfully') ||
        lowerMessage.includes('compilation complete') ||
        lowerMessage.includes('webpack compiled') ||
        lowerMessage.includes('build complete') ||
        lowerMessage.includes('‚àö compiled successfully') ||
        lowerMessage.includes('‚úì compiled successfully') ||
        lowerMessage.includes('webpack: compiled successfully') ||
        lowerMessage.includes('compiled with') ||
        lowerMessage.includes('warnings but no errors') ||
        (lowerMessage.includes('compiled') && lowerMessage.includes('ms'));
      
      // Detecta warnings (N√ÉO devem ser tratados como erros cr√≠ticos)
      const isWarning = 
        lowerMessage.includes('warn') ||
        lowerMessage.includes('warning');
      
      // Detecta erros de compila√ß√£o (EXCETO warnings)
      const isCompilationError = 
        !isWarning && (
          lowerMessage.includes('compilation error') ||
          lowerMessage.includes('build error') ||
          lowerMessage.includes('typescript error') ||
          lowerMessage.includes('webpack error') ||
          lowerMessage.includes('failed to compile') ||
          lowerMessage.includes('compilation failed') ||
          lowerMessage.includes('build failed') ||
          (lowerMessage.includes('compiled with') && lowerMessage.includes('error'))
        );
      
      // Trata `error` do IPC: se √© warning, ignora o flag de erro
      const isTrueError = error === true && !isWarning;
      
      // üêõ DEBUG: Log para entender o que est√° acontecendo
      if (error === true) {
        console.log(`üêõ [DEBUG-PAS] error=true recebido | message="${message}" | isWarning=${isWarning} | isTrueError=${isTrueError}`);
      }
      
      // Log messages para projetos espec√≠ficos
      currentProjects.forEach((project, index) => {
        if (project.path === path || message.includes(project.name)) {
            const logDiv = document.getElementById(`log-${index}`);
            if (logDiv) {
              // ‚ö° SEMPRE EXIBE REBUILDS, ERROS E MENSAGENS IMPORTANTES ‚ö°
              let shouldShow = isImportant || isRebuildMessage || isCompilationComplete || isCompilationError || isTrueError || isWarning;
              
              // Para outras mensagens, verifica duplica√ß√£o
              if (!shouldShow) {
                const currentText = logDiv.innerText;
                const lines = currentText.split('\n');
                const lastLine = lines[lines.length - 1];
                
                // S√≥ ignora mensagens duplicadas que N√ÉO s√£o rebuilds, compila√ß√µes ou erros
                if (lastLine === message && 
                    !isRebuildMessage &&
                    !isCompilationComplete &&
                    !isCompilationError) {
                  return;
                }
                shouldShow = true;
              }

              if (!shouldShow) return;

              console.log(`üìù [PAS-LOG] ${isImportant ? '[IMPORTANTE] ' : ''}${error ? '[ERRO] ' : ''}${message}`);
              
              logDiv.style.display = 'block';
              
              // ‚ö° FORMATA√á√ÉO ESPECIAL PARA DIFERENTES TIPOS DE MENSAGEM ‚ö°
              let formattedMessage = message;
              
              if (isWarning) {
                // Warnings n√£o recebem √≠cone de erro, apenas mostra a mensagem
                formattedMessage = message;
              } else if (isRebuildMessage) {
                formattedMessage = `üîÑ [REBUILD] ${message}`;
              } else if (isCompilationComplete) {
                formattedMessage = `‚úÖ [SUCESSO] ${message}`;
              } else if (isCompilationError || isTrueError) {
                formattedMessage = `‚ùå [ERRO] ${message}`;
              } else if (isImportant) {
                formattedMessage = `‚ö° [IMPORTANTE] ${message}`;
              }
              
              logDiv.innerText += `\n${formattedMessage}`;
              logDiv.scrollTop = logDiv.scrollHeight;

              if (message.includes('Caminho do projeto:')) {
                  const downloadButton = document.getElementById(`btn-download-${index}`);
                  if (downloadButton) downloadButton.style.display = 'none';
              }
            }
        }
      });
  });

  ipcRenderer.send('load-login-state');

  ipcRenderer.on('login-state', (event, isLoggedIn) => {
    // Atualiza sistema antigo para compatibilidade
    const statusDiv = document.getElementById('status');
    const pinterStatusDiv = document.getElementById('pinter-status');
    pinterStatusDiv.style.background = isLoggedIn ? 'green' : 'red';
    if (isLoggedIn) {
      statusDiv.innerText = 'Logado no Nexus ‚úì';
    } else {
      statusDiv.innerText = 'N√£o logado';
    }
    
    // Atualiza novo sistema de badge
    updateNexusStatusBadge(isLoggedIn, isLoggedIn ? 'Conectado automaticamente' : 'Necess√°rio fazer login');
  });

  // Solicita status das depend√™ncias Node.js port√°til
  ipcRenderer.send('check-dependencies-status');
  
  ipcRenderer.on('dependencies-status', (event, { installed, message, nodesPath }) => {
    const dependenciesStatusSpan = document.getElementById('dependencies-status');

    if (installed) {
      // ‚úÖ Depend√™ncias instaladas - Verde com tooltip e link
      dependenciesStatusSpan.innerHTML = `
        <span class="dependencies-container" style="position: relative; display: inline-block;">
          <span 
            class="dependencies-text"
            style="color: #4CAF50; font-weight: 500; cursor: help;"
            title="Node.js port√°til instalado localmente. Cada projeto usa sua vers√£o configurada."
          >
            ‚úîÔ∏è Depend√™ncias instaladas
          </span>
          <a 
            href="#" 
            class="open-folder-link"
            onclick="require('electron').ipcRenderer.send('open-nodes-folder', '${nodesPath.replace(/\\/g, '\\\\')}'); return false;" 
            style="
              position: absolute;
              right: -110px;
              top: 50%;
              transform: translateY(-50%);
              color: #0066cc;
              text-decoration: none;
              font-size: 11px;
              white-space: nowrap;
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              background: rgba(0, 0, 0, 0.7);
              padding: 2px 6px;
              border-radius: 4px;
            "
            title="Abrir pasta das depend√™ncias Node.js port√°teis"
          >
            üìÅ Abrir pasta
          </a>
        </span>
      `;
      
      // Mostra link ao passar o mouse
      const container = dependenciesStatusSpan.querySelector('.dependencies-container');
      const link = container.querySelector('.open-folder-link');
      
      // Mant√©m vis√≠vel quando o mouse est√° sobre o link
      let hideTimeout;
      const hideLink = () => {
        hideTimeout = setTimeout(() => {
          link.style.opacity = '0';
          link.style.pointerEvents = 'none';
        }, 100);
      };
      
      const cancelHide = () => {
        if (hideTimeout) clearTimeout(hideTimeout);
      };
      
      container.addEventListener('mouseenter', () => {
        cancelHide();
        link.style.opacity = '1';
        link.style.pointerEvents = 'auto';
      });
      
      container.addEventListener('mouseleave', hideLink);
      link.addEventListener('mouseenter', cancelHide);
      link.addEventListener('mouseleave', hideLink);
      
    } else {
      // ‚ùó Depend√™ncias n√£o instaladas - Vermelho com tooltip e link
      dependenciesStatusSpan.innerHTML = `
        <span class="dependencies-container" style="position: relative; display: inline-block;">
          <span 
            class="dependencies-text"
            style="color: #f44336; font-weight: 500; cursor: help;"
            title="Node.js port√°til n√£o instalado. Use o menu 'Depend√™ncias > Instalar Depend√™ncias Node.js' para instalar."
          >
            ‚ùó Depend√™ncias n√£o instaladas
          </span>
          <a 
            href="#" 
            class="open-folder-link"
            onclick="require('electron').ipcRenderer.send('open-nodes-folder', '${nodesPath.replace(/\\/g, '\\\\')}'); return false;" 
            style="
              position: absolute;
              right: -110px;
              top: 50%;
              transform: translateY(-50%);
              color: #0066cc;
              text-decoration: none;
              font-size: 11px;
              white-space: nowrap;
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              background: rgba(0, 0, 0, 0.7);
              padding: 2px 6px;
              border-radius: 4px;
            "
            title="Abrir pasta onde as depend√™ncias devem ser instaladas"
          >
            üìÅ Abrir pasta
          </a>
        </span>
      `;
      
      // Mostra link ao passar o mouse
      const container = dependenciesStatusSpan.querySelector('.dependencies-container');
      const link = container.querySelector('.open-folder-link');
      
      // Mant√©m vis√≠vel quando o mouse est√° sobre o link
      let hideTimeout;
      const hideLink = () => {
        hideTimeout = setTimeout(() => {
          link.style.opacity = '0';
          link.style.pointerEvents = 'none';
        }, 100);
      };
      
      const cancelHide = () => {
        if (hideTimeout) clearTimeout(hideTimeout);
      };
      
      container.addEventListener('mouseenter', () => {
        cancelHide();
        link.style.opacity = '1';
        link.style.pointerEvents = 'auto';
      });
      
      container.addEventListener('mouseleave', hideLink);
      link.addEventListener('mouseenter', cancelHide);
      link.addEventListener('mouseleave', hideLink);
    }
  });

  // Outros handlers IPC necess√°rios
  ipcRenderer.on('update-project', (event, { index, path }) => {
    const project = currentProjects[index];
    const isPampProject = project && project.name && project.name.startsWith('mp-pamp');
    
    if(isPampProject) {
      const pampInput = document.getElementById(`pamp-input-${index}`);
      const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
      const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
      const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
      const pampFolderIcon = document.getElementById(`pamp-folder-icon-${index}`);
  
      if (pampInput) pampInput.value = path;
      if (pampInput) pampInput.disabled = false;
      if (pampMoveButton) pampMoveButton.style.display = 'none';
      if (pampDeleteButton) pampDeleteButton.style.display = 'none';
      if (pampDownloadButton) pampDownloadButton.style.display = 'inline-block';
      if (pampFolderIcon) pampFolderIcon.classList.remove('disabled');
    }else {
      const input = document.getElementById(`input-${index}`);
      const moveButton = document.getElementById(`btn-move-${index}`);
      const deleteButton = document.getElementById(`btn-delete-${index}`);
      const browseButton = document.getElementById(`btn-browse-${index}`);
      const downloadButton = document.getElementById(`btn-download-${index}`);
    
      if (input) input.value = path;
      if (input) input.disabled = false;
      if (moveButton) moveButton.style.display = 'none';
      if (deleteButton) deleteButton.style.display = 'none';
      if (browseButton) browseButton.style.display = 'inline-block';
      if (downloadButton) downloadButton.style.display = 'inline-block';
    }
  });
  
  ipcRenderer.on('pamp-process-error', (event, { path, index }) => {
    console.log(`Projeto PAMP com erro, resetando bot√µes para √≠ndice ${index}`);
    const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
    const pampCancelButton = document.getElementById(`pamp-btn-cancel-${index}`);
    const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
    const pampFolderIcon = document.getElementById(`pamp-folder-icon-${index}`);
    
    if (pampStartButton) {
      pampStartButton.disabled = false;
      pampStartButton.innerText = 'Iniciar';
    }
    
    if (pampCancelButton) {
      pampCancelButton.style.display = 'none';
    }
    
    if (pampDeleteButton) {
      pampDeleteButton.disabled = false;
      pampDeleteButton.style.display = 'inline-block';
    }
    
    if (pampFolderIcon) {
      pampFolderIcon.classList.remove('disabled');
    }
  });
  
  ipcRenderer.on('process-error', (event, { path }) => {
    const projectIndex = currentProjects.findIndex(p => p.path === path);
    if (projectIndex !== -1) {
      const startButton = document.getElementById(`btn-start-${projectIndex}`);
      const cancelButton = document.getElementById(`btn-cancel-${projectIndex}`);
      const deleteButton = document.getElementById(`btn-delete-${projectIndex}`);
      
      if (startButton) {
        startButton.disabled = false;
        startButton.innerText = 'Iniciar';
        startButton.style.backgroundColor = '';
        startButton.style.color = 'black';
      }
      
      if (cancelButton) {
        cancelButton.style.display = 'none';
      }
      
      if (deleteButton) {
        deleteButton.disabled = false;
        deleteButton.style.display = 'inline-block';
      }
    }
  });

  ipcRenderer.on('project-path-selected', (event, { index, path, projectName }) => {
    console.log(`Recebida resposta do browse: projeto ${projectName}, √≠ndice ${index}, caminho ${path}`);
    
    const pampInput = document.getElementById(`pamp-input-${index}`);
    const pasInput = document.getElementById(`input-${index}`);
    
    if (pampInput) {
      pampInput.value = path;
      
      const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
      const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
      const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
      const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
      
      if (pampDownloadButton) pampDownloadButton.style.display = 'none';
      if (pampStartButton) pampStartButton.disabled = false;
      if (pampMoveButton) pampMoveButton.style.display = 'inline-block';
      if (pampDeleteButton) pampDeleteButton.style.display = 'inline-block';
    }
    
    if (pasInput) {
      pasInput.value = path;
      
      const downloadButton = document.getElementById(`btn-download-${index}`);
      const startButton = document.getElementById(`btn-start-${index}`);
      const moveButton = document.getElementById(`btn-move-${index}`);
      const deleteButton = document.getElementById(`btn-delete-${index}`);
      
      if (downloadButton) downloadButton.style.display = 'none';
      if (startButton) startButton.disabled = false;
      if (moveButton) moveButton.style.display = 'inline-block';
      if (deleteButton) deleteButton.style.display = 'inline-block';
    }
    
    ipcRenderer.send('update-project-path', { index: index, path: path });
  });

  // ‚ö° LISTENERS PARA ATUALIZA√á√ÉO DE BRANCHES GIT ‚ö°
  
  // Listener para atualiza√ß√£o de branch enviada do main process quando projeto √© iniciado
  ipcRenderer.on('update-project-branch', (event, { index, branch, path }) => {
    console.log(`üåø [Frontend] Atualizando branch do projeto ${index}: ${branch}`);
    updateProjectBranchDisplay(index, branch, path);
  });

  // Listener para resposta da atualiza√ß√£o manual de branch
  ipcRenderer.on('project-branch-updated', (event, { index, branch, path }) => {
    console.log(`üåø [Frontend] Branch atualizada manualmente para projeto ${index}: ${branch}`);
    updateProjectBranchDisplay(index, branch, path);
  });

  // ‚ö° FUN√á√ÉO PARA ATUALIZAR EXIBI√á√ÉO DA BRANCH ‚ö°
  function updateProjectBranchDisplay(index, branch, path) {
    // Atualiza em projetos PAMP
    const pampBranchElement = document.getElementById(`pamp-branch-${index}`);
    if (pampBranchElement) {
      pampBranchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${branch}`;
      console.log(`üåø Branch PAMP atualizada para √≠ndice ${index}: ${branch}`);
    }

    // Atualiza em projetos PAS
    const pasBranchElement = document.getElementById(`pas-branch-${index}`);
    if (pasBranchElement) {
      pasBranchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${branch}`;
      console.log(`üåø Branch PAS atualizada para √≠ndice ${index}: ${branch}`);
    }

    // Se n√£o existe elemento de branch, cria um novo
    if (!pampBranchElement && !pasBranchElement) {
      const projectCard = document.querySelector(`#pamp-input-${index}, #input-${index}`)?.closest('.project-card');
      if (projectCard) {
        const projectNameContainer = projectCard.querySelector('div > div');
        if (projectNameContainer) {
          // Determina se √© projeto PAMP ou PAS
          const isPamp = !!document.getElementById(`pamp-input-${index}`);
          const branchColor = isPamp ? '#28a745' : '#007bff';
          const branchId = isPamp ? `pamp-branch-${index}` : `pas-branch-${index}`;
          
          // Cria o elemento de branch
          const branchElement = document.createElement('span');
          branchElement.id = branchId;
          branchElement.style.cssText = `background: ${branchColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;`;
          branchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${branch}`;
          
          projectNameContainer.appendChild(branchElement);
          console.log(`üåø Novo elemento de branch criado para √≠ndice ${index}: ${branch}`);
        }
      }
    }

    // Atualiza o array de projetos local
    if (currentProjects[index]) {
      currentProjects[index].gitBranch = branch;
    }
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR CONTADORES DOS PROJETOS =====
  function updateProjectCounters() {
    // Conta projetos PAMP
    const pampCount = document.getElementById('pamp-mfes').querySelectorAll('.project-card').length;
    const pampCountElement = document.getElementById('pamp-count');
    if (pampCountElement) {
      pampCountElement.textContent = pampCount.toString();
    }
    
    // Conta projetos PAS
    const pasCount = document.getElementById('projects').querySelectorAll('.project-card').length;
    const pasCountElement = document.getElementById('pas-count');
    if (pasCountElement) {
      pasCountElement.textContent = pasCount.toString();
    }
    
    console.log(`üìä Contadores atualizados: PAMP Admin=${pampCount}, PAS Site=${pasCount}`);
  }

  // ===== FUN√á√ïES PARA GERENCIAR PORTA DOS PROJETOS =====
  function updatePortDisplay(projectIndex, port, status, isPamp) {
    const portElementId = isPamp ? `pamp-port-${projectIndex}` : `port-${projectIndex}`;
    const portElement = document.getElementById(portElementId);
    
    if (!portElement) {
      console.log(`‚ö†Ô∏è Elemento porta n√£o encontrado: ${portElementId}`);
      return;
    }
    
    console.log(`üîå Atualizando porta para projeto ${projectIndex}: porta ${port}, status ${status}, PAMP: ${isPamp}`);
    
    // Remove classes de status anteriores
    portElement.classList.remove('port-starting', 'port-in-use', 'port-running');
    
    if (status === 'starting') {
      // Laranja - projeto iniciando, porta definida mas ainda n√£o dispon√≠vel
      portElement.style.display = 'inline-flex';
      portElement.style.backgroundColor = '#ff8c00';
      portElement.style.color = 'white';
      portElement.textContent = `Porta: ${port}`;
      portElement.style.cursor = 'default';
      portElement.title = 'Projeto iniciando...';
      portElement.onclick = null;
      portElement.classList.add('port-starting');
      
      // Atualiza tooltip com a porta atual (apenas para PAMP)
      updateTooltipWithPort(projectIndex, port, isPamp);
    } else if (status === 'in-use') {
      // Vermelho - porta em uso, tentando liberar
      portElement.style.display = 'inline-flex';
      portElement.style.backgroundColor = '#dc3545';
      portElement.style.color = 'white';
      portElement.textContent = `Porta: ${port}`;
      portElement.style.cursor = 'default';
      portElement.title = 'Porta em uso, tentando liberar...';
      portElement.onclick = null;
      portElement.classList.add('port-in-use');
      
      // Atualiza tooltip com a porta atual (apenas para PAMP)
      updateTooltipWithPort(projectIndex, port, isPamp);
    } else if (status === 'running') {
      // Verde - projeto rodando, porta clic√°vel
      portElement.style.display = 'inline-flex';
      portElement.style.backgroundColor = '#28a745';
      portElement.style.color = 'white';
      portElement.textContent = `Porta: ${port}`;
      portElement.style.cursor = 'pointer';
      portElement.title = 'Clique para abrir no navegador';
      portElement.classList.add('port-running');
      
      // Atualiza tooltip com a porta atual (apenas para PAMP)
      updateTooltipWithPort(projectIndex, port, isPamp);
      
      portElement.onclick = () => {
        // Define a URL base baseada no tipo de projeto
        let baseUrl;
        if (isPamp) {
          // PAMP projects always open on the root port 4200
          baseUrl = 'http://localhost:4200';
        } else {
          // PAS projects open on the PAS root port 9000
          baseUrl = 'http://localhost:9000';
        }
        
        console.log(`üåê Abrindo navegador: ${baseUrl} (projeto ${isPamp ? 'PAMP' : 'PAS'} detectado na porta ${port})`);
        // Send message to main process to open browser
        require('electron').ipcRenderer.send('open-browser', { url: baseUrl });
      };
    }
  }

  function removePortDisplay(projectIndex, isPamp) {
    const portElementId = isPamp ? `pamp-port-${projectIndex}` : `port-${projectIndex}`;
    const portElement = document.getElementById(portElementId);
    
    if (portElement) {
      portElement.style.display = 'none';
      portElement.onclick = null;
      console.log(`üîå Porta removida para projeto ${projectIndex} (${isPamp ? 'PAMP' : 'PAS'})`);
    }
  }

  // ===== LISTENERS IPC PARA PORTA =====
  ipcRenderer.on('port-detected', (event, { projectIndex, port, status, isPamp }) => {
    console.log(`üì° Port detected IPC recebido:`, { projectIndex, port, status, isPamp });
    updatePortDisplay(projectIndex, port, status, isPamp);
  });

  ipcRenderer.on('port-removed', (event, { projectIndex, isPamp }) => {
    console.log(`üì° Port removed IPC recebido:`, { projectIndex, isPamp });
    removePortDisplay(projectIndex, isPamp);
  });

  // Initialize UI after DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    applyTheme();
  });

  // Fun√ß√£o para mostrar/esconder badges de vers√£o
  function toggleVersionBadges(projectIndex, isPamp) {
    const prefix = isPamp ? 'pamp' : 'pas';
    const container = document.getElementById(`${prefix}-version-badges-${projectIndex}`);
    const btn = event.target; // O bot√£o que foi clicado
    
    if (!container) return;
    
    if (container.classList.contains('visible')) {
      // Esconder badges
      container.classList.remove('visible');
      btn.textContent = '‚Ä∫';
      btn.title = 'Mostrar badges';
    } else {
      // Mostrar badges
      container.classList.add('visible');
      btn.textContent = '‚Äπ';
      btn.title = 'Esconder badges';
    }
  }

  // Fun√ß√£o para atualizar badges de vers√£o de um projeto espec√≠fico
  async function updateProjectVersionBadges(projectName, projectIndex, isPamp = false) {
    try {
      // Buscar configura√ß√µes de vers√£o de Node para todos os projetos
      const versionConfigs = await ipcRenderer.invoke('get-all-node-versions');
      
      // Mapeamento de vers√µes Node -> Angular CLI (sincronizado com node-version-config.js)
      const nodeToAngularMap = {
        '16.10.0': '13.3.11',
        '18.18.2': '15.2.10',
        '20.19.5': '18.2.0'
      };

      // Busca a vers√£o configurada para este projeto ou usa padr√£o
      let nodeVersion = versionConfigs[projectName];
      
      // Se n√£o tem configura√ß√£o, busca o padr√£o do projeto
      if (!nodeVersion) {
        // Valores padr√£o baseados no nome do projeto
        if (projectName === 'mp-pas-configuracoes') {
          nodeVersion = '18.18.2';
        } else {
          nodeVersion = '16.10.0';
        }
      }

      const angularVersion = nodeToAngularMap[nodeVersion] || 'N/A';
      
      // Determina o prefixo do ID baseado no tipo de projeto
      const prefix = isPamp ? 'pamp' : 'pas';

      // Atualiza badges do projeto
      const nodeBadge = document.getElementById(`${prefix}-node-version-${projectIndex}`);
      const angularBadge = document.getElementById(`${prefix}-angular-version-${projectIndex}`);

      if (nodeBadge) {
        nodeBadge.querySelector('.version-text').textContent = nodeVersion;
        nodeBadge.title = `Node.js ${nodeVersion}`;
      }

      if (angularBadge) {
        angularBadge.querySelector('.version-text').textContent = angularVersion;
        angularBadge.title = `Angular CLI ${angularVersion}`;
      }

      console.log(`‚úÖ Badges do projeto ${projectName} atualizados: Node ${nodeVersion}, Angular CLI ${angularVersion}`);
    } catch (error) {
      console.error(`‚ùå Erro ao atualizar badges do projeto ${projectName}:`, error);
    }
  }

  // Atualiza todos os badges de vers√£o dos projetos carregados
  async function updateAllProjectVersionBadges() {
    if (!currentProjects || currentProjects.length === 0) {
      console.log('‚ö†Ô∏è Nenhum projeto carregado ainda');
      return;
    }

    console.log('üîÑ Atualizando badges de vers√£o de todos os projetos...');
    
    for (let i = 0; i < currentProjects.length; i++) {
      const project = currentProjects[i];
      const isPamp = project.name && (project.name.startsWith('mp-pamp') || project.name === 'mp-pamp');
      await updateProjectVersionBadges(project.name, i, isPamp);
    }
  }

  // Atualiza badges quando as configura√ß√µes s√£o alteradas
  ipcRenderer.on('node-versions-updated', () => {
    console.log('üîÑ Configura√ß√µes de vers√£o atualizadas, recarregando badges...');
    updateAllProjectVersionBadges();
  });
</script>
</body>
</html>