<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Front-end Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      /* Aplica a fonte Fira Code em todo o app */
      body {
        font-family: 'Fira Code', monospace;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
        color: #333;
        width: 100%;
        box-sizing: border-box;
        overflow-x: hidden;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      #onboarding-mfes #onboarding-content {
        width: 100% !important;
      }

      @media screen and (max-width: 801px) {
        body {
          max-width: 95vw;
        }
      }

      @media screen and (min-width: 1600px) {
        body {
          max-width: 70vw;
          margin: 0 auto;
        }
        .project-card {
          width: 47% !important;
        }
      }
      
    /* Modo Escuro */
    body.dark-mode {
      background-color: #1e1e1e;
      color: #ffffff;
    }

    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      margin-bottom: 20px;
    }

     h1 {
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
      transition: border-color 0.3s ease;
    }

    body.dark-mode h1 {
      border-bottom-color: #555;
    }

    .main-title {
      font-size: 16px;
      font-weight: 400;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
      transition: border-color 0.3s ease;
    }

    body.dark-mode .main-title {
      border-bottom-color: #555;
    }

    input, button {
      font-family: 'Fira Code', monospace;
    }

    button {
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background-color: #f0f0f0;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #e0e0e0;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Container para os controles principais */
    .main-controls {
      margin-bottom: 20px;
    }

    /* Estilos para MFEs containers */
    #pamp-mfes, #projects {
      width: 100%;
      margin-top: 15px;
      justify-content: space-evenly;
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
    }

    /* Estilos para os cards de projeto */
    .project-card {
      width: 700px;
      margin-bottom: 10px;
      position: relative;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 5px;
      background-color: #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }


    body.dark-mode .project-card {
      background-color: #2d2d2d;
      border-color: #555;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    /* Status indicators - Nova vers√£o com layout flex√≠vel */
    .status-container {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      font-size: 10px;
      font-weight: 400;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
      text-transform: none;
      letter-spacing: 0px;
    }

    .status-badge.logged-in {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
    }

    .status-badge.logged-out {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    .status-badge.unknown {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    .status-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .status-badge .status-icon {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Badges de Vers√£o (Node.js e Angular) */
    .version-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      font-size: 11px;
      font-weight: bold;
      border-radius: 12px;
      transition: all 0.2s ease;
      cursor: help;
    }

    .version-badge.node {
      background: #68a063;
      color: white;
    }

    .version-badge.angular {
      background: #dd0031;
      color: white;
    }

    .version-badge:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      opacity: 0.9;
    }

    .version-badge img {
      width: 12px;
      height: 12px;
      object-fit: contain;
    }

    .version-badge .version-text {
      font-weight: bold;
    }

    /* Bot√£o de toggle para mostrar/esconder badges */
    .toggle-versions-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 4px;
      color: #ffffff;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }

    .toggle-versions-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .toggle-versions-btn:active {
      transform: scale(0.95);
    }

    /* Badges escondidos por padr√£o */
    .version-badges-container {
      display: none;
      gap: 8px;
    }

    .version-badges-container.visible {
      display: inline-flex;
    }

    /* Remover estilos antigos */
    #pinter-status, #status {
      display: none !important;
    }

    /* ===== SISTEMA DE ABAS (TABS) ===== */
    .toggle-buttons-container {
      display: flex;
      gap: 0;
      margin-bottom: 0;
      border-bottom: 2px solid #ddd;
    }

    body.dark-mode .toggle-buttons-container {
      border-bottom-color: #444;
    }

    .toggle-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      border-radius: 0;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .toggle-btn .toggle-text {
      font-weight: 500;
    }

    .toggle-btn .toggle-count {
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 4px;
    }

    /* ==== TEMA CLARO (Light Mode) ==== */
    body:not(.dark-mode) .toggle-btn {
      color: #666;
    }

    body:not(.dark-mode) .toggle-btn:hover {
      color: #000;
      background-color: rgba(0, 0, 0, 0.02);
    }

    body:not(.dark-mode) .toggle-btn.expanded {
      color: #000;
      border-bottom-color: #000;
      font-weight: 600;
    }

    body:not(.dark-mode) .toggle-btn .toggle-count {
      background: #e0e0e0;
      color: #666;
    }

    body:not(.dark-mode) .toggle-btn.expanded .toggle-count {
      background: #000;
      color: #fff;
    }

    /* ==== TEMA ESCURO (Dark Mode) ==== */
    body.dark-mode .toggle-btn {
      color: #999;
    }

    body.dark-mode .toggle-btn:hover {
      color: #fff;
      background-color: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode .toggle-btn.expanded {
      color: #fff;
      border-bottom-color: #fff;
      font-weight: 600;
    }

    body.dark-mode .toggle-btn .toggle-count {
      background: #444;
      color: #999;
    }

    body.dark-mode .toggle-btn.expanded .toggle-count {
      background: #fff;
      color: #000;
    }

    /* For√ßa visibilidade do bot√£o onboarding */
    #toggle-onboarding-mfes {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
    }

    /* Version info */
    .version-info {
      margin-top: 10px;
      margin-bottom: 20px;
    }

    /* Input com √≠cone de pasta */
    .input-with-folder {
      position: relative;
      display: block;
      width: 100%;
      box-sizing: border-box;
    }

    .folder-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      cursor: pointer;
      z-index: 10;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .folder-icon:hover {
      opacity: 1;
    }

    .folder-icon:disabled,
    .folder-icon.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Ajusta o padding do input para dar espa√ßo ao √≠cone */
    .input-with-folder input {
      width: 100% !important;
      box-sizing: border-box !important;
      padding-right: 35px !important;
      padding-left: 8px !important;
      padding-top: 6px !important;
      padding-bottom: 6px !important;
      background-color: #ffffff;
      border: 1px solid #ccc;
      color: #333;
      transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }

    /* Estilos para inputs no modo escuro */
    body.dark-mode input {
      background-color: #3a3a3a;
      border-color: #555;
      color: #ffffff;
    }

    body.dark-mode input::placeholder {
      color: #aaa;
    }

    /* Console logs no modo escuro */
    body.dark-mode div[id*="log-"] {
      background: #000 !important;
      color: #0f0 !important;
    }

    /* Estilos para exibi√ß√£o de porta */
    span[id*="port-"], span[id*="pamp-port-"] {
      display: inline-block;
      padding: 8px 12px; /* Mesmo padding dos bot√µes */
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      white-space: nowrap;
      transition: all 0.3s ease;
      user-select: none;
      height: auto; /* Altura autom√°tica para coincidir com bot√µes */
      line-height: 1.2; /* Line height consistente */
      vertical-align: middle; /* Alinhamento vertical */
      box-sizing: border-box; /* Include padding in height calculation */
      min-height: 32px; /* Altura m√≠nima igual aos bot√µes */
      display: inline-flex; /* Flexbox para melhor alinhamento */
      align-items: center; /* Centralizar verticalmente o texto */
      justify-content: center; /* Centralizar horizontalmente o texto */
    }

    /* Port status colors */
    .port-starting {
      background-color: #ff8c00 !important;
      color: white !important;
      cursor: default !important;
    }

    .port-in-use {
      background-color: #dc3545 !important;
      color: white !important;
      cursor: default !important;
    }

    .port-running {
      background-color: #28a745 !important;
      color: white !important;
      cursor: pointer !important;
    }

    .port-running:hover {
      background-color: #218838 !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* Help icon styles */
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: #007acc;
      color: white;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      margin-left: 5px;
      transition: all 0.3s ease;
      position: relative;
      vertical-align: middle;
    }

    .help-icon:hover {
      background-color: #005a9e;
      transform: scale(1.1);
    }

    /* Editor icon styles */
    .editor-icon {
      width: 24px;
      height: 24px;
      cursor: pointer;
      opacity: 0.8;
      transition: all 0.3s ease;
      margin-right: 5px;
    }

    .editor-icon:hover {
      opacity: 1;
      transform: scale(1.05);
    }

    .editor-icon.disabled {
      opacity: 0.3;
      cursor: not-allowed;
      pointer-events: none;
    }

    body.dark-mode .help-icon {
      background-color: #4CAF50;
    }

    body.dark-mode .help-icon:hover {
      background-color: #45a049;
    }

    /* Tooltip styles */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 380px;
      background-color: #2c2c2c;
      color: #fff;
      text-align: left;
      border-radius: 8px;
      padding: 16px;
      position: fixed;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      font-size: 13px;
      line-height: 1.5;
      box-shadow: 0 8px 16px rgba(0,0,0,0.4);
      border: 1px solid #555;
      max-height: 400px;
      overflow-y: auto;
    }

    /* Tooltip fica vis√≠vel quando hover no container pai OU no pr√≥prio tooltip */
    .tooltip:hover .tooltiptext,
    .tooltiptext:hover {
      visibility: visible;
      opacity: 1;
    }

    /* Estilo especial para manter tooltip vis√≠vel */
    .tooltip .tooltiptext.show {
      visibility: visible;
      opacity: 1;
    }

    /* Remove a seta por enquanto para simplificar */
    .tooltip .tooltiptext::after {
      display: none;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    body.dark-mode .tooltip .tooltiptext {
      background-color: #333;
      border: 1px solid #555;
    }

    body.dark-mode .tooltip .tooltiptext::after {
      border-color: #333 transparent transparent transparent;
    }

    .tooltip-link {
      color: #4CAF50;
      text-decoration: underline;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .tooltip-link:hover {
      color: #45a049;
    }

    .tooltip-link.disabled {
      color: #888;
      cursor: not-allowed;
      opacity: 0.5;
      pointer-events: none;
    }

    /* Dark mode compatibility for port display */
    body.dark-mode .port-starting,
    body.dark-mode .port-in-use,
    body.dark-mode .port-running {
      box-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body>
  <div class="main-title">
    Front-end Manager <span style="font-size: 14px; color: #666;">v0.0.12</span>
    <span id="dependencies-status" style="font-size: 12px; margin-left: 10px;"></span>
    <span style="font-size: 10px; margin-left: 20px; color: #666; font-style: italic;" title="Atalhos para reiniciar">
      üí° Ctrl+R ou F5 = Reiniciar
    </span>
  </div>

  <!-- Nova se√ß√£o de status com layout melhorado -->
  <div class="status-container">
    <div id="nexus-status-badge" class="status-badge unknown" title="Status do login no Nexus">
      <span class="status-icon"></span>
      <span class="status-text">Verificando Nexus...</span>
    </div>
  </div>

  <!-- Elementos antigos mantidos para compatibilidade (ocultos) -->
  <div id="pinter-status"></div>
  <div id="status" title="N√£o logado"></div>
  
  <div class="main-controls">
    <!-- Bot√µes Toggle Modernos para MFEs -->
    <div class="toggle-buttons-container">
      <button id="toggle-mfes" class="toggle-btn pas-btn">
        <span class="toggle-text">PAS</span>
        <span class="toggle-count" id="pas-count">0</span>
      </button>
      <button id="toggle-pamp-mfes" class="toggle-btn pamp-btn">
        <span class="toggle-text">PAMP</span>
        <span class="toggle-count" id="pamp-count">0</span>
      </button>
      <button id="toggle-onboarding-mfes" class="toggle-btn onboarding-btn">
        <span class="toggle-text">Onboarding</span>
        <span class="toggle-count" id="onboarding-count">0</span>
      </button>
    </div>
  </div>
  
  <div id="pamp-mfes" style="display: none;"></div>
  <div id="projects" style="display: none;"></div>
  <div id="onboarding-mfes" style="display: none;">
    <!-- Container para carregar conte√∫do do onboarding -->
    <div id="onboarding-content">
      <!-- Conte√∫do ser√° carregado aqui -->
    </div>
  </div>

  <!-- Container para configura√ß√£o Node.js Onboarding -->
  <div id="onboarding-node-config" style="display: none;">
    <div class="onboarding-container">
      <h1>‚öôÔ∏è Configura√ß√£o Node.js - Projetos Onboarding</h1>
      <p class="onboarding-subtitle">Selecione a vers√£o do Node.js para cada projeto</p>

      <div class="onboarding-info-box">
        <strong>‚ÑπÔ∏è Informa√ß√£o:</strong>
        Cada projeto pode usar uma vers√£o diferente do Node.js.
        Os projetos Onboarding usam React e n√£o precisam do Angular CLI.
        As altera√ß√µes s√£o salvas automaticamente.
        <br><br>
        üìö <strong>Refer√™ncia de Compatibilidade:</strong>
        <a href="#" onclick="require('electron').shell.openExternal('https://nodejs.org/en/download/releases'); return false;" 
           style="color: #4CAF50; text-decoration: none;">
            Node.js Release Schedule
        </a>
      </div>

      <div class="onboarding-project-list" id="onboarding-project-list">
        <!-- Projetos ser√£o inseridos aqui via JavaScript -->
      </div>
    </div>
  </div>

  <style>
    /* Estilos espec√≠ficos para configura√ß√£o Node.js Onboarding */
    .onboarding-container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s, border-color 0.3s;
      min-height: calc(100vh - 40px);
    }

    body.dark-mode .onboarding-container {
      background: #2d2d2d;
      border-color: #444;
    }

    .onboarding-container h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 28px;
      color: var(--text-color);
    }

    .onboarding-subtitle {
      text-align: center;
      opacity: 0.9;
      margin-bottom: 30px;
      font-size: 14px;
      color: var(--text-color);
    }

    .onboarding-info-box {
      background: #f9f9f9;
      border-left: 4px solid #333;
      padding: 15px;
      border: 1px solid #ddd;
      border-left-width: 4px;
      border-radius: 3px;
      margin-bottom: 20px;
      font-size: 13px;
      line-height: 1.6;
      color: #333;
    }

    body.dark-mode .onboarding-info-box {
      background: #3a3a3a;
      border-color: #555;
      border-left-color: #777;
      color: #fff;
    }

    .onboarding-info-box strong {
      display: block;
      margin-bottom: 5px;
    }

    .onboarding-project-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .onboarding-project-item {
      background: #f9f9f9;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      display: flex;
      align-items: center;
      gap: 30px;
      margin-bottom: 15px;
      transition: all 0.2s ease;
    }

    body.dark-mode .onboarding-project-item {
      background: #3a3a3a;
      border-color: #555;
    }

    .onboarding-project-item:hover {
      background: #f0f0f0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .onboarding-project-item:hover {
      background: #444;
    }

    .onboarding-project-info {
      min-width: 280px;
      max-width: 320px;
      flex: 0 0 auto;
    }

    .onboarding-project-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    body.dark-mode .onboarding-project-name {
      color: #e0e0e0;
    }

    .onboarding-project-path {
      font-size: 11px;
      color: #666;
      font-family: 'Courier New', monospace;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    body.dark-mode .onboarding-project-path {
      color: #aaa;
    }

    .onboarding-project-badges {
      display: flex;
      gap: 5px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .onboarding-project-badge {
      background: #61dafb;
      color: #000;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: bold;
    }

    .onboarding-version-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: flex-start;
      flex: 1;
      justify-content: flex-start;
    }

    .onboarding-version-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #e9e9e9;
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 140px;
      width: 140px;
      height: auto;
      min-height: 60px;
    }

    body.dark-mode .onboarding-version-option {
      background: #404040;
      border-color: #666;
    }

    .onboarding-version-option:hover {
      background: #d4edda;
      border-color: #28a745;
      transform: translateY(-1px);
    }

    body.dark-mode .onboarding-version-option:hover {
      background: #495057;
      border-color: #28a745;
    }

    .onboarding-version-option.selected {
      background: linear-gradient(135deg, #28a745, #20c997);
      border-color: #28a745;
      color: white;
    }

    .onboarding-version-option input[type="radio"] {
      display: none;
    }

    .onboarding-version-label {
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      text-align: center;
    }

    .onboarding-status-badge {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-top: 4px;
    }

    .onboarding-in-use {
      background: rgba(40, 167, 69, 0.1);
      color: #28a745;
      border: 1px solid rgba(40, 167, 69, 0.3);
    }

    body.dark-mode .onboarding-in-use {
      background: rgba(40, 167, 69, 0.2);
      color: #5cb85c;
    }

    .onboarding-empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }

    .onboarding-empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .onboarding-empty-state-text {
      font-size: 18px;
    }

    /* Responsividade */
    @media (max-width: 600px) {
      .onboarding-version-selector {
        flex-direction: column;
        align-items: stretch;
      }
      
      .onboarding-version-option {
        width: 100%;
        height: 70px;
      }
    }
  </style>
  
  <!-- Servi√ßos compartilhados -->
  <script src="shared-services.js"></script>
  
  <script>
  const { ipcRenderer } = require('electron');
  const path = require('path');
  const { shell } = require('electron');
  
  // Store projects globally for reference
  let currentProjects = [];
  let currentOnboardingProjects = [];
  let currentIDE = { id: 'vscode', name: 'Visual Studio Code', icon: 'vscode.png' };

  // Estado de visibilidade do onboarding
  let onboardingVisible = false;
  let onboardingNodeConfigVisible = false;

  // =============================================================================
  // FUN√á√ïES ONBOARDING NODE CONFIGURATION
  // =============================================================================

  /**
   * Carrega configura√ß√£o do Node.js para projetos onboarding
   */
  async function loadOnboardingNodeConfig() {
    console.log('[ONBOARDING-NODE] üì° Carregando configura√ß√£o Node.js...');
    
    try {
      // Obt√©m informa√ß√µes dos projetos onboarding
      const result = await ipcRenderer.invoke('load-onboarding-projects');
      
      if (result.success) {
        const projects = result.projects;
        console.log('[ONBOARDING-NODE] ‚úÖ Projetos carregados:', projects);
        
        // Busca caminhos persistidos e vers√µes do Node para cada projeto
        const projectsWithPaths = await Promise.all(
          projects.map(async (project) => {
            const pathResult = await ipcRenderer.invoke('get-onboarding-project-path', { 
              projectName: project.name 
            });
            
            const versionResult = await ipcRenderer.invoke('get-onboarding-node-version', { 
              projectName: project.name 
            });
            
            return {
              ...project,
              persistedPath: pathResult.success ? pathResult.projectPath : null,
              nodeVersion: versionResult.success ? versionResult.nodeVersion : '16.10.0'
            };
          })
        );
        
        console.log('[ONBOARDING-NODE] üìÅ Projetos com caminhos persistidos:', projectsWithPaths);
        
        // Obt√©m vers√µes dispon√≠veis do Node
        const nodeVersions = await getAvailableNodeVersions();
        
        // Renderiza interface
        renderOnboardingNodeConfig(projectsWithPaths, nodeVersions);
      } else {
        console.error('[ONBOARDING-NODE] ‚ùå Erro ao carregar projetos:', result.error);
      }
    } catch (error) {
      console.error('[ONBOARDING-NODE] ‚ùå Erro:', error);
    }
  }

  /**
   * Obt√©m vers√µes dispon√≠veis do Node.js
   */
  async function getAvailableNodeVersions() {
    try {
      const versions = await ipcRenderer.invoke('get-node-versions');
      return versions || ['16.10.0', '18.18.2', '20.19.5']; // Fallback
    } catch (error) {
      console.error('[ONBOARDING-NODE] ‚ùå Erro ao obter vers√µes Node:', error);
      return ['16.10.0', '18.18.2', '20.19.5']; // Fallback
    }
  }

  /**
   * Renderiza interface de configura√ß√£o do Node.js
   */
  function renderOnboardingNodeConfig(projects, nodeVersions) {
    const container = document.getElementById('onboarding-project-list');
    
    if (!projects || projects.length === 0) {
      container.innerHTML = `
        <div class="onboarding-empty-state">
          <div class="onboarding-empty-state-icon">üì¶</div>
          <div class="onboarding-empty-state-text">Nenhum projeto onboarding encontrado</div>
        </div>
      `;
      return;
    }

    container.innerHTML = '';

    projects.forEach((project, projectIndex) => {
      // Obt√©m vers√£o atual configurada ou usa padr√£o
      const currentVersion = project.nodeVersion || '16.10.0';
      
      // Cria item do projeto
      const projectItem = document.createElement('div');
      projectItem.className = 'onboarding-project-item';
      projectItem.dataset.project = project.name;

      projectItem.innerHTML = `
        <div class="onboarding-project-info">
          <div class="onboarding-project-name">ÔøΩ ${project.name}</div>
          <div class="onboarding-project-path">${project.persistedPath || project.path || 'Caminho n√£o definido'}</div>
          <div class="onboarding-project-badges">
            <span class="onboarding-project-badge">‚öõÔ∏è React</span>
            <span class="onboarding-project-badge" style="background: #68B684;">üöÄ Port√°til</span>
            <span class="onboarding-project-badge" style="background: #ff6b6b; color: white;">Porta: ${project.port}</span>
          </div>
        </div>
        <div class="onboarding-version-selector" id="version-selector-${projectIndex}">
          ${nodeVersions.map((version, versionIndex) => {
            const isSelected = version === currentVersion;
            
            return `
              <div class="onboarding-version-option ${isSelected ? 'selected' : ''}" 
                   data-project="${project.name}" 
                   data-version="${version}"
                   onclick="selectOnboardingNodeVersion('${project.name}', '${version}', ${projectIndex})">
                <input type="radio" 
                       name="node-version-${projectIndex}" 
                       value="${version}" 
                       ${isSelected ? 'checked' : ''}>
                <div class="onboarding-version-label">Node ${version}</div>
                ${isSelected ? '<div class="onboarding-status-badge onboarding-in-use">üü¢ Em uso</div>' : ''}
              </div>
            `;
          }).join('')}
        </div>
      `;

      container.appendChild(projectItem);
    });
  }

  /**
   * Seleciona pasta para configura√ß√£o do projeto onboarding
   */
  async function selectOnboardingConfigFolder(index) {
    const project = currentOnboardingProjects[index];
    const inputId = `onb-config-input-${index}`;
    
    console.log(`[ONBOARDING-CONFIG] üìÅ Selecionando pasta para ${project.name}...`);
    
    await sharedServices.selectFolder(
      inputId, 
      index, 
      'onboarding-config', 
      (path, idx, type) => {
        console.log(`[ONBOARDING-CONFIG] ‚úÖ Pasta selecionada: ${path}`);
        
        // Atualiza projeto no backend
        ipcRenderer.invoke('set-onboarding-project-path', {
          projectName: project.name,
          projectPath: path
        }).then(() => {
          console.log(`[ONBOARDING-CONFIG] ‚úÖ Caminho salvo no backend`);
        });
      }
    );
  }

  /**
   * Atualiza display da vers√£o do Node
   */
  function updateNodeVersionDisplay(index, version) {
    const statusDiv = document.getElementById(`node-status-${index}`);
    statusDiv.innerHTML = `
      <span style="color: var(--warning-color);">‚ö†Ô∏è</span>
      <span style="color: var(--text-color);">Node.js v${version} - Aguardando aplica√ß√£o</span>
    `;
  }

  /**
   * Aplica nova vers√£o do Node.js
   */
  async function applyNodeVersion(index) {
    const versionSelect = document.getElementById(`node-version-${index}`);
    const button = document.getElementById(`apply-node-${index}`);
    const statusDiv = document.getElementById(`node-status-${index}`);
    
    const selectedVersion = versionSelect.value;
    const projectName = currentOnboardingProjects[index].name;
    
    button.disabled = true;
    button.innerHTML = '‚è≥ Aplicando...';
    
    statusDiv.innerHTML = `
      <span style="color: var(--info-color);">üîÑ</span>
      <span style="color: var(--text-color);">Configurando Node.js v${selectedVersion}...</span>
    `;
    
    try {
      const result = await ipcRenderer.invoke('set-onboarding-node-version', {
        projectName,
        nodeVersion: selectedVersion
      });
      
      if (result.success) {
        statusDiv.innerHTML = `
          <span style="color: var(--success-color);">‚úÖ</span>
          <span style="color: var(--text-color);">Node.js v${selectedVersion} - Configurado!</span>
        `;
      } else {
        throw new Error(result.error);
      }
    } catch (error) {
      statusDiv.innerHTML = `
        <span style="color: var(--error-color);">‚ùå</span>
        <span style="color: var(--text-color);">Erro: ${error.message}</span>
      `;
    } finally {
      button.disabled = false;
      button.innerHTML = 'üíæ Aplicar Configura√ß√£o';
    }
  }

  /**
   * Restaura vers√£o padr√£o do Node.js
   */
  async function resetNodeVersion(index) {
    const versionSelect = document.getElementById(`node-version-${index}`);
    versionSelect.value = '16.10.0';
    updateNodeVersionDisplay(index, '16.10.0');
    await applyNodeVersion(index);
  }

  /**
   * Seleciona vers√£o do Node.js para projeto onboarding
   */
  async function selectOnboardingNodeVersion(projectName, nodeVersion, projectIndex) {
    console.log(`[ONBOARDING-NODE] üîß Configurando ${projectName} para usar Node.js v${nodeVersion}`);
    
    try {
      // Atualiza sele√ß√£o visual
      const versionSelector = document.getElementById(`version-selector-${projectIndex}`);
      const allOptions = versionSelector.querySelectorAll('.onboarding-version-option');
      
      // Remove sele√ß√£o anterior e tag "Em uso"
      allOptions.forEach(option => {
        option.classList.remove('selected');
        const radio = option.querySelector('input[type="radio"]');
        radio.checked = false;
        
        // Remove tag "Em uso" anterior
        const statusBadge = option.querySelector('.onboarding-status-badge');
        if (statusBadge) {
          statusBadge.remove();
        }
      });
      
      // Adiciona sele√ß√£o nova e tag "Em uso"
      const selectedOption = versionSelector.querySelector(`[data-version="${nodeVersion}"]`);
      if (selectedOption) {
        selectedOption.classList.add('selected');
        const radio = selectedOption.querySelector('input[type="radio"]');
        radio.checked = true;
        
        // Adiciona nova tag "Em uso"
        const labelDiv = selectedOption.querySelector('.onboarding-version-label');
        const statusBadge = document.createElement('div');
        statusBadge.className = 'onboarding-status-badge onboarding-in-use';
        statusBadge.textContent = 'üü¢ Em uso';
        labelDiv.parentNode.appendChild(statusBadge);
      }
      
      // Salva configura√ß√£o no backend
      const result = await ipcRenderer.invoke('set-onboarding-node-version', {
        projectName,
        nodeVersion
      });
      
      if (result.success) {
        console.log(`[ONBOARDING-NODE] ‚úÖ Vers√£o Node.js v${nodeVersion} salva para ${projectName}`);
      } else {
        console.error(`[ONBOARDING-NODE] ‚ùå Erro ao salvar configura√ß√£o:`, result.error);
      }
      
    } catch (error) {
      console.error(`[ONBOARDING-NODE] ‚ùå Erro ao configurar Node.js para ${projectName}:`, error);
    }
  }

  // =============================================================================
  // FUN√á√ïES AUXILIARES ONBOARDING
  // =============================================================================

  /**
   * Toggle dos badges de vers√£o onboarding
   */
  function toggleOnboardingVersionBadges(index) {
    const badgesContainer = document.getElementById(`onb-version-badges-${index}`);
    const toggleBtn = badgesContainer.previousElementSibling;
    
    if (badgesContainer.style.display === 'none' || !badgesContainer.style.display) {
      badgesContainer.style.display = 'flex';
      toggleBtn.textContent = '‚Äπ';
    } else {
      badgesContainer.style.display = 'none';
      toggleBtn.textContent = '‚Ä∫';
    }
  }

  /**
   * Abre projeto onboarding no editor
   */
  async function openOnboardingProjectInEditor(index) {
    const project = currentOnboardingProjects[index];
    if (project && project.path) {
      await sharedServices.openInEditor(project.path, currentIDE);
    }
  }

  /**
   * Abre projeto onboarding no navegador
   */
  function openOnboardingProject(index) {
    const project = currentOnboardingProjects[index];
    if (project && project.isRunning) {
      sharedServices.openInBrowser(project.port);
    }
  }

  /**
   * Seleciona pasta para projeto onboarding
   */
  async function selectOnboardingFolder(index) {
    await sharedServices.selectFolder(
      `onb-input-${index}`, 
      index, 
      'onboarding', 
      (path, idx, type) => {
        // Callback ap√≥s sele√ß√£o - atualiza projeto no backend
        ipcRenderer.invoke('set-onboarding-project-path', {
          projectName: currentOnboardingProjects[idx].name,
          projectPath: path
        }).then(() => {
          loadOnboardingProjects(); // Recarrega projetos
        });
      }
    );
  }

  /**
   * Clona projeto onboarding
   */
  async function cloneOnboardingProject(projectName, index) {
    const logElementId = `onb-log-${index}`;
    const buttonId = `onb-btn-download-${index}`;
    
    sharedServices.updateButton(buttonId, '‚è≥ Clonando...', true);
    sharedServices.clearLog(logElementId);
    sharedServices.updateLog(logElementId, '');
    
    try {
      const result = await ipcRenderer.invoke('clone-onboarding-project', { projectName });
      
      if (result.success) {
        sharedServices.updateLog(logElementId, `‚úÖ Projeto clonado em: ${result.projectPath}`);
        const input = document.getElementById(`onb-input-${index}`);
        if (input) {
          input.value = result.projectPath;
        }
        await loadOnboardingProjects(); // Reload to update UI
      } else {
        sharedServices.updateLog(logElementId, `‚ùå Erro: ${result.error}`);
      }
    } catch (error) {
      sharedServices.updateLog(logElementId, `‚ùå Erro: ${error.message}`);
    } finally {
      sharedServices.updateButton(buttonId, 'üì• Clonar Projeto', false);
    }
  }

  /**
   * Instala depend√™ncias do projeto onboarding
   */
  async function installOnboardingDependencies(projectName, index) {
    const logElementId = `onb-log-${index}`;
    const buttonId = `onb-btn-install-${index}`;
    
    sharedServices.updateButton(buttonId, '‚è≥ Instalando...', true);
    sharedServices.clearLog(logElementId);
    sharedServices.updateLog(logElementId, '');
    
    try {
      const result = await ipcRenderer.invoke('install-onboarding-dependencies', { projectName });
      
      if (result.success) {
        sharedServices.updateLog(logElementId, '‚úÖ Depend√™ncias instaladas com sucesso!');
        await loadOnboardingProjects(); // Reload to update UI
      } else {
        sharedServices.updateLog(logElementId, `‚ùå Erro: ${result.error}`);
      }
    } catch (error) {
      sharedServices.updateLog(logElementId, `‚ùå Erro: ${error.message}`);
    } finally {
      sharedServices.updateButton(buttonId, 'üì¶ Instalar', false);
    }
  }

  /**
   * Inicia projeto onboarding
   */
  async function startOnboardingProject(projectName, index) {
    const logElementId = `onb-log-${index}`;
    const startButtonId = `onb-btn-start-${index}`;
    const cancelButtonId = `onb-btn-cancel-${index}`;
    
    sharedServices.updateButton(startButtonId, '‚è≥ Iniciando...', true);
    sharedServices.updateButton(cancelButtonId, null, null, 'inline-block');
    sharedServices.clearLog(logElementId);
    sharedServices.updateLog(logElementId, '');
    
    try {
      const result = await ipcRenderer.invoke('start-onboarding-project', { projectName });
      
      if (result.success) {
        sharedServices.updateLog(logElementId, `‚úÖ Projeto iniciado na porta ${result.port}!`);
        // O evento 'onboarding-started' ir√° atualizar a UI automaticamente
      } else {
        sharedServices.updateLog(logElementId, `‚ùå Erro: ${result.error}`);
        sharedServices.updateButton(startButtonId, 'Iniciar', false);
        sharedServices.updateButton(cancelButtonId, null, null, 'none');
      }
    } catch (error) {
      sharedServices.updateLog(logElementId, `‚ùå Erro: ${error.message}`);
      sharedServices.updateButton(startButtonId, 'Iniciar', false);
      sharedServices.updateButton(cancelButtonId, null, null, 'none');
    }
  }

  /**
   * Para projeto onboarding (mata por porta tamb√©m)
   */
  async function stopOnboardingProject(projectName, index) {
    const logElementId = `onb-log-${index}`;
    const stopButtonId = `onb-btn-stop-${index}`;
    
    sharedServices.updateButton(stopButtonId, '‚è≥ Parando...', true);
    sharedServices.updateLog(logElementId, '');
    
    try {
      // Encontra o projeto para obter a porta
      const project = currentOnboardingProjects.find(p => p.name === projectName);
      const port = project ? project.port : null;
      
      const result = await ipcRenderer.invoke('stop-onboarding-project', { projectName, port });
      
      if (result.success) {
        sharedServices.updateLog(logElementId, '‚úÖ Projeto parado com sucesso!');
        // O evento 'onboarding-stopped' ir√° atualizar a UI automaticamente
      } else {
        sharedServices.updateLog(logElementId, `‚ùå Erro: ${result.error}`);
        sharedServices.updateButton(stopButtonId, 'Parar', false);
      }
    } catch (error) {
      sharedServices.updateLog(logElementId, `‚ùå Erro: ${error.message}`);
      sharedServices.updateButton(stopButtonId, 'Parar', false);
    }
  }

  // ===== FUN√á√ÉO PARA OBTER √çCONE DA IDE ATUAL =====
  function getCurrentIDEIcon() {
    return `assets/${currentIDE.icon}`;
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR √çCONES DE IDE =====
  function updateIDEIcons() {
    const ideIcon = getCurrentIDEIcon();
    
    // Atualiza todos os √≠cones de IDE
    const ideImages = document.querySelectorAll('img[id*="btn-editor"], img[id*="pamp-btn-editor"]');
    ideImages.forEach(img => {
      img.src = ideIcon;
      img.title = `Abrir projeto no ${currentIDE.name}`;
    });

    // Atualiza IDE no m√≥dulo onboarding
    updateOnboardingIDE();
  }

  // Fun√ß√£o para aplicar tema
  function applyTheme() {
    // Carrega as configura√ß√µes (incluindo modo escuro)
    ipcRenderer.send('load-configs');
  }

  // Fun√ß√£o para obter o √≠cone de terminal correto baseado no tema
  function getTerminalIcon() {
    const isDarkMode = document.body.classList.contains('dark-mode');
    return isDarkMode ? 'terminal_branco.png' : 'terminal.png';
  }

  // Fun√ß√£o para atualizar √≠cones de terminal baseado no tema
  function updateTerminalIcons() {
    const terminalIcon = getTerminalIcon();
    
    // Atualiza todos os √≠cones de terminal
    const terminalImages = document.querySelectorAll('img[id*="terminal"]');
    terminalImages.forEach(img => {
      if (img.src.includes('terminal.png') || img.src.includes('terminal_branco.png')) {
        img.src = terminalIcon;
      }
    });
  }

  // ===== FUN√á√ÉO PARA ABRIR PROJETO NO EDITOR =====
  function openProjectInEditor(projectIndex, isPamp, isOnboarding = false) {
    // Verifica se j√° est√° processando para evitar m√∫ltiplos cliques
    let editorButtonId, inputId;
    
    if (isOnboarding) {
      editorButtonId = `onb-btn-editor-${projectIndex}`;
      inputId = `onb-input-${projectIndex}`;
    } else {
      editorButtonId = isPamp ? `pamp-btn-editor-${projectIndex}` : `btn-editor-${projectIndex}`;
      inputId = isPamp ? `pamp-input-${projectIndex}` : `input-${projectIndex}`;
    }
    
    const editorButton = document.getElementById(editorButtonId);
    
    if (!editorButton || editorButton.classList.contains('disabled')) {
      console.log('Editor j√° est√° sendo aberto, aguarde...');
      return;
    }
    
    // Pega o caminho do projeto
    const inputElement = document.getElementById(inputId);
    
    if (!inputElement || !inputElement.value.trim()) {
      alert('Caminho do projeto n√£o est√° configurado.\nConfigure o caminho do projeto primeiro.');
      return;
    }
    
    const projectPath = inputElement.value.trim();
    
    // Desabilita o bot√£o por 5 segundos
    editorButton.classList.add('disabled');
    editorButton.title = 'Abrindo editor...';
    
    console.log(`[DEBUG] Abrindo editor para projeto: ${projectPath}`);
    
    // Envia comando para abrir o projeto no editor
    ipcRenderer.send('open-project-in-editor', { 
      projectPath: projectPath,
      projectIndex: projectIndex,
      isPamp: isPamp,
      isOnboarding: isOnboarding
    });
    
    // Reabilita o bot√£o ap√≥s 5 segundos
    setTimeout(() => {
      editorButton.classList.remove('disabled');
      editorButton.title = 'Abrir projeto no editor de c√≥digo';
    }, 5000);
  }

  // ===== FUN√á√ïES PARA CONTROLE INTELIGENTE DO TOOLTIP =====
  let tooltipTimeouts = {};

  function showTooltip(event, projectIndex) {
    // Cancela qualquer timeout de hide pendente
    if (tooltipTimeouts[projectIndex]) {
      clearTimeout(tooltipTimeouts[projectIndex]);
      delete tooltipTimeouts[projectIndex];
    }

    const tooltip = document.getElementById(`tooltip-${projectIndex}`);
    if (!tooltip) return;

    // Calcula posi√ß√£o inteligente
    const rect = event.target.getBoundingClientRect();
    const tooltipWidth = 380;
    const tooltipHeight = 400; // altura m√°xima aproximada
    
    // Posi√ß√£o horizontal - sempre √† esquerda do √≠cone para n√£o sair da tela
    let left = rect.left - tooltipWidth - 10;
    if (left < 10) {
      // Se sair pela esquerda, posiciona √† direita
      left = rect.right + 10;
      // Se ainda sair pela direita, centraliza
      if (left + tooltipWidth > window.innerWidth - 10) {
        left = (window.innerWidth - tooltipWidth) / 2;
      }
    }
    
    // Posi√ß√£o vertical - preferencialmente acima
    let top = rect.top - tooltipHeight - 10;
    if (top < 10) {
      // Se sair por cima, posiciona embaixo
      top = rect.bottom + 10;
      // Se ainda sair por baixo, centraliza verticalmente
      if (top + tooltipHeight > window.innerHeight - 10) {
        top = (window.innerHeight - tooltipHeight) / 2;
      }
    }

    // Aplica posicionamento
    tooltip.style.left = Math.max(10, left) + 'px';
    tooltip.style.top = Math.max(10, top) + 'px';
    
    // Mostra tooltip
    tooltip.classList.add('show');
  }

  function hideTooltip(projectIndex) {
    // Delay para permitir mover o mouse para o tooltip
    tooltipTimeouts[projectIndex] = setTimeout(() => {
      const tooltip = document.getElementById(`tooltip-${projectIndex}`);
      if (tooltip) {
        tooltip.classList.remove('show');
      }
      delete tooltipTimeouts[projectIndex];
    }, 200);
  }

  function keepTooltipVisible(projectIndex) {
    // Cancela o hide quando mouse entra no tooltip
    if (tooltipTimeouts[projectIndex]) {
      clearTimeout(tooltipTimeouts[projectIndex]);
      delete tooltipTimeouts[projectIndex];
    }
  }

  function hideTooltipDelayed(projectIndex) {
    // Hide com delay quando mouse sai do tooltip
    tooltipTimeouts[projectIndex] = setTimeout(() => {
      const tooltip = document.getElementById(`tooltip-${projectIndex}`);
      if (tooltip) {
        tooltip.classList.remove('show');
      }
      delete tooltipTimeouts[projectIndex];
    }, 300);
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR TOOLTIP COM PORTA =====
  function updateTooltipWithPort(projectIndex, port, isPamp) {
    if (!isPamp) return; // S√≥ atualiza para projetos PAMP
    
    const tooltipElement = document.getElementById(`tooltip-${projectIndex}`);
    if (tooltipElement) {
      const inputElement = document.getElementById(`pamp-input-${projectIndex}`);
      const currentPath = inputElement ? inputElement.value : '';
      
      const tooltipContent = `
        <strong>üîß Configura√ß√£o para desenvolvimento local:</strong><br><br>
        Para usar este micro front-end localmente, voc√™ precisa alterar o arquivo <code>environment.ts</code> do projeto <strong>mp-pamp</strong>.<br><br>
        <strong>üìç Caminho:</strong> <code>mp-pamp/src/environments/environment.ts</code><br><br>
        <strong>üìù Como alterar:</strong><br>
        1. Encontre a se√ß√£o <code>mfe: { ... }</code><br>
        2. Procure pela propriedade que corresponde a este MFE<br>
        3. Substitua a URL atual pela URL local: <code>http://localhost:${port}/remoteEntry.js</code><br>
        4. Salve o arquivo e recompile o projeto mp-pamp<br><br>
        <span class="tooltip-link" onclick="openEnvironmentFile('${currentPath}')">üîó Abrir arquivo environment.ts</span>
      `;
      tooltipElement.innerHTML = tooltipContent;
    }
  }

  // ===== FUN√á√ÉO PARA ABRIR ARQUIVO ENVIRONMENT.TS =====
  function openEnvironmentFile(currentProjectPath) {
    // Verifica se j√° est√° processando para evitar m√∫ltiplos cliques
    if (window.openingEnvironmentFile) {
      console.log('J√° est√° abrindo arquivo environment.ts, aguarde...');
      return;
    }
    
    // Busca o projeto mp-pamp na lista de projetos carregados
    const mpPampProject = currentProjects.find(p => p.name === 'mp-pamp');
    
    if (!mpPampProject || !mpPampProject.path) {
      alert('Projeto mp-pamp n√£o encontrado ou n√£o configurado.\nVerifique se o mp-pamp est√° na lista de projetos e tem um caminho v√°lido.');
      return;
    }
    
    // Marca como processando
    window.openingEnvironmentFile = true;
    
    // Desabilita todos os links do tooltip
    const allTooltipLinks = document.querySelectorAll('.tooltip-link');
    allTooltipLinks.forEach(link => {
      link.style.opacity = '0.5';
      link.style.cursor = 'not-allowed';
      link.style.pointerEvents = 'none';
      link.innerHTML = '‚è≥ Abrindo arquivo...';
    });
    
    // Usa o caminho do mp-pamp e adiciona o sufixo do arquivo
    const mpPampPath = mpPampProject.path;
    let environmentPath;
    
    // Detecta o sistema operacional pelos separadores no caminho
    if (mpPampPath.includes('\\')) {
      // Windows
      environmentPath = mpPampPath + '\\src\\environments\\environment.ts';
    } else {
      // Linux/macOS
      environmentPath = mpPampPath + '/src/environments/environment.ts';
    }
    
    console.log(`[DEBUG] Projeto mp-pamp encontrado: ${mpPampPath}`);
    console.log(`[DEBUG] Caminho final do environment.ts: ${environmentPath}`);
    
    // Envia comando para abrir o arquivo
    ipcRenderer.send('open-environment-file', { 
      filePath: environmentPath,
      mpPampPath: mpPampPath
    });
    
    // Reabilita os links ap√≥s 3 segundos (tempo suficiente para o arquivo abrir)
    setTimeout(() => {
      window.openingEnvironmentFile = false;
      allTooltipLinks.forEach(link => {
        link.style.opacity = '1';
        link.style.cursor = 'pointer';
        link.style.pointerEvents = 'auto';
        link.innerHTML = 'üîó Abrir arquivo environment.ts';
      });
    }, 3000);
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR BRANCH (GIT PULL) =====
  function handleUpdateBranch(projectIndex, projectName, projectPath, isPamp) {
    console.log(`[DEBUG] handleUpdateBranch chamada:`, { projectIndex, projectName, projectPath, isPamp });
    
    if (!projectPath || projectPath.trim() === '') {
      console.log(`[ERROR] Projeto ${projectName} n√£o tem caminho v√°lido:`, projectPath);
      alert('Projeto precisa ter um caminho v√°lido para ser atualizado.');
      return;
    }

    // Confirma a a√ß√£o
    const confirmed = confirm(`Atualizar branch do projeto ${projectName}?\n\nIsso executar√° um 'git pull origin' no diret√≥rio:\n${projectPath}`);
    
    if (!confirmed) {
      console.log(`[INFO] Usu√°rio cancelou git pull para ${projectName}`);
      return;
    }

    console.log(`[INFO] Usu√°rio confirmou git pull para ${projectName}`);

    // Muda o visual da tag para indicar que est√° processando
    const commitsTagId = isPamp ? `pamp-commits-${projectIndex}` : `pas-commits-${projectIndex}`;
    const commitsTag = document.getElementById(commitsTagId);
    
    console.log(`[DEBUG] Procurando tag com ID: ${commitsTagId}`, commitsTag);
    
    if (commitsTag) {
      commitsTag.style.background = '#6c757d'; // Cinza para indicar processamento
      commitsTag.innerHTML = '‚è≥ Atualizando...';
      commitsTag.style.cursor = 'not-allowed';
      commitsTag.onclick = null; // Remove o clique durante o processamento
      console.log(`[INFO] Tag visual atualizada para estado "processando"`);
    } else {
      console.log(`[WARN] Tag commits n√£o encontrada: ${commitsTagId}`);
    }

    // Mostra log imediato no console do projeto
    const logContainer = isPamp ? `pamp-log-${projectIndex}` : `log-${projectIndex}`;
    const logDiv = document.getElementById(logContainer);
    if (logDiv) {
      logDiv.style.display = 'block';
      logDiv.innerHTML += `<div style="color: #ffff00;">[${new Date().toLocaleTimeString()}] üîÑ Iniciando git pull para ${projectName}...</div>`;
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[INFO] Log adicionado ao container: ${logContainer}`);
    } else {
      console.log(`[WARN] Container de log n√£o encontrado: ${logContainer}`);
    }

    // Envia comando para o backend
    const data = {
      projectIndex: projectIndex,
      projectName: projectName,
      projectPath: projectPath,
      isPamp: isPamp
    };
    
    console.log(`[DEBUG] Enviando comando git-pull-branch:`, data);
    ipcRenderer.send('git-pull-branch', data);
    console.log(`[INFO] Comando git-pull-branch enviado para o backend`);
  }

  // ===== FUN√á√ïES PARA BOT√ïES TOGGLE MODERNOS =====
  
  /**
   * Esconde todos os containers principais da aplica√ß√£o
   */
  function hideAllContainers() {
    console.log('[UI] ü´• Escondendo todos os containers...');
    
    const containers = [
      'projects',      // PAS
      'pamp-mfes',     // PAMP
      'onboarding-mfes' // Onboarding
    ];
    
    containers.forEach(containerId => {
      const container = document.getElementById(containerId);
      if (container) {
        container.style.display = 'none';
        console.log(`[UI] ‚úÖ Container ${containerId} escondido`);
      } else {
        console.warn(`[UI] ‚ö†Ô∏è Container ${containerId} n√£o encontrado`);
      }
    });
    
    // Remove estado expanded de todos os bot√µes toggle
    const toggleButtons = [
      'toggle-mfes',
      'toggle-pamp-mfes', 
      'toggle-onboarding-mfes'
    ];
    
    toggleButtons.forEach(buttonId => {
      const button = document.getElementById(buttonId);
      if (button) {
        button.classList.remove('expanded');
        console.log(`[UI] ‚úÖ Estado expanded removido do bot√£o ${buttonId}`);
      }
    });
    
    // Atualiza vari√°veis globais de visibilidade
    if (typeof mfesVisible !== 'undefined') mfesVisible = false;
    if (typeof pampVisible !== 'undefined') pampVisible = false;
    if (typeof onboardingVisible !== 'undefined') onboardingVisible = false;
    
    console.log('[UI] ‚úÖ Todos os containers foram escondidos');
  }
  
  function updateToggleButton(button, isExpanded, count = 0) {
    const countElement = button.querySelector('.toggle-count');
    
    // Atualiza estado de expandido
    if (isExpanded) {
      button.classList.add('expanded');
    } else {
      button.classList.remove('expanded');
    }
    
    // Atualiza contador
    if (countElement) {
      countElement.textContent = count.toString();
    }
  }

  // Toggle para PAMP (Painel Admin)
  const togglePampBtn = document.getElementById('toggle-pamp-mfes');
  const pampContainer = document.getElementById('pamp-mfes');
  let pampVisible = false;
  
  togglePampBtn.addEventListener('click', () => {
    pampVisible = !pampVisible;
    pampContainer.style.display = pampVisible ? 'flex' : 'none';
    
    // Conta projetos PAMP vis√≠veis
    const pampCount = pampContainer.querySelectorAll('.project-card').length;
    updateToggleButton(togglePampBtn, pampVisible, pampCount);
  });

  // Toggle para PAS (Site Principal)
  const toggleBtn = document.getElementById('toggle-mfes');
  const projectsContainer = document.getElementById('projects');
  let mfesVisible = false;
  
  toggleBtn.addEventListener('click', () => {
    mfesVisible = !mfesVisible;
    projectsContainer.style.display = mfesVisible ? 'flex' : 'none';
    
    // Conta projetos PAS vis√≠veis
    const pasCount = projectsContainer.querySelectorAll('.project-card').length;
    updateToggleButton(toggleBtn, mfesVisible, pasCount);
  });

  // Toggle para Onboarding
  const toggleOnboardingBtn = document.getElementById('toggle-onboarding-mfes');
  const onboardingContainer = document.getElementById('onboarding-mfes');
  
  console.log('[ONBOARDING] Inicializando bot√£o Onboarding...');
  console.log('[ONBOARDING] toggleOnboardingBtn:', toggleOnboardingBtn);
  console.log('[ONBOARDING] onboardingContainer:', onboardingContainer);
  
  if (!toggleOnboardingBtn) {
    console.error('[ONBOARDING] ‚ùå Bot√£o Onboarding n√£o encontrado!');
  } else {
    console.log('[ONBOARDING] ‚úÖ Bot√£o Onboarding encontrado');
  }
  
  if (!onboardingContainer) {
    console.error('[ONBOARDING] ‚ùå Container Onboarding n√£o encontrado!');
  } else {
    console.log('[ONBOARDING] ‚úÖ Container Onboarding encontrado');
  }
  
  toggleOnboardingBtn.addEventListener('click', () => {
    console.log('[ONBOARDING] üñ±Ô∏è Bot√£o clicado! onboardingVisible:', onboardingVisible);
    onboardingVisible = !onboardingVisible;
    onboardingContainer.style.display = onboardingVisible ? 'flex' : 'none';
    
    if (onboardingVisible) {
      console.log('[ONBOARDING] üëÅÔ∏è Mostrando Onboarding, escondendo PAS e PAMP');
      // Esconde PAS e PAMP quando Onboarding estiver aberto (sem encerrar processos)
      projectsContainer.style.display = 'none';
      pampContainer.style.display = 'none';
      
      // Atualiza bot√µes para mostrar que est√£o ocultos mas n√£o desativados
      toggleBtn.classList.remove('expanded');
      togglePampBtn.classList.remove('expanded');
      
      // Carrega projetos onboarding
      loadOnboardingProjects();
    } else {
      console.log('[ONBOARDING] üëÅÔ∏è Escondendo Onboarding, restaurando PAS e PAMP');
      // Restaura visibilidade anterior dos pain√©is PAS e PAMP
      projectsContainer.style.display = mfesVisible ? 'flex' : 'none';
      pampContainer.style.display = pampVisible ? 'flex' : 'none';
      
      // Restaura estado dos bot√µes
      if (mfesVisible) toggleBtn.classList.add('expanded');
      if (pampVisible) togglePampBtn.classList.add('expanded');
    }
    
    // Conta projetos Onboarding vis√≠veis
    const onboardingCount = onboardingContainer.querySelectorAll('.project-card').length;
    updateToggleButton(toggleOnboardingBtn, onboardingVisible, onboardingCount);
  });

  // Toggle para configura√ß√£o do Node.js do Onboarding
  const toggleOnboardingNodeConfigBtn = document.getElementById('toggle-onboarding-node-config');
  const onboardingNodeConfigContainer = document.getElementById('onboarding-node-config');
  
  if (toggleOnboardingNodeConfigBtn && onboardingNodeConfigContainer) {
    toggleOnboardingNodeConfigBtn.addEventListener('click', () => {
      console.log('[ONBOARDING-NODE] üñ±Ô∏è Bot√£o de configura√ß√£o Node clicado!');
      onboardingNodeConfigVisible = !onboardingNodeConfigVisible;
      onboardingNodeConfigContainer.style.display = onboardingNodeConfigVisible ? 'flex' : 'none';
      
      if (onboardingNodeConfigVisible) {
        // Esconde todos os outros pain√©is
        projectsContainer.style.display = 'none';
        pampContainer.style.display = 'none';
        onboardingContainer.style.display = 'none';
        
        // Remove estado expanded de todos os bot√µes
        toggleBtn.classList.remove('expanded');
        togglePampBtn.classList.remove('expanded');
        toggleOnboardingBtn.classList.remove('expanded');
        
        // Carrega configura√ß√£o do Node
        loadOnboardingNodeConfig();
      } else {
        // Restaura estados anteriores
        if (mfesVisible) {
          projectsContainer.style.display = 'block';
          toggleBtn.classList.add('expanded');
        }
        if (pampVisible) {
          pampContainer.style.display = 'block';
          togglePampBtn.classList.add('expanded');
        }
        if (onboardingVisible) {
          onboardingContainer.style.display = 'block';
          toggleOnboardingBtn.classList.add('expanded');
        }
      }
      
      // Atualiza estado do bot√£o
      toggleOnboardingNodeConfigBtn.classList.toggle('expanded', onboardingNodeConfigVisible);
    });
  }

  ipcRenderer.send('load-projects');

  // Fun√ß√£o para carregar vers√£o dinamicamente
  async function loadAppVersion() {
    try {
      const version = await ipcRenderer.invoke('get-app-version');
      console.log('[APP] üìã Vers√£o carregada:', version);
      
      // Atualiza o t√≠tulo principal
      const titleElement = document.querySelector('.main-title');
      if (titleElement) {
        const versionSpan = titleElement.querySelector('span');
        if (versionSpan) {
          versionSpan.textContent = `v${version}`;
        } else {
          // Se n√£o houver span de vers√£o, adiciona um
          const newVersionSpan = document.createElement('span');
          newVersionSpan.style.fontSize = '14px';
          newVersionSpan.style.color = '#666';
          newVersionSpan.textContent = `v${version}`;
          titleElement.insertBefore(newVersionSpan, titleElement.firstChild.nextSibling);
        }
      }
    } catch (error) {
      console.error('[APP] ‚ùå Erro ao carregar vers√£o:', error);
    }
  }

  // Inicializa contador de onboarding
  console.log('[ONBOARDING] üîÑ Inicializando contador de onboarding...');
  const initialOnboardingCount = document.getElementById('onboarding-count');
  if (initialOnboardingCount) {
    initialOnboardingCount.textContent = '1'; // mp-site-front
    console.log('[ONBOARDING] ‚úÖ Contador inicial definido para 1');
  } else {
    console.error('[ONBOARDING] ‚ùå Elemento onboarding-count n√£o encontrado!');
  }

  // Aguarda DOM estar pronto e inicializa onboarding
  document.addEventListener('DOMContentLoaded', function() {
    console.log('[ONBOARDING] üöÄ DOM loaded, verificando elementos...');
    
    // Carrega a vers√£o do app dinamicamente
    loadAppVersion();
    
    // For√ßa verifica√ß√£o dos elementos onboarding
    const onbBtn = document.getElementById('toggle-onboarding-mfes');
    const onbContainer = document.getElementById('onboarding-mfes');
    const onbCountEl = document.getElementById('onboarding-count');
    
    console.log('[ONBOARDING] Elementos encontrados:');
    console.log('- toggle-onboarding-mfes:', !!onbBtn);
    console.log('- onboarding-mfes:', !!onbContainer);
    console.log('- onboarding-count:', !!onbCountEl);
    
    if (onbBtn && onbContainer) {
      console.log('[ONBOARDING] ‚úÖ Todos os elementos encontrados!');
      // Garante que o bot√£o seja vis√≠vel
      onbBtn.style.display = 'flex';
      if (onbCountEl) onbCountEl.textContent = '1';
    } else {
      console.error('[ONBOARDING] ‚ùå Elementos n√£o encontrados!');
    }
  });
  
  // Handler para resultado do git pull
  ipcRenderer.on('git-pull-result', (event, { projectIndex, projectName, success, output, isPamp }) => {
    console.log(`üìù Resultado git pull para ${projectName}:`, { success, output });

    const commitsTagId = isPamp ? `pamp-commits-${projectIndex}` : `pas-commits-${projectIndex}`;
    const commitsTag = document.getElementById(commitsTagId);
    
    // Sempre mostra os logs no console do projeto
    const logContainer = isPamp ? `pamp-log-${projectIndex}` : `log-${projectIndex}`;
    const logDiv = document.getElementById(logContainer);
    
    if (logDiv) {
      logDiv.style.display = 'block';
      
      if (success) {
        logDiv.innerHTML += `<div style="color: #00ff00;">[${new Date().toLocaleTimeString()}] ‚úÖ Branch atualizada com sucesso!</div>`;
      } else {
        logDiv.innerHTML += `<div style="color: #ff6b35;">[${new Date().toLocaleTimeString()}] ‚ö†Ô∏è Pull executado com avisos</div>`;
      }
      
      // Mostra TODOS os logs do git pull
      if (output && output.trim()) {
        const lines = output.split('\n');
        lines.forEach(line => {
          if (line.trim()) {
            const color = line.includes('fatal') || line.includes('error') ? '#ff4444' : 
                         line.includes('From https://') || line.includes('branch') ? '#00aaff' :
                         line.includes('*') || line.includes('->') ? '#ffaa00' : '#ffffff';
            logDiv.innerHTML += `<div style="color: ${color};">[${new Date().toLocaleTimeString()}] ${line}</div>`;
          }
        });
      }
      
      logDiv.scrollTop = logDiv.scrollHeight;
    }
    
    if (success) {
      // Sucesso REAL - remove a tag de commits pendentes
      if (commitsTag) {
        commitsTag.remove();
      }
      
      // Atualiza o projeto no array local
      if (currentProjects[projectIndex]) {
        currentProjects[projectIndex].pendingCommits = 0;
        currentProjects[projectIndex].hasUpdates = false;
      }
      
    } else {
      // Problema/Warning - badge permanece para nova tentativa
      if (commitsTag) {
        const hasConflict = output && (output.includes('would be overwritten') || output.includes('Aborting'));
        
        if (hasConflict) {
          commitsTag.style.background = '#ff6b35'; // Laranja para conflitos
          commitsTag.innerHTML = `‚ö†Ô∏è Conflito`;
          commitsTag.title = 'Conflito de merge. Resolva os conflitos locais primeiro.';
        } else {
          commitsTag.style.background = '#dc3545'; // Vermelho para erros
          commitsTag.innerHTML = '‚ùå Erro';
          commitsTag.title = 'Erro na atualiza√ß√£o. Clique para tentar novamente.';
        }
        
        commitsTag.style.cursor = 'pointer';
        commitsTag.onclick = () => handleUpdateBranch(projectIndex, projectName, currentProjects[projectIndex].path, isPamp);
      }
    }
  });
  
  // Recebe as configura√ß√µes e aplica o modo escuro se necess√°rio
  ipcRenderer.on('configs-loaded', (event, configs) => {
    if (configs.darkMode) {
      document.body.classList.add('dark-mode');
    }
    // Atualiza os √≠cones de terminal ap√≥s aplicar o tema
    updateTerminalIcons();
  });

  // Escuta mudan√ßas do modo escuro vindas da janela de configura√ß√µes
  ipcRenderer.on('apply-dark-mode', (event, isDarkMode) => {
    if (isDarkMode) {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
    // Atualiza os √≠cones de terminal ap√≥s mudan√ßa de tema
    updateTerminalIcons();
  });

  // ===== LISTENERS PARA ABERTURA DO ENVIRONMENT.TS =====
  // Escuta quando o arquivo foi aberto com sucesso
  ipcRenderer.on('environment-file-opened', (event, { success, filePath }) => {
    console.log(`‚úÖ Arquivo environment.ts aberto com sucesso: ${filePath}`);
    reEnableTooltipLinks();
  });

  // Escuta quando houve erro ao abrir o arquivo
  ipcRenderer.on('environment-file-error', (event, { error, message }) => {
    console.error(`‚ùå Erro ao abrir environment.ts: ${error}`);
    reEnableTooltipLinks();
  });

  // Fun√ß√£o para reabilitar os links do tooltip
  function reEnableTooltipLinks() {
    window.openingEnvironmentFile = false;
    const allTooltipLinks = document.querySelectorAll('.tooltip-link');
    allTooltipLinks.forEach(link => {
      link.style.opacity = '1';
      link.style.cursor = 'pointer';
      link.style.pointerEvents = 'auto';
      link.innerHTML = 'üîó Abrir arquivo environment.ts';
    });
  }

  // ===== LISTENERS PARA CONFIGURA√á√ÉO DE IDE =====
  // Escuta quando a IDE √© alterada
  ipcRenderer.on('ide-changed', (event, { id, name, icon }) => {
    console.log(`üîß IDE alterada para: ${name}`);
    currentIDE = { id, name, icon };
    updateIDEIcons();
  });

  // Carrega a IDE atual na inicializa√ß√£o
  ipcRenderer.send('get-current-ide');

  // Escuta resposta da IDE atual
  ipcRenderer.on('current-ide', (event, ide) => {
    console.log(`üîß IDE atual carregada: ${ide.name}`);
    currentIDE = ide;
    updateIDEIcons();
  });

  ipcRenderer.on('projects-loaded', (event, projects) => {
    // Store projects globally
    currentProjects = projects;
    
    console.log('[DEBUG] Projetos recebidos com dados Git:', projects.map(p => ({
      name: p.name,
      branch: p.gitBranch,
      pendingCommits: p.pendingCommits,
      hasUpdates: p.hasUpdates
    })));

    // PAMP
    const pampProjects = projects.filter(p => p.name && p.name.startsWith('mp-pamp'));
    const pampContainer = document.getElementById('pamp-mfes');
    pampContainer.innerHTML = '';

  pampProjects.forEach((project, index) => {
      // Descubra o √≠ndice real no array projects
    const realIndex = projects.findIndex(p => p.name === project.name);
    const div = document.createElement('div');
    div.className = "project-card";
    div.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <p style="margin: 0;"><strong>${project.name}</strong></p>
            <span class="toggle-versions-btn" onclick="toggleVersionBadges(${realIndex}, true)" title="Mostrar/Esconder badges">‚Ä∫</span>
            <div class="version-badges-container" id="pamp-version-badges-${realIndex}">
              <span id="pamp-node-version-${realIndex}" class="version-badge node"><img src="assets/node.png" alt="Node.js" /><span class="version-text">...</span></span>
              <span id="pamp-angular-version-${realIndex}" class="version-badge angular"><img src="assets/angular.png" alt="Angular" /><span class="version-text">...</span></span>
              ${project.gitBranch ? `<span id="pamp-branch-${realIndex}" style="background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;"><img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${project.gitBranch}</span>` : ''}
              ${project.pendingCommits && project.pendingCommits > 0 ? `<span id="pamp-commits-${realIndex}" style="background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer;" title="Clique para atualizar branch" onclick="handleUpdateBranch(${realIndex}, '${project.name}', \`${project.path.replace(/\\/g, '\\\\')}\`, true)">‚Üì ${project.pendingCommits}</span>` : ''}
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 5px;">
            <img id="pamp-btn-editor-${realIndex}" src="${getCurrentIDEIcon()}" class="editor-icon" style="${!project.path ? 'display: none' : ''}" title="Abrir projeto no ${currentIDE.name}" alt="Editor" onclick="openProjectInEditor('${realIndex}', true)" />
            <img id="pamp-btn-terminal-${realIndex}" src="${getTerminalIcon()}" style="width: 24px; height: 24px; cursor: pointer; ${!project.path ? 'display: none' : ''}" title="Abrir terminal na pasta do projeto" alt="Terminal" />
            ${project.name !== 'mp-pamp' ? `
            <div class="tooltip" onmouseenter="showTooltip(event, ${realIndex})" onmouseleave="hideTooltip(${realIndex})">
              <span class="help-icon" title="Clique para ajuda sobre configura√ß√£o MFE">‚ìò</span>
              <span class="tooltiptext" id="tooltip-${realIndex}" onmouseenter="keepTooltipVisible(${realIndex})" onmouseleave="hideTooltipDelayed(${realIndex})">
                <strong>üîß Configura√ß√£o para desenvolvimento local:</strong><br><br>
                Para usar este micro front-end localmente, voc√™ precisa alterar o arquivo <code>environment.ts</code> do projeto <strong>mp-pamp</strong>.<br><br>
                <strong>üìç Caminho:</strong> <code>mp-pamp/src/environments/environment.ts</code><br><br>
                <strong>üìù Como alterar:</strong><br>
                1. Encontre a se√ß√£o <code>mfe: { ... }</code><br>
                2. Procure pela propriedade que corresponde a este MFE<br>
                3. Substitua a URL atual pela URL local: <code>http://localhost:[PORTA]/remoteEntry.js</code><br>
                4. Use a porta mostrada ao lado do bot√£o "Iniciar" quando o projeto estiver rodando<br><br>
                <span class="tooltip-link" onclick="openEnvironmentFile('${project.path}')">üîó Abrir arquivo environment.ts</span>
              </span>
            </div>
            ` : ''}
          </div>
        </div>
        <div class="input-with-folder" style="margin-bottom: 10px;">
          <input id="pamp-input-${realIndex}" data-path="${project.path}" type="text" value="${project.path}" placeholder="Insira o caminho do projeto" />
          <img id="pamp-folder-icon-${realIndex}" src="pasta.png" class="folder-icon" title="Procurar projeto existente" alt="Procurar pasta" />
        </div>
        <button id="pamp-btn-download-${realIndex}" style="margin-right: 10px; ${project.path ? 'display: none' : ''}">Baixar Projeto</button>
        <button id="pamp-btn-start-${realIndex}" style="margin-right: 10px;" ${!project.path ? 'disabled' : ''}>Iniciar</button>
        <span id="pamp-port-${realIndex}" style="display: none; margin-right: 10px; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: default;"></span>
        <button id="pamp-btn-cancel-${realIndex}" style="display: none; margin-right: 10px; background-color: #dc3545; color: white;" title="Cancelar inicializa√ß√£o">‚úï Cancelar</button>
        <button id="pamp-btn-stop-${realIndex}" style="display: none;">Parar</button>
        <button id="pamp-btn-move-${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #5a6c7d; color: white;">Mover para...</button>
        <button id="pamp-btn-delete-${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #8b5a5a; color: white;">Deletar</button>
        <div id="pamp-log-${realIndex}" style="display: none; background: #000; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; font-family: monospace; border-radius: 5px; margin-top: 10px;">
        </div>
    `;
    pampContainer.appendChild(div);

    const pampInput = document.getElementById(`pamp-input-${realIndex}`);
    const pampDownloadButton = document.getElementById(`pamp-btn-download-${realIndex}`);
    const pampFolderIcon = document.getElementById(`pamp-folder-icon-${realIndex}`);
    const pampStartButton = document.getElementById(`pamp-btn-start-${realIndex}`);
    const pampCancelButton = document.getElementById(`pamp-btn-cancel-${realIndex}`);
    const pampStopButton = document.getElementById(`pamp-btn-stop-${realIndex}`);
    const pampTerminalButton = document.getElementById(`pamp-btn-terminal-${realIndex}`);
    const pampMoveButton = document.getElementById(`pamp-btn-move-${realIndex}`);
    const pampDeleteButton = document.getElementById(`pamp-btn-delete-${realIndex}`);
    const pampLogDiv = document.getElementById(`pamp-log-${realIndex}`);
    const pampEditorButton = document.getElementById(`pamp-btn-editor-${realIndex}`);

    // Event listeners para projetos PAMP
    pampInput.addEventListener('blur', () => {
      ipcRenderer.send('update-project-path', { index: realIndex, path: pampInput.value });
      if (pampInput.value.trim()) {
          pampDownloadButton.style.display = 'none';
          pampStartButton.disabled = false;
          pampMoveButton.style.display = 'inline-block';
          pampDeleteButton.style.display = 'inline-block';
          pampEditorButton.style.display = 'inline-block';
          pampTerminalButton.style.display = 'inline-block';
      }else {
          pampDeleteButton.style.display = 'none';
          pampMoveButton.style.display = 'none';
          pampDownloadButton.style.display = 'inline-block';
          pampStartButton.disabled = true;
          pampEditorButton.style.display = 'none';
          pampTerminalButton.style.display = 'none';
      }
    });

    pampDownloadButton.addEventListener('click', () => {
      pampDownloadButton.disabled = true;
      pampDownloadButton.innerText = 'Baixando...';
      pampFolderIcon.classList.add('disabled');
      ipcRenderer.send('download-project', { name: project.name, index: realIndex });
    });

    pampFolderIcon.addEventListener('click', () => {
      ipcRenderer.send('browse-project-folder', { index: realIndex, projectName: project.name });
    });

    pampMoveButton.addEventListener('click', () => {
      if (pampInput.value.trim()) {
        if (pampStartButton.innerText === 'Rodando ‚úì') {
          alert('N√£o √© poss√≠vel mover o projeto enquanto ele estiver rodando. Pare o projeto primeiro.');
          return;
        }
        
        pampMoveButton.disabled = true;
        pampMoveButton.innerText = 'Movendo...';
        ipcRenderer.send('move-project', { 
          index: realIndex, 
          currentPath: pampInput.value, 
          projectName: project.name 
        });
      } else {
        alert('Projeto precisa ter um caminho v√°lido para ser movido.');
      }
    });

    pampDeleteButton.addEventListener('click', () => {
      if (confirm(`Tem certeza que deseja deletar o projeto ${project.name}?`)) {
        pampDeleteButton.disabled = true;
        pampFolderIcon.classList.add('disabled');
        ipcRenderer.send('delete-project', { index: realIndex, path: pampInput.value });
      }
    });

    pampStartButton.addEventListener('click', (event) => {
      // Limpa o console antes de iniciar
      const pampLogDiv = document.getElementById(`pamp-log-${realIndex}`);
      if (pampLogDiv) {
        pampLogDiv.innerText = ''; // Zera os logs antigos
        pampLogDiv.style.display = 'none'; // Esconde at√© aparecer novos logs
      }
      
      pampStartButton.disabled = true;
      pampStartButton.innerText = 'Executando...';
      pampCancelButton.style.display = 'inline-block';
      pampFolderIcon.classList.add('disabled');
      if (pampDeleteButton) pampDeleteButton.disabled = true;      
      ipcRenderer.send('start-project-pamp', { projectPath: pampInput.value, port: project.port });
    });

    pampCancelButton.addEventListener('click', () => {
      ipcRenderer.send('cancel-project-startup', { projectPath: pampInput.value, isPamp: true, index: realIndex });
      
      pampStartButton.disabled = false;
      pampStartButton.innerText = 'Iniciar';
      pampCancelButton.style.display = 'none';
      pampFolderIcon.classList.remove('disabled');
      if (pampDeleteButton) pampDeleteButton.disabled = false;
    });

    pampTerminalButton.addEventListener('click', () => {
      if (pampInput.value.trim()) {
        pampTerminalButton.style.opacity = '0.5';
        pampTerminalButton.style.pointerEvents = 'none';
        pampTerminalButton.title = 'Abrindo terminal...';
        
        ipcRenderer.send('open-terminal', { projectPath: pampInput.value });
        
        setTimeout(() => {
          pampTerminalButton.style.opacity = '1';
          pampTerminalButton.style.pointerEvents = 'auto';
          pampTerminalButton.title = 'Abrir terminal na pasta do projeto';
        }, 5000);
      } else {
        alert('Projeto precisa ter um caminho v√°lido para abrir o terminal.');
      }
    });

    pampStopButton.addEventListener('click', () => {
      ipcRenderer.send('stop-project', { projectPath: pampInput.value, port: project.port });
    });

  });  
    
  // Projects PAS
  const pasProjects = projects.filter(p => p.name && !p.name.startsWith('mp-pamp'));
  const container = document.getElementById('projects');
  container.innerHTML = '';

  pasProjects.forEach((project, pasIndex) => {
    const realIndex = projects.findIndex(p => p.name === project.name);
    const div = document.createElement('div');
    div.className = "project-card";
    div.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <p style="margin: 0;"><strong>${project.name}</strong></p>
            <span class="toggle-versions-btn" onclick="toggleVersionBadges(${realIndex}, false)" title="Mostrar/Esconder badges">‚Ä∫</span>
            <div class="version-badges-container" id="pas-version-badges-${realIndex}">
              <span id="pas-node-version-${realIndex}" class="version-badge node"><img src="assets/node.png" alt="Node.js" /><span class="version-text">...</span></span>
              <span id="pas-angular-version-${realIndex}" class="version-badge angular"><img src="assets/angular.png" alt="Angular" /><span class="version-text">...</span></span>
              ${project.gitBranch ? `<span id="pas-branch-${realIndex}" style="background: #007bff; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;"><img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${project.gitBranch}</span>` : ''}
              ${project.pendingCommits && project.pendingCommits > 0 ? `<span id="pas-commits-${realIndex}" style="background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer;" title="Clique para atualizar branch" onclick="handleUpdateBranch(${realIndex}, '${project.name}', \`${project.path.replace(/\\/g, '\\\\')}\`, false)">‚Üì ${project.pendingCommits}</span>` : ''}
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 5px;">
            <img id="btn-editor-${realIndex}" src="${getCurrentIDEIcon()}" class="editor-icon" style="${!project.path ? 'display: none' : ''}" title="Abrir projeto no ${currentIDE.name}" alt="Editor" onclick="openProjectInEditor('${realIndex}', false)" />
            <img id="btn-terminal-${realIndex}" src="${getTerminalIcon()}" style="width: 24px; height: 24px; cursor: pointer; ${!project.path ? 'display: none' : ''}" title="Abrir terminal na pasta do projeto" alt="Terminal" />
          </div>
        </div>
        <div class="input-with-folder" style="margin-bottom: 10px;">
          <input id="input-${realIndex}" type="text" value="${project.path}" placeholder="Insira o caminho do projeto" />
          <img id="folder-icon-${realIndex}" src="pasta.png" class="folder-icon" title="Procurar projeto existente" alt="Procurar pasta" />
        </div>
        <button id="btn-download-${realIndex}" style="margin-right: 10px; ${project.path ? 'display: none' : ''}">Baixar Projeto</button>
        <button id="btn-start-${realIndex}" data-index="${realIndex}" style="margin-right: 10px;" ${!project.path ? 'disabled' : ''}>Iniciar</button>
        <span id="port-${realIndex}" style="display: none; margin-right: 10px; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: default;"></span>
        <button id="btn-cancel-${realIndex}" style="display: none; margin-right: 10px; background-color: #dc3545; color: white;" title="Cancelar inicializa√ß√£o">‚úï Cancelar</button>
        <button id="btn-stop-${realIndex}" style="display: none;">Parar</button>
        <button id="btn-move-${realIndex}" data-index="${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #5a6c7d; color: white;">Mover para...</button>
        <button id="btn-delete-${realIndex}" data-index="${realIndex}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #8b5a5a; color: white;">Deletar</button>
        <div id="log-${realIndex}" style="display: none; background: #000; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; font-family: monospace; border-radius: 5px; margin-top: 10px;">
        </div>
    `;
    container.appendChild(div);

    const input = document.getElementById(`input-${realIndex}`);
    const downloadButton = document.getElementById(`btn-download-${realIndex}`);
    const folderIcon = document.getElementById(`folder-icon-${realIndex}`);
    const startButton = document.getElementById(`btn-start-${realIndex}`);
    const cancelButton = document.getElementById(`btn-cancel-${realIndex}`);
    const stopButton = document.getElementById(`btn-stop-${realIndex}`);
    const terminalButton = document.getElementById(`btn-terminal-${realIndex}`);
    const editorButton = document.getElementById(`btn-editor-${realIndex}`);
    const moveButton = document.getElementById(`btn-move-${realIndex}`);
    const deleteButton = document.getElementById(`btn-delete-${realIndex}`);
    const logDiv = document.getElementById(`log-${realIndex}`);
  
    // Event listeners para projetos PAS
    input.addEventListener('blur', () => {
      ipcRenderer.send('update-project-path', { index: realIndex, path: input.value });
      if (input.value.trim()) {
          downloadButton.style.display = 'none';
          startButton.disabled = false;
          moveButton.style.display = 'inline-block';
          deleteButton.style.display = 'inline-block';
          editorButton.style.display = 'inline-block';
          terminalButton.style.display = 'inline-block';
      }else {
        deleteButton.style.display = 'none';
        moveButton.style.display = 'none';
        downloadButton.style.display = 'inline-block';
        editorButton.style.display = 'none';
        terminalButton.style.display = 'none';
      }
    });
  
    downloadButton.addEventListener('click', () => {
      downloadButton.disabled = true;
      downloadButton.innerText = 'Baixando...';
      ipcRenderer.send('download-project', { name: project.name, index: realIndex });
    });

    folderIcon.addEventListener('click', () => {
      ipcRenderer.send('browse-project-folder', { index: realIndex, projectName: project.name });
    });
  
    startButton.addEventListener('click', (event) => {
      // Limpa o console antes de iniciar
      const logDiv = document.getElementById(`log-${realIndex}`);
      if (logDiv) {
        logDiv.innerText = ''; // Zera os logs antigos
        logDiv.style.display = 'none'; // Esconde at√© aparecer novos logs
      }
      
      startButton.disabled = true;
      startButton.innerText = 'Executando...';
      cancelButton.style.display = 'inline-block';
      const deleteButton = document.getElementById(`btn-delete-${event.currentTarget.getAttribute('data-index')}`);
      if (deleteButton) deleteButton.disabled = true;      
      ipcRenderer.send('start-project', { projectPath: input.value, port: project.port });
    });
  
    cancelButton.addEventListener('click', () => {
      ipcRenderer.send('cancel-project-startup', { projectPath: input.value, isPamp: false, index: realIndex });
      
      startButton.disabled = false;
      startButton.innerText = 'Iniciar';
      cancelButton.style.display = 'none';
      const deleteButton = document.getElementById(`btn-delete-${realIndex}`);
      if (deleteButton) deleteButton.disabled = false;
    });

    terminalButton.addEventListener('click', () => {
      if (input.value.trim()) {
        terminalButton.style.opacity = '0.5';
        terminalButton.style.pointerEvents = 'none';
        terminalButton.title = 'Abrindo terminal...';
        
        ipcRenderer.send('open-terminal', { projectPath: input.value });
        
        setTimeout(() => {
          terminalButton.style.opacity = '1';
          terminalButton.style.pointerEvents = 'auto';
          terminalButton.title = 'Abrir terminal na pasta do projeto';
        }, 5000);
      } else {
        alert('Projeto precisa ter um caminho v√°lido para abrir o terminal.');
      }
    });
  
    stopButton.addEventListener('click', () => {
      ipcRenderer.send('stop-project', { projectPath: input.value, port: project.port });
    });

    moveButton.addEventListener('click', () => {
      if (input.value.trim()) {
        if (startButton.innerText === 'Rodando ‚úì') {
          alert('N√£o √© poss√≠vel mover o projeto enquanto ele estiver rodando. Pare o projeto primeiro.');
          return;
        }
        
        moveButton.disabled = true;
        moveButton.innerText = 'Movendo...';
        ipcRenderer.send('move-project', { 
          index: realIndex, 
          currentPath: input.value, 
          projectName: project.name 
        });
      } else {
        alert('Projeto precisa ter um caminho v√°lido para ser movido.');
      }
    });

    deleteButton.addEventListener('click', () => {
      if (confirm(`Tem certeza que deseja deletar o projeto ${project.name}?`)) {
        deleteButton.disabled = true;
        ipcRenderer.send('delete-project', { index: realIndex, path: input.value });
      }
    });
    
    });

    // ===== ATUALIZA CONTADORES DOS BOT√ïES TOGGLE AP√ìS CARREGAMENTO =====
    // Aguarda um pequeno delay para garantir que todos os elementos foram renderizados
    setTimeout(() => {
      // Atualiza contador PAMP (Painel Admin)
      const pampCount = document.getElementById('pamp-mfes').querySelectorAll('.project-card').length;
      const pampCountElement = document.getElementById('pamp-count');
      if (pampCountElement) {
        pampCountElement.textContent = pampCount.toString();
      }
      
      // Atualiza contador PAS (Site Principal)  
      const pasCount = document.getElementById('projects').querySelectorAll('.project-card').length;
      const pasCountElement = document.getElementById('pas-count');
      if (pasCountElement) {
        pasCountElement.textContent = pasCount.toString();
      }
      
      console.log(`üìä Contadores atualizados ap√≥s carregamento completo: PAMP Admin=${pampCount}, PAS Site=${pasCount}`);
      
      // Atualiza os √≠cones de terminal ap√≥s carregar projetos
      updateTerminalIcons();
      
      // ‚ö° DISPARA VERIFICA√á√ÉO GIT EM SEGUNDO PLANO ‚ö°
      console.log('[GIT-BG] üöÄ Disparando verifica√ß√£o Git em segundo plano...');
      ipcRenderer.send('start-background-git-check');
      
      // ‚ö° ATUALIZA BADGES DE VERS√ÉO (Node.js e Angular CLI) ‚ö°
      console.log('[VERSION-BADGES] üîÑ Atualizando badges de vers√£o dos projetos...');
      updateAllProjectVersionBadges();
    }, 200);
  });

  // ===== LISTENER PARA ATUALIZA√á√ïES GIT EM SEGUNDO PLANO =====
  ipcRenderer.on('git-status-updated', (event, { projectIndex, gitStatus }) => {
    console.log(`[GIT-BG] üì® RECEBIDA MENSAGEM IPC para projeto ${projectIndex}:`, gitStatus);
    
    if (!gitStatus || projectIndex < 0 || projectIndex >= currentProjects.length) {
      console.log(`[GIT-BG] ‚ùå Dados inv√°lidos para atualiza√ß√£o, ignorando:`, { 
        gitStatusExists: !!gitStatus,
        projectIndex,
        currentProjectsLength: currentProjects.length 
      });
      return;
    }
    
    const project = currentProjects[projectIndex];
    console.log(`[GIT-BG] üìã Processando projeto: ${project.name}`);
    
    // Atualiza os dados do projeto na mem√≥ria
    currentProjects[projectIndex] = {
      ...currentProjects[projectIndex],
      gitBranch: gitStatus.branch,
      pendingCommits: gitStatus.pendingCommits,
      hasUpdates: gitStatus.hasUpdates
    };
    
    const isPamp = project.name && project.name.startsWith('mp-pamp');
    console.log(`[GIT-BG] üè∑Ô∏è Projeto tipo: ${isPamp ? 'PAMP' : 'PAS'}`);
    
    // Atualiza a interface da branch - CORRIGIDO OS IDs
    const branchElementId = isPamp ? `pamp-branch-${projectIndex}` : `pas-branch-${projectIndex}`;
    let branchElement = document.getElementById(branchElementId);
    
    if (gitStatus.branch) {
      // Se o elemento de branch n√£o existe, cria dentro do container
      if (!branchElement) {
        const badgesContainerId = isPamp ? `pamp-version-badges-${projectIndex}` : `pas-version-badges-${projectIndex}`;
        const badgesContainer = document.getElementById(badgesContainerId);
        if (badgesContainer) {
          const branchSpan = document.createElement('span');
          branchSpan.id = branchElementId;
          const branchColor = isPamp ? '#28a745' : '#007bff';
          branchSpan.style.cssText = `background: ${branchColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;`;
          badgesContainer.appendChild(branchSpan);
          branchElement = branchSpan;
          console.log(`[GIT-BG] üÜï Badge de branch criado para ${project.name}`);
        }
      }
      
      if (branchElement) {
        branchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${gitStatus.branch}`;
        console.log(`[GIT-BG] ‚úÖ Branch atualizada para ${project.name}: ${gitStatus.branch}`);
      } else {
        console.log(`[GIT-BG] ‚ö†Ô∏è Elemento branch n√£o encontrado: ${branchElementId}`);
      }
    }
    
    // Atualiza o badge de commits pendentes - CORRIGIDO OS IDs
    const commitsElementId = isPamp ? `pamp-commits-${projectIndex}` : `pas-commits-${projectIndex}`;
    let commitsElement = document.getElementById(commitsElementId);
    console.log(`[GIT-BG] üîç Procurando elemento commits: ${commitsElementId}`, { existe: !!commitsElement });
    
    if (gitStatus.pendingCommits > 0) {
      console.log(`[GIT-BG] üìä ${gitStatus.pendingCommits} commits pendentes - criando/atualizando badge`);
      // Se n√£o existe o elemento, cria dentro do container de badges
      if (!commitsElement) {
        const badgesContainerId = isPamp ? `pamp-version-badges-${projectIndex}` : `pas-version-badges-${projectIndex}`;
        const badgesContainer = document.getElementById(badgesContainerId);
        if (badgesContainer) {
          const commitsSpan = document.createElement('span');
          commitsSpan.id = commitsElementId;
          commitsSpan.style.cssText = 'background: #ff6b35; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px; cursor: pointer;';
          commitsSpan.title = 'Clique para atualizar branch';
          commitsSpan.onclick = () => handleUpdateBranch(projectIndex, project.name, project.path, isPamp);
          badgesContainer.appendChild(commitsSpan);
          commitsElement = commitsSpan;
          console.log(`[GIT-BG] üÜï Badge de commits criado para ${project.name}`);
        } else {
          console.log(`[GIT-BG] ‚ùå N√£o foi poss√≠vel criar badge - container n√£o encontrado`);
        }
      }
      
      if (commitsElement) {
        commitsElement.innerHTML = `‚Üì ${gitStatus.pendingCommits}`;
        commitsElement.style.display = 'flex';
        commitsElement.style.background = '#ff6b35';
        commitsElement.style.cursor = 'pointer';
        commitsElement.title = 'Clique para atualizar branch';
        commitsElement.onclick = () => handleUpdateBranch(projectIndex, project.name, project.path, isPamp);
        console.log(`[GIT-BG] ‚úÖ Badge de commits atualizado para ${project.name}: ${gitStatus.pendingCommits} commits pendentes`);
      }
    } else {
      console.log(`[GIT-BG] ‚úÖ 0 commits pendentes - mostrando badge "Atualizado"`);
      // Mostra "Atualizado" quando n√£o h√° commits pendentes
      if (!commitsElement) {
        const badgesContainerId = isPamp ? `pamp-version-badges-${projectIndex}` : `pas-version-badges-${projectIndex}`;
        const badgesContainer = document.getElementById(badgesContainerId);
        if (badgesContainer) {
          const commitsSpan = document.createElement('span');
          commitsSpan.id = commitsElementId;
          commitsSpan.style.cssText = 'background: #28a745; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;';
          badgesContainer.appendChild(commitsSpan);
          commitsElement = commitsSpan;
          console.log(`[GIT-BG] üÜï Badge "Atualizado" criado para ${project.name}`);
        } else {
          console.log(`[GIT-BG] ‚ùå N√£o foi poss√≠vel criar badge "Atualizado" - container n√£o encontrado`);
        }
      }
      
      if (commitsElement) {
        commitsElement.innerHTML = '‚úì Atualizado';
        commitsElement.style.display = 'flex';
        commitsElement.style.background = '#28a745';
        commitsElement.style.cursor = 'default';
        commitsElement.title = 'Projeto est√° atualizado';
        commitsElement.onclick = null;
        console.log(`[GIT-BG] ‚úÖ Badge "Atualizado" mostrado para ${project.name} (0 commits pendentes)`);
      }
    }
    
    // Atualiza contadores se necess√°rio
    updateProjectCounters();
  });

  // ===== ATUALIZA√á√ÉO INICIAL DOS CONTADORES (REMOVIDA - AGORA FEITA AP√ìS CARREGAMENTO) =====
  // A atualiza√ß√£o dos contadores agora √© feita no final do handler 'projects-loaded'
  // para garantir que todos os dados Git estejam processados

  // ===== FUN√á√ïES DE ONBOARDING =====
  
  /**
   * Carrega projetos de onboarding
   */
  async function loadOnboardingProjects() {
    console.log('[ONBOARDING] üì° Carregando projetos de onboarding...');
    try {
      const result = await ipcRenderer.invoke('load-onboarding-projects');
      console.log('[ONBOARDING] üì¶ Resultado recebido:', result);
      
      if (result.success) {
        currentOnboardingProjects = result.projects;
        console.log('[ONBOARDING] ‚úÖ Projetos carregados:', result.projects);
        
        // Busca vers√µes Java para projetos Java
        for (const project of currentOnboardingProjects) {
          if (project.type === 'java') {
            console.log(`[ONBOARDING] üîç Buscando vers√£o Java para ${project.name}...`);
            try {
              const javaResult = await ipcRenderer.invoke('get-onboarding-java-version', {
                projectName: project.name
              });
              if (javaResult.success && javaResult.javaVersion) {
                project.javaVersion = javaResult.javaVersion;
                console.log(`[ONBOARDING] ‚úÖ Vers√£o Java encontrada: ${javaResult.javaVersion}`);
              }
            } catch (error) {
              console.warn(`[ONBOARDING] ‚ö†Ô∏è Erro ao buscar vers√£o Java para ${project.name}:`, error);
            }
          }
        }
        
        // Renderiza projetos diretamente no container
        renderOnboardingProjects(currentOnboardingProjects);
        
        // Atualiza contador
        const onboardingCount = currentOnboardingProjects.length;
        const countElement = document.getElementById('onboarding-count');
        if (countElement) {
          countElement.textContent = onboardingCount.toString();
          console.log('[ONBOARDING] üî¢ Contador atualizado para:', onboardingCount);
        }
      } else {
        console.error('[ONBOARDING] ‚ùå Erro ao carregar projetos onboarding:', result.error);
      }
    } catch (error) {
      console.error('[ONBOARDING] ‚ùå Erro ao carregar projetos onboarding:', error);
    }
  }

  /**
   * Renderiza projetos de onboarding seguindo o padr√£o PAS/PAMP
   */
  function renderOnboardingProjects(projects) {
    const onboardingContainer = document.getElementById('onboarding-content');
    onboardingContainer.innerHTML = '';

    projects.forEach((project, index) => {
      const div = document.createElement('div');
      div.className = "project-card";
      
      // HTML para o √≠cone Java e vers√£o (se for Java)
      let javaIconHtml = '';
      if (project.type === 'java') {
        const javaVersion = project.javaVersion || project.defaultJavaVersion || '';
        const versionText = javaVersion ? ` ${javaVersion}` : '';
        javaIconHtml = `
          <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 8px;">
            <img src="assets/java.png" style="width: 20px; height: 20px;" title="Java Backend" alt="Java" />
            <span style="font-size: 12px; font-weight: bold; color: #666;">Java${versionText}</span>
          </div>
        `;
      }
      
      div.innerHTML = `
          ${javaIconHtml}
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <p style="margin: 0;"><strong>${project.name}</strong></p>
              <span class="toggle-versions-btn" onclick="toggleOnboardingVersionBadges(${index})" title="Mostrar/Esconder badges">‚Ä∫</span>
              <div class="version-badges-container" id="onb-version-badges-${index}">
                <span id="onb-react-version-${index}" class="version-badge" style="background: #61dafb; color: #000;">
                  <span class="version-text">${project.type.toUpperCase()}</span>
                </span>
                <span id="onb-port-badge-${index}" class="version-badge" style="background: #28a745; color: white;">
                  <span class="version-text">Port: ${project.port}</span>
                </span>
                ${project.isRunning ? 
                  sharedServices.createStatusBadge('üöÄ Rodando', '#007bff') : 
                  ''
                }
              </div>
            </div>
            <div style="display: flex; align-items: center; gap: 5px;">
              <img id="onb-btn-editor-${index}" src="${sharedServices.getCurrentIDEIcon(currentIDE)}" class="editor-icon" 
                   style="${!project.path ? 'display: none' : ''}" 
                   title="Abrir projeto no ${currentIDE.name}" 
                   alt="Editor" 
                   onclick="openOnboardingProjectInEditor(${index})" />
              <img id="onb-btn-terminal-${index}" src="${sharedServices.getTerminalIcon()}" 
                   style="width: 24px; height: 24px; cursor: pointer; ${!project.path ? 'display: none' : ''}" 
                   title="Abrir terminal na pasta do projeto" 
                   alt="Terminal" />
            </div>
          </div>
          
          <div class="input-with-folder" style="margin-bottom: 10px;">
            <input id="onb-input-${index}" type="text" value="${project.path || ''}" placeholder="Insira o caminho do projeto" />
            <img id="onb-folder-icon-${index}" src="pasta.png" class="folder-icon" title="Procurar projeto existente" alt="Procurar pasta" />
          </div>
          
          <button id="onb-btn-download-${index}" style="margin-right: 10px; ${project.path ? 'display: none' : ''}">üì• Clonar Projeto</button>
          <button id="onb-btn-install-${index}" style="margin-right: 10px; ${(!project.path || project.isInstalled) ? 'display: none' : ''}">üì¶ Instalar</button>
          <button id="onb-btn-start-${index}" style="margin-right: 10px;" ${(!project.path || !project.isInstalled) ? 'disabled' : ''}>Iniciar</button>
          <span id="onb-port-${index}" style="display: none; margin-right: 10px; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer;" 
                onclick="openOnboardingProject(${index})" 
                title="Clique para abrir no navegador"></span>
          <button id="onb-btn-cancel-${index}" style="display: none; margin-right: 10px; background-color: #dc3545; color: white;" title="Cancelar inicializa√ß√£o">‚úï Cancelar</button>
          <button id="onb-btn-stop-${index}" style="display: none;">Parar</button>
          <button id="onb-btn-move-${index}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #5a6c7d; color: white;">Mover para...</button>
          <button id="onb-btn-delete-${index}" style="margin-right: 10px; ${!project.path ? 'display: none' : ''}; background-color: #8b5a5a; color: white;">Deletar</button>
          
          <div id="onb-log-${index}" style="display: none; background: #000; color: #0f0; padding: 10px; height: 150px; overflow-y: auto; font-family: monospace; border-radius: 5px; margin-top: 10px;"></div>
      `;
      onboardingContainer.appendChild(div);

      // Adiciona event listeners
      setupOnboardingEventListeners(project, index);
    });

    // Atualiza interface baseado no status (ap√≥s todos os projetos renderizados)
    updateOnboardingProjectUI();
  }

  /**
   * Configura event listeners para projetos onboarding
   */
  function setupOnboardingEventListeners(project, index) {
    const onbInput = document.getElementById(`onb-input-${index}`);
    const onbDownloadButton = document.getElementById(`onb-btn-download-${index}`);
    const onbInstallButton = document.getElementById(`onb-btn-install-${index}`);
    const onbFolderIcon = document.getElementById(`onb-folder-icon-${index}`);
    const onbStartButton = document.getElementById(`onb-btn-start-${index}`);
    const onbStopButton = document.getElementById(`onb-btn-stop-${index}`);
    const onbCancelButton = document.getElementById(`onb-btn-cancel-${index}`);
    const onbMoveButton = document.getElementById(`onb-btn-move-${index}`);
    const onbDeleteButton = document.getElementById(`onb-btn-delete-${index}`);

    // Input blur
    onbInput.addEventListener('blur', () => {
      handleOnboardingPathChange(project, index, onbInput.value.trim());
    });

    // Bot√µes
    onbDownloadButton.addEventListener('click', () => cloneOnboardingProject(project.name, index));
    onbInstallButton.addEventListener('click', () => installOnboardingDependencies(project.name, index));
    onbFolderIcon.addEventListener('click', () => selectOnboardingFolder(index));
    
    // Bot√£o Mover para... (reutilizando l√≥gica do PAS)
    onbMoveButton.addEventListener('click', () => {
      if (onbInput.value.trim()) {
        if (onbStartButton.innerText === 'Rodando ‚úì' || currentOnboardingProjects[index].isRunning) {
          alert('N√£o √© poss√≠vel mover o projeto enquanto ele estiver rodando. Pare o projeto primeiro.');
          return;
        }
        
        onbMoveButton.disabled = true;
        onbMoveButton.innerText = 'Movendo...';
        ipcRenderer.send('move-onboarding-project', { 
          index: index, 
          projectName: project.name,
          currentPath: onbInput.value.trim()
        });
      } else {
        alert('Projeto precisa ter um caminho v√°lido para ser movido.');
      }
    });

    // Bot√£o Deletar (reutilizando l√≥gica do PAS)
    onbDeleteButton.addEventListener('click', () => {
      if (confirm(`Tem certeza que deseja deletar o projeto ${project.name}?`)) {
        onbDeleteButton.disabled = true;
        ipcRenderer.send('delete-onboarding-project', { 
          index: index, 
          projectName: project.name,
          path: onbInput.value.trim() 
        });
      }
    });
    
    // Bot√£o Iniciar (igual ao PAS)
    onbStartButton.addEventListener('click', (event) => {
      console.log(`[ONBOARDING] üñ±Ô∏è Clique em Iniciar projeto ${project.name}`);
      onbStartButton.disabled = true;
      onbStartButton.innerText = 'Executando...';
      onbCancelButton.style.display = 'inline-block'; // Mostra bot√£o cancelar
      
      // Desabilita outros bot√µes durante execu√ß√£o
      const onbDeleteButton = document.getElementById(`onb-btn-delete-${index}`);
      const onbMoveButton = document.getElementById(`onb-btn-move-${index}`);
      if (onbDeleteButton) onbDeleteButton.disabled = true;
      if (onbMoveButton) onbMoveButton.disabled = true;
      
      startOnboardingProject(project.name, index);
    });
    
    // Bot√£o Cancelar (igual ao PAS)
    onbCancelButton.addEventListener('click', () => {
      console.log(`[ONBOARDING] üõë Clique em Cancelar projeto ${project.name}`);
      
      // Cancela o processo de inicializa√ß√£o com a porta
      ipcRenderer.send('cancel-onboarding-project', { 
        projectName: project.name, 
        index: index,
        port: project.port
      });
      
      // Restaura o estado dos bot√µes imediatamente
      onbStartButton.disabled = false;
      onbStartButton.innerText = 'Iniciar';
      onbCancelButton.style.display = 'none';
      
      const onbDeleteButton = document.getElementById(`onb-btn-delete-${index}`);
      const onbMoveButton = document.getElementById(`onb-btn-move-${index}`);
      if (onbDeleteButton) onbDeleteButton.disabled = false;
      if (onbMoveButton) onbMoveButton.disabled = false;
    });
    
    onbStopButton.addEventListener('click', () => stopOnboardingProject(project.name, index));
    
    // Bot√£o Terminal (reutilizando l√≥gica do PAS)
    const onbTerminalButton = document.getElementById(`onb-btn-terminal-${index}`);
    if (onbTerminalButton) {
      onbTerminalButton.addEventListener('click', () => {
        const projectPath = onbInput.value.trim();
        if (projectPath) {
          console.log(`[ONBOARDING] üñ•Ô∏è Abrindo terminal para: ${projectPath}`);
          ipcRenderer.send('open-terminal', { projectPath: projectPath });
        } else {
          alert('Projeto precisa ter um caminho v√°lido para abrir o terminal.');
        }
      });
    }
  }

  /**
   * Gerencia mudan√ßa de caminho do projeto (com controle de estado)
   */
  async function handleOnboardingPathChange(project, index, path) {
    const elements = {
      download: document.getElementById(`onb-btn-download-${index}`),
      install: document.getElementById(`onb-btn-install-${index}`),
      move: document.getElementById(`onb-btn-move-${index}`),
      delete: document.getElementById(`onb-btn-delete-${index}`),
      editor: document.getElementById(`onb-btn-editor-${index}`),
      terminal: document.getElementById(`onb-btn-terminal-${index}`)
    };

    if (path) {
      elements.download.style.display = 'none';
      elements.editor.style.display = 'inline-block';
      elements.terminal.style.display = 'inline-block';
      
      // Mover e deletar s√≥ aparecem se o projeto n√£o estiver rodando
      const isRunning = currentOnboardingProjects[index]?.isRunning;
      if (!isRunning) {
        elements.move.style.display = 'inline-block';
        elements.delete.style.display = 'inline-block';
      } else {
        elements.move.style.display = 'none';
        elements.delete.style.display = 'none';
      }
      
      // Atualiza caminho no backend
      await ipcRenderer.invoke('set-onboarding-project-path', {
        projectName: project.name,
        projectPath: path
      });
      
      // Recarrega projetos
      loadOnboardingProjects();
    } else {
      elements.delete.style.display = 'none';
      elements.move.style.display = 'none';
      elements.download.style.display = 'inline-block';
      elements.editor.style.display = 'none';
      elements.terminal.style.display = 'none';
    }
  }

  /**
   * Atualiza interface do projeto baseado no status (igual ao PAS)
   */
  function updateOnboardingProjectUI() {
    currentOnboardingProjects.forEach((project, index) => {
      const startButton = document.getElementById(`onb-btn-start-${index}`);
      const stopButton = document.getElementById(`onb-btn-stop-${index}`);
      const cancelButton = document.getElementById(`onb-btn-cancel-${index}`);
      const moveButton = document.getElementById(`onb-btn-move-${index}`);
      const deleteButton = document.getElementById(`onb-btn-delete-${index}`);
      const portSpan = document.getElementById(`onb-port-${index}`);

      if (project.isRunning) {
        // Projeto rodando: mostra bot√£o parar, esconde iniciar e cancelar
        if (startButton) startButton.style.display = 'none';
        if (stopButton) stopButton.style.display = 'inline-block';
        if (cancelButton) cancelButton.style.display = 'none';
        
        // Esconde mover e deletar quando rodando
        if (moveButton) moveButton.style.display = 'none';
        if (deleteButton) deleteButton.style.display = 'none';
        
        // Mostra porta ativa
        if (portSpan) {
          portSpan.style.display = 'inline-block';
          portSpan.style.background = '#28a745';
          portSpan.style.color = 'white';
          portSpan.innerText = `:${project.port} üîó`;
        }
      } else {
        // Projeto parado: mostra bot√£o iniciar, esconde parar e cancelar
        if (startButton) {
          startButton.style.display = 'inline-block';
          startButton.disabled = false;
          startButton.innerText = 'Iniciar';
        }
        if (stopButton) stopButton.style.display = 'none';
        if (cancelButton) cancelButton.style.display = 'none';
        
        // Mostra mover e deletar quando parado (se tem caminho)
        if (project.path || project.persistedPath) {
          if (moveButton) moveButton.style.display = 'inline-block';
          if (deleteButton) deleteButton.style.display = 'inline-block';
        }
        
        // Esconde porta
        if (portSpan) {
          portSpan.style.display = 'none';
        }
      }
    });
  }

  /**
   * Atualiza IDE no m√≥dulo onboarding
   */
  function updateOnboardingIDE() {
    // Como agora √© tudo no mesmo documento, n√£o precisa de postMessage
    console.log('[ONBOARDING] ‚úÖ IDE atualizada para:', currentIDE.name);
  }

  /**
   * Atualiza IDE no m√≥dulo onboarding
   */
  function updateOnboardingIDE() {
    const iframe = document.getElementById('onboarding-iframe');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage({
        type: 'update-ide',
        ide: currentIDE
      }, '*');
    }
  }

  // IPC Listeners globais
  
  // Listener espec√≠fico para este projeto PAMP
  ipcRenderer.on('pamp-log', (event, { path, message, index, name, error, nodeVersionError, isImportant }) => {
    const pampLogDiv = document.getElementById(`pamp-log-${index}`);
    
    if (!message || !message.trim()) {
      return;
    }
    
    // ‚ö° NOVA L√ìGICA INTELIGENTE PARA REBUILDS E ERROS ‚ö°
    const lowerMessage = message.toLowerCase();
    
    // Detecta mensagens de download (SEMPRE mostrar)
    const isDownloadMessage = 
      lowerMessage.includes('fazendo download') ||
      lowerMessage.includes('baixando') ||
      lowerMessage.includes('clonando') ||
      lowerMessage.includes('cloning') ||
      lowerMessage.includes('j√° existe em') ||
      lowerMessage.includes('projeto baixado') ||
      lowerMessage.includes('dispon√≠vel em') ||
      lowerMessage.includes('erro ao clonar') ||
      lowerMessage.includes('erro ao criar diret√≥rio');
    
    // Detecta rebuilds e recompila√ß√µes
    const isRebuildMessage = 
      lowerMessage.includes('file change detected') ||
      lowerMessage.includes('rebuilding') ||
      lowerMessage.includes('recompiling') ||
      lowerMessage.includes('compilation started') ||
      lowerMessage.includes('webpack building') ||
      lowerMessage.includes('webpack compilation started') ||
      lowerMessage.includes('compiling') ||
      lowerMessage.includes('building') ||
      lowerMessage.includes('bundle generation') ||
      lowerMessage.includes('chunk ') ||
      lowerMessage.includes('emitted') ||
      lowerMessage.includes('hash:') ||
      lowerMessage.includes('time:') ||
      lowerMessage.includes('built at:');
    
    // Detecta compila√ß√£o completa
    const isCompilationComplete = 
      lowerMessage.includes('compiled successfully') ||
      lowerMessage.includes('compilation complete') ||
      lowerMessage.includes('webpack compiled') ||
      lowerMessage.includes('build complete') ||
      lowerMessage.includes('‚àö compiled successfully') ||
      lowerMessage.includes('‚úì compiled successfully') ||
      lowerMessage.includes('webpack: compiled successfully') ||
      lowerMessage.includes('compiled with') ||
      lowerMessage.includes('warnings but no errors') ||
      (lowerMessage.includes('compiled') && lowerMessage.includes('ms'));
    
    // Detecta warnings (N√ÉO devem ser tratados como erros cr√≠ticos)
    const isWarning = 
      lowerMessage.includes('warn') ||
      lowerMessage.includes('warning') ||
      lowerMessage.includes('processing legacy') ||
      lowerMessage.includes('view engine') ||
      lowerMessage.includes('encourage the library authors to publish an ivy distribution');
    
    // Detecta erros de compila√ß√£o (EXCETO warnings)
    const isCompilationError = 
      !isWarning && (
        lowerMessage.includes('compilation error') ||
        lowerMessage.includes('build error') ||
        lowerMessage.includes('typescript error') ||
        lowerMessage.includes('webpack error') ||
        lowerMessage.includes('failed to compile') ||
        lowerMessage.includes('compilation failed') ||
        lowerMessage.includes('build failed') ||
        (lowerMessage.includes('compiled with') && lowerMessage.includes('error'))
      );
    
    // Trata `error` do IPC: se √© warning, ignora o flag de erro
    const isTrueError = error === true && !isWarning;
    
    // üêõ DEBUG: Log para entender o que est√° acontecendo
    if (error === true) {
      console.log(`üêõ [DEBUG] error=true recebido | message="${message}" | isWarning=${isWarning} | isTrueError=${isTrueError}`);
    }

    // ‚ö° SEMPRE EXIBE DOWNLOADS, REBUILDS, ERROS E MENSAGENS IMPORTANTES ‚ö°
    let shouldShow = isDownloadMessage || isImportant || isRebuildMessage || isCompilationComplete || isCompilationError || isTrueError || isWarning;
    
    // Para outras mensagens, verifica duplica√ß√£o
    if (!shouldShow && pampLogDiv) {
      const currentText = pampLogDiv.innerText;
      const lines = currentText.split('\n');
      const lastLine = lines[lines.length - 1];
      
      // S√≥ ignora mensagens duplicadas que N√ÉO s√£o rebuilds, compila√ß√µes ou erros
      if (lastLine === message && 
          !message.includes('npm install') &&
          !isRebuildMessage &&
          !isCompilationComplete &&
          !isCompilationError) {
        return;
      }
      shouldShow = true;
    }

    if (!shouldShow) return;

    console.log(`üìù [PAMP-LOG] ${isImportant ? '[IMPORTANTE] ' : ''}${error ? '[ERRO] ' : ''}${message}`);
    
    if (pampLogDiv) {
      pampLogDiv.style.display = 'block';
      
      // ‚ö° FORMATA√á√ÉO ESPECIAL PARA DIFERENTES TIPOS DE MENSAGEM ‚ö°
      let formattedMessage = message;
      
      if (isWarning) {
        // Warnings n√£o recebem √≠cone de erro, apenas mostra a mensagem
        formattedMessage = message;
      } else if (isRebuildMessage) {
        formattedMessage = `üîÑ [REBUILD] ${message}`;
      } else if (isCompilationComplete) {
        formattedMessage = `‚úÖ [SUCESSO] ${message}`;
      } else if (isCompilationError || isTrueError) {
        formattedMessage = `‚ùå [ERRO] ${message}`;
      } else if (isImportant) {
        formattedMessage = `‚ö° [IMPORTANTE] ${message}`;
      }
      
      pampLogDiv.innerText += `\n${formattedMessage}`;
      pampLogDiv.scrollTop = pampLogDiv.scrollHeight;
      
      // Detecta quando download termina (sucesso ou erro) e reabilita bot√£o
      const isDownloadComplete = 
        message.includes('Projeto baixado com sucesso') ||
        message.includes('j√° existe em') ||
        message.includes('Erro ao clonar o reposit√≥rio') ||
        message.includes('Erro ao criar diret√≥rio');
      
      if (isDownloadComplete) {
        const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
        if (pampDownloadButton) {
          pampDownloadButton.disabled = false;
          pampDownloadButton.innerText = 'Baixar';
        }
      }
      
      // REMOVIDO: L√≥gica duplicada que causava conflito com update-project
      // O evento update-project agora cuida de atualizar tudo corretamente
      
      // S√≥ mostra aviso de erro se a mensagem foi marcada explicitamente como erro
      if (data.error && message.includes('terminou com c√≥digo') && message.includes('1')) {
        const nodeVersionSpan = document.getElementById('node-version');
        const currentNodeVersion = nodeVersionSpan.innerText.replace('Node.js: ', '');
        
        let warningMessage;

        if (currentNodeVersion === 'v16.10.0') {
          warningMessage = `\n\n‚ö†Ô∏è AVISO: O projeto apresentou erro de compila√ß√£o. 
          Verifique seu c√≥digo fonte por poss√≠veis problemas como:
          ‚Ä¢ Depend√™ncias incompat√≠veis
          ‚Ä¢ Erros de sintaxe
          ‚Ä¢ Problemas de configura√ß√£o
          ‚Ä¢ Comandos de shell n√£o dispon√≠veis (como 'sed')`;
        } else {
          warningMessage = `\n\n‚ö†Ô∏è AVISO: O erro acima pode ser causado pela vers√£o incompat√≠vel do Node.js (${currentNodeVersion}).
          Projetos PAMP requerem Node.js v16.10.0. Por favor, instale a vers√£o correta para evitar erros de sintaxe.`;
        }
        
        if (pampLogDiv) {
          pampLogDiv.style.display = 'block';
          pampLogDiv.innerHTML += `<div style="color: yellow; margin-top: 10px; border-top: 1px solid #444; padding-top: 10px;">${warningMessage}</div>`;
          pampLogDiv.scrollTop = pampLogDiv.scrollHeight;
        }
      }
      
      if (message.includes('Caminho do projeto:') || message.includes('Projeto baixado')) {
        const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
        if (pampDownloadButton) pampDownloadButton.style.display = 'none';
      }
    } else {
      console.error(`Elemento log n√£o encontrado para √≠ndice ${index}`);
    }
  });
  
  // Listener para atualiza√ß√µes de status de projetos
  ipcRenderer.on('status-update', (event, { path, status, isPamp, index }) => {
    console.log(`*** FRONTEND STATUS UPDATE: path=${path}, status=${status}, isPamp=${isPamp}, index=${index}`);
    
    if (isPamp) {
      // Tratamento para projetos PAMP
      const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
      const pampCancelButton = document.getElementById(`pamp-btn-cancel-${index}`);
      const pampStopButton = document.getElementById(`pamp-btn-stop-${index}`);
      const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
      const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
      const pampFolderIcon = document.getElementById(`pamp-folder-icon-${index}`);
      
      console.log(`Atualizando status do projeto PAMP ${index} para ${status}`);
      
      if (status === 'running') {
        if (pampStartButton) {
          pampStartButton.innerText = 'Rodando ‚úì';
          pampStartButton.disabled = true;
          pampStartButton.style.backgroundColor = 'green';
          pampStartButton.style.color = 'white';
        }
        if (pampCancelButton) pampCancelButton.style.display = 'none';
        if (pampMoveButton) pampMoveButton.style.display = 'none';
        if (pampDeleteButton) pampDeleteButton.style.display = 'none';
        if (pampStopButton) pampStopButton.style.display = 'inline-block';
        if (pampFolderIcon) pampFolderIcon.classList.add('disabled');
      } else if (status === 'stopping') {
        if (pampStopButton) {
          pampStopButton.innerText = 'Parando...';
          pampStopButton.disabled = true;
        }
        if (pampMoveButton) pampMoveButton.disabled = true;
        if (pampDeleteButton) pampDeleteButton.disabled = true;
        if (pampFolderIcon) pampFolderIcon.classList.add('disabled');
      } else if (status === 'stopped') {
        if (pampStartButton) {
          pampStartButton.innerText = 'Iniciar';
          pampStartButton.disabled = false;
          pampStartButton.style.backgroundColor = '';
          pampStartButton.style.color = '';
        }
        if (pampCancelButton) pampCancelButton.style.display = 'none';
        if (pampStopButton) {
          pampStopButton.style.display = 'none';
          pampStopButton.disabled = false;
          pampStopButton.innerText = 'Parar';
        }
        if (pampMoveButton) {
          pampMoveButton.style.display = 'inline-block';
          pampMoveButton.disabled = false;
        }
        if (pampDeleteButton) {
          pampDeleteButton.style.display = 'inline-block';
          pampDeleteButton.disabled = false;
        }
        if (pampFolderIcon) pampFolderIcon.classList.remove('disabled');
      }
    } else {
      // Tratamento para projetos PAS
      let projectIndex = index;
      if (projectIndex === undefined || projectIndex === null) {
        projectIndex = currentProjects.findIndex((project) => project.path === path);
      }
      
      if (projectIndex !== -1) {
        const startButton = document.getElementById(`btn-start-${projectIndex}`);
        const cancelButton = document.getElementById(`btn-cancel-${projectIndex}`);
        const stopButton = document.getElementById(`btn-stop-${projectIndex}`);
        const moveButton = document.getElementById(`btn-move-${projectIndex}`);
        const deleteButton = document.getElementById(`btn-delete-${projectIndex}`);

        if (status === 'running') {
          if (startButton) {
            startButton.innerText = 'Rodando ‚úì';
            startButton.disabled = true;
            startButton.style.backgroundColor = 'green';
            startButton.style.color = 'white';
          }
          if (cancelButton) cancelButton.style.display = 'none';
          if (moveButton) moveButton.style.display = 'none';
          if (deleteButton) deleteButton.style.display = 'none';
          if (stopButton) stopButton.style.display = 'inline-block';
        } else if (status === 'stopping') {
          if (stopButton) {
            stopButton.innerText = 'Parando...';
            stopButton.disabled = true;
          }
          if (moveButton) moveButton.disabled = true;
          if (deleteButton) deleteButton.disabled = true;
        } else if (status === 'stopped') {
          if (startButton) {
            startButton.innerText = 'Iniciar';
            startButton.disabled = false;
            startButton.style.backgroundColor = '';
            startButton.style.color = 'black';
          }
          if (cancelButton) cancelButton.style.display = 'none';
          if (stopButton) {
            stopButton.style.display = 'none';
            stopButton.disabled = false;
            stopButton.innerText = 'Parar';
          }
          if (moveButton) {
            moveButton.style.display = 'inline-block';
            moveButton.disabled = false;
          }
          if (deleteButton) {
            deleteButton.style.display = 'inline-block';
            deleteButton.disabled = false;
          }
        }
      }
    }
  });

  // Outros listeners IPC necess√°rios
  
  ipcRenderer.on('delete-project-log', (event, { path, message, success, index }) => {
    let console = document.getElementById(`pamp-log-${index}`);
    if (!console) {
      console = document.getElementById(`log-${index}`);
    }
    
    if (console && message) {
      console.style.display = 'block';
      console.innerText += `\n${message}`;
      console.scrollTop = console.scrollHeight;
    }
    
    if(message && message.includes('pode encontrar o arquivo especificado')) {
      const deleteBtn = document.getElementById(`pamp-btn-delete-${index}`) || document.getElementById(`btn-delete-${index}`);
      const folderIcon = document.getElementById(`pamp-folder-icon-${index}`) || document.getElementById(`folder-icon-${index}`);
      if (deleteBtn) deleteBtn.disabled = false;
      if (folderIcon) folderIcon.classList.remove('disabled');
      return;
    }
    
     if (success) {
      const deleteBtn = document.getElementById(`pamp-btn-delete-${index}`) || document.getElementById(`btn-delete-${index}`);
      const moveBtn = document.getElementById(`pamp-btn-move-${index}`) || document.getElementById(`btn-move-${index}`);
      const downloadBtn = document.getElementById(`pamp-btn-download-${index}`) || document.getElementById(`btn-download-${index}`);
      const startBtn = document.getElementById(`pamp-btn-start-${index}`) || document.getElementById(`btn-start-${index}`);
      const stopBtn = document.getElementById(`pamp-btn-stop-${index}`) || document.getElementById(`btn-stop-${index}`);
      const input = document.getElementById(`pamp-input-${index}`) || document.getElementById(`input-${index}`);
      const folderIcon = document.getElementById(`pamp-folder-icon-${index}`) || document.getElementById(`folder-icon-${index}`);
      
      if (deleteBtn) deleteBtn.style.display = 'none';
      if (moveBtn) moveBtn.style.display = 'none';
      if (downloadBtn) downloadBtn.style.display = 'inline-block';
      if (startBtn) {
        startBtn.style.display = 'inline-block';
        startBtn.disabled = true;
      }
      if (stopBtn) stopBtn.style.display = 'none';
      if (input) {
        input.value = '';
      }
      if (folderIcon) folderIcon.classList.remove('disabled');
      
      setTimeout(() => {
        if (console) {
          console.innerText = '';
          console.style.display = 'none';
        }
      }, 2000);
    } else {
      // Em caso de erro, reabilita o bot√£o e o √≠cone da pasta
      const deleteBtn = document.getElementById(`pamp-btn-delete-${index}`) || document.getElementById(`btn-delete-${index}`);
      const folderIcon = document.getElementById(`pamp-folder-icon-${index}`) || document.getElementById(`folder-icon-${index}`);
      if (deleteBtn) deleteBtn.disabled = false;
      if (folderIcon) folderIcon.classList.remove('disabled');
    }
    });

  // Listeners para o processo de mover projetos
  ipcRenderer.on('move-project-log', (event, { index, message, success }) => {
    const pampLogDiv = document.getElementById(`pamp-log-${index}`);
    const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
    const logDiv = document.getElementById(`log-${index}`);
    const moveButton = document.getElementById(`btn-move-${index}`);
    
    if (pampLogDiv && pampMoveButton) {
      pampLogDiv.style.display = 'block';
      pampLogDiv.innerText += `\n${message}`;
      pampLogDiv.scrollTop = pampLogDiv.scrollHeight;
      
      pampMoveButton.disabled = false;
      pampMoveButton.innerText = 'Mover para...';
    } else if (logDiv && moveButton) {
      logDiv.style.display = 'block';
      logDiv.innerText += `\n${message}`;
      logDiv.scrollTop = logDiv.scrollHeight;
      
      moveButton.disabled = false;
      moveButton.innerText = 'Mover para...';
    }
  });

  ipcRenderer.on('update-project-path', (event, { index, path }) => {
    const project = currentProjects[index];
    const isPampProject = project && project.name && project.name.startsWith('mp-pamp');
    
    if (isPampProject) {
      const pampInput = document.getElementById(`pamp-input-${index}`);
      if (pampInput) {
        pampInput.value = path;
      } else {
        console.error(`Input PAMP n√£o encontrado para √≠ndice ${index}`);
      }
    } else {
      const input = document.getElementById(`input-${index}`);
      if (input) {
        input.value = path;
      } else {
        console.error(`Input PAS n√£o encontrado para √≠ndice ${index}`);
      }
    }
  });

  // Listeners para logs dos handlers de onboarding
  ipcRenderer.on('move-onboarding-project-log', (event, { index, message, success }) => {
    let console = document.getElementById(`onb-log-${index}`);
    
    if (console && message) {
      console.style.display = 'block';
      console.innerText += `\n${message}`;
      console.scrollTop = console.scrollHeight;
    }
    
    if (success) {
      const moveButton = document.getElementById(`onb-btn-move-${index}`);
      if (moveButton) {
        moveButton.disabled = false;
        moveButton.innerText = 'Mover para...';
      }
    }
  });

  ipcRenderer.on('delete-onboarding-project-log', (event, { path, message, success, index }) => {
    let console = document.getElementById(`onb-log-${index}`);
    
    if (console && message) {
      console.style.display = 'block';
      console.innerText += `\n${message}`;
      console.scrollTop = console.scrollHeight;
    }
    
    if (success) {
      const deleteBtn = document.getElementById(`onb-btn-delete-${index}`);
      if (deleteBtn) {
        deleteBtn.disabled = false;
        deleteBtn.innerText = 'Deletar';
      }
    }
  });

  ipcRenderer.on('update-onboarding-project-path', (event, { index, path }) => {
    const onbInput = document.getElementById(`onb-input-${index}`);
    if (onbInput) {
      onbInput.value = path;
    } else {
      console.error(`Input Onboarding n√£o encontrado para √≠ndice ${index}`);
    }
  });

  ipcRenderer.on('show-console', (event, { path, index, isPamp }) => {
    if (isPamp) {
      const pampLogDiv = document.getElementById(`pamp-log-${index}`);
      if (pampLogDiv) {
        pampLogDiv.style.display = 'block';
      }
    } else {
      const projectIndex = currentProjects.findIndex((project) => project.path === path);
      if (projectIndex !== -1) {
        const logDiv = document.getElementById(`log-${projectIndex}`);
        if (logDiv) {
          logDiv.style.display = 'block';
        }
      }
    }
  });

  // ===== NOVA FUN√á√ÉO PARA ATUALIZAR STATUS BADGE =====
  function updateNexusStatusBadge(isLoggedIn, message = '') {
    const statusBadge = document.getElementById('nexus-status-badge');
    const statusIcon = statusBadge.querySelector('.status-icon');
    const statusText = statusBadge.querySelector('.status-text');
    
    // Remove classes anteriores
    statusBadge.classList.remove('logged-in', 'logged-out', 'unknown');
    
    if (isLoggedIn === true) {
      statusBadge.classList.add('logged-in');
      statusText.textContent = 'Nexus Conectado';
      statusBadge.title = 'Logado com sucesso no Nexus';
    } else if (isLoggedIn === false) {
      statusBadge.classList.add('logged-out');
      statusText.textContent = 'Nexus Desconectado';
      statusBadge.title = 'N√£o logado no Nexus';
    } else {
      statusBadge.classList.add('unknown');
      statusText.textContent = 'Verificando Nexus...';
      statusBadge.title = 'Verificando status do Nexus';
    }
    
    // Adiciona detalhes extras se houver mensagem
    if (message) {
      statusBadge.title += ` - ${message}`;
    }
  }

  // Atualiza o status de login - VERS√ÉO MELHORADA
  ipcRenderer.on('log', (event, { message, path, error, isImportant }) => {
      // Atualiza sistema antigo para compatibilidade
      const statusDiv = document.getElementById('status');
      if (message.includes('Logado no Nexus com sucesso')) {
        statusDiv.innerText = 'Logado no Nexus ‚úì';
        statusDiv.style.background = 'green';
        // Atualiza novo sistema
        updateNexusStatusBadge(true, 'Login realizado com sucesso');
      } else if (message.includes('Erro no login')) {
        statusDiv.innerText = 'Erro no login ‚úó';
        statusDiv.style.background = 'red';
        // Atualiza novo sistema
        updateNexusStatusBadge(false, 'Erro no login');
      }
      
      // ‚ö° NOVA L√ìGICA MELHORADA PARA LOGS DE PROJETOS PAS ‚ö°
      const lowerMessage = message.toLowerCase();
      
      // Detecta mensagens de download (SEMPRE mostrar)
      const isDownloadMessage = 
        lowerMessage.includes('fazendo download') ||
        lowerMessage.includes('baixando') ||
        lowerMessage.includes('clonando') ||
        lowerMessage.includes('cloning') ||
        lowerMessage.includes('j√° existe em') ||
        lowerMessage.includes('projeto baixado') ||
        lowerMessage.includes('dispon√≠vel em') ||
        lowerMessage.includes('erro ao clonar') ||
        lowerMessage.includes('erro ao criar diret√≥rio');
      
      // Detecta rebuilds e recompila√ß√µes
      const isRebuildMessage = 
        lowerMessage.includes('file change detected') ||
        lowerMessage.includes('rebuilding') ||
        lowerMessage.includes('recompiling') ||
        lowerMessage.includes('compilation started') ||
        lowerMessage.includes('webpack building') ||
        lowerMessage.includes('webpack compilation started') ||
        lowerMessage.includes('compiling') ||
        lowerMessage.includes('building') ||
        lowerMessage.includes('bundle generation') ||
        lowerMessage.includes('chunk ') ||
        lowerMessage.includes('emitted') ||
        lowerMessage.includes('hash:') ||
        lowerMessage.includes('time:') ||
        lowerMessage.includes('built at:');
      
      // Detecta compila√ß√£o completa
      const isCompilationComplete = 
        lowerMessage.includes('compiled successfully') ||
        lowerMessage.includes('compilation complete') ||
        lowerMessage.includes('webpack compiled') ||
        lowerMessage.includes('build complete') ||
        lowerMessage.includes('‚àö compiled successfully') ||
        lowerMessage.includes('‚úì compiled successfully') ||
        lowerMessage.includes('webpack: compiled successfully') ||
        lowerMessage.includes('compiled with') ||
        lowerMessage.includes('warnings but no errors') ||
        (lowerMessage.includes('compiled') && lowerMessage.includes('ms'));
      
      // Detecta warnings (N√ÉO devem ser tratados como erros cr√≠ticos)
      const isWarning = 
        lowerMessage.includes('warn') ||
        lowerMessage.includes('warning') ||
        lowerMessage.includes('processing legacy') ||
        lowerMessage.includes('view engine') ||
        lowerMessage.includes('encourage the library authors to publish an ivy distribution');
      
      // Detecta erros de compila√ß√£o (EXCETO warnings)
      const isCompilationError = 
        !isWarning && (
          lowerMessage.includes('compilation error') ||
          lowerMessage.includes('build error') ||
          lowerMessage.includes('typescript error') ||
          lowerMessage.includes('webpack error') ||
          lowerMessage.includes('failed to compile') ||
          lowerMessage.includes('compilation failed') ||
          lowerMessage.includes('build failed') ||
          (lowerMessage.includes('compiled with') && lowerMessage.includes('error'))
        );
      
      // Trata `error` do IPC: se √© warning, ignora o flag de erro
      const isTrueError = error === true && !isWarning;
      
      // üêõ DEBUG: Log para entender o que est√° acontecendo
      if (error === true) {
        console.log(`üêõ [DEBUG-PAS] error=true recebido | message="${message}" | isWarning=${isWarning} | isTrueError=${isTrueError}`);
      }
      
      // Log messages para projetos espec√≠ficos
      currentProjects.forEach((project, index) => {
        if (project.path === path || message.includes(project.name)) {
            const logDiv = document.getElementById(`log-${index}`);
            if (logDiv) {
              // ‚ö° SEMPRE EXIBE DOWNLOADS, REBUILDS, ERROS E MENSAGENS IMPORTANTES ‚ö°
              let shouldShow = isDownloadMessage || isImportant || isRebuildMessage || isCompilationComplete || isCompilationError || isTrueError || isWarning;
              
              // Para outras mensagens, verifica duplica√ß√£o
              if (!shouldShow) {
                const currentText = logDiv.innerText;
                const lines = currentText.split('\n');
                const lastLine = lines[lines.length - 1];
                
                // S√≥ ignora mensagens duplicadas que N√ÉO s√£o rebuilds, compila√ß√µes ou erros
                if (lastLine === message && 
                    !isRebuildMessage &&
                    !isCompilationComplete &&
                    !isCompilationError) {
                  return;
                }
                shouldShow = true;
              }

              if (!shouldShow) return;

              console.log(`üìù [PAS-LOG] ${isImportant ? '[IMPORTANTE] ' : ''}${error ? '[ERRO] ' : ''}${message}`);
              
              logDiv.style.display = 'block';
              
              // ‚ö° FORMATA√á√ÉO ESPECIAL PARA DIFERENTES TIPOS DE MENSAGEM ‚ö°
              let formattedMessage = message;
              
              if (isWarning) {
                // Warnings n√£o recebem √≠cone de erro, apenas mostra a mensagem
                formattedMessage = message;
              } else if (isRebuildMessage) {
                formattedMessage = `üîÑ [REBUILD] ${message}`;
              } else if (isCompilationComplete) {
                formattedMessage = `‚úÖ [SUCESSO] ${message}`;
              } else if (isCompilationError || isTrueError) {
                formattedMessage = `‚ùå [ERRO] ${message}`;
              } else if (isImportant) {
                formattedMessage = `‚ö° [IMPORTANTE] ${message}`;
              }
              
              logDiv.innerText += `\n${formattedMessage}`;
              logDiv.scrollTop = logDiv.scrollHeight;

              // Detecta quando download termina (sucesso ou erro) e reabilita bot√£o
              const isDownloadComplete = 
                message.includes('Projeto baixado com sucesso') ||
                message.includes('j√° existe em') ||
                message.includes('Erro ao clonar o reposit√≥rio') ||
                message.includes('Erro ao criar diret√≥rio');
              
              if (isDownloadComplete) {
                const downloadButton = document.getElementById(`btn-download-${index}`);
                if (downloadButton) {
                  downloadButton.disabled = false;
                  downloadButton.innerText = 'Baixar';
                }
              }

              if (message.includes('Caminho do projeto:')) {
                  const downloadButton = document.getElementById(`btn-download-${index}`);
                  if (downloadButton) downloadButton.style.display = 'none';
              }
            }
        }
      });
  });

  ipcRenderer.send('load-login-state');

  ipcRenderer.on('login-state', (event, isLoggedIn) => {
    // Atualiza sistema antigo para compatibilidade
    const statusDiv = document.getElementById('status');
    const pinterStatusDiv = document.getElementById('pinter-status');
    pinterStatusDiv.style.background = isLoggedIn ? 'green' : 'red';
    if (isLoggedIn) {
      statusDiv.innerText = 'Logado no Nexus ‚úì';
    } else {
      statusDiv.innerText = 'N√£o logado';
    }
    
    // Atualiza novo sistema de badge
    updateNexusStatusBadge(isLoggedIn, isLoggedIn ? 'Conectado automaticamente' : 'Necess√°rio fazer login');
  });

  // Solicita status das depend√™ncias Node.js port√°til
  ipcRenderer.send('check-dependencies-status');
  
  ipcRenderer.on('dependencies-status', (event, { installed, message, nodesPath }) => {
    const dependenciesStatusSpan = document.getElementById('dependencies-status');

    if (installed) {
      // ‚úÖ Depend√™ncias instaladas - Verde com tooltip e link
      dependenciesStatusSpan.innerHTML = `
        <span class="dependencies-container" style="position: relative; display: inline-block;">
          <span 
            class="dependencies-text"
            style="color: #4CAF50; font-weight: 500; cursor: help;"
            title="Node.js port√°til instalado localmente. Cada projeto usa sua vers√£o configurada."
          >
            ‚úîÔ∏è Depend√™ncias instaladas
          </span>
          <a 
            href="#" 
            class="open-folder-link"
            onclick="require('electron').ipcRenderer.send('open-nodes-folder', '${nodesPath.replace(/\\/g, '\\\\')}'); return false;" 
            style="
              position: absolute;
              right: -110px;
              top: 50%;
              transform: translateY(-50%);
              color: #0066cc;
              text-decoration: none;
              font-size: 11px;
              white-space: nowrap;
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              background: rgba(0, 0, 0, 0.7);
              padding: 2px 6px;
              border-radius: 4px;
            "
            title="Abrir pasta das depend√™ncias Node.js port√°teis"
          >
            üìÅ Abrir pasta
          </a>
        </span>
      `;
      
      // Mostra link ao passar o mouse
      const container = dependenciesStatusSpan.querySelector('.dependencies-container');
      const link = container.querySelector('.open-folder-link');
      
      // Mant√©m vis√≠vel quando o mouse est√° sobre o link
      let hideTimeout;
      const hideLink = () => {
        hideTimeout = setTimeout(() => {
          link.style.opacity = '0';
          link.style.pointerEvents = 'none';
        }, 100);
      };
      
      const cancelHide = () => {
        if (hideTimeout) clearTimeout(hideTimeout);
      };
      
      container.addEventListener('mouseenter', () => {
        cancelHide();
        link.style.opacity = '1';
        link.style.pointerEvents = 'auto';
      });
      
      container.addEventListener('mouseleave', hideLink);
      link.addEventListener('mouseenter', cancelHide);
      link.addEventListener('mouseleave', hideLink);
      
    } else {
      // ‚ùó Depend√™ncias n√£o instaladas - Vermelho com tooltip e link
      dependenciesStatusSpan.innerHTML = `
        <span class="dependencies-container" style="position: relative; display: inline-block;">
          <span 
            class="dependencies-text"
            style="color: #f44336; font-weight: 500; cursor: help;"
            title="Node.js port√°til n√£o instalado. Use o menu 'Depend√™ncias > Instalar Depend√™ncias Node.js' para instalar."
          >
            ‚ùó Depend√™ncias n√£o instaladas
          </span>
          <a 
            href="#" 
            class="open-folder-link"
            onclick="require('electron').ipcRenderer.send('open-nodes-folder', '${nodesPath.replace(/\\/g, '\\\\')}'); return false;" 
            style="
              position: absolute;
              right: -110px;
              top: 50%;
              transform: translateY(-50%);
              color: #0066cc;
              text-decoration: none;
              font-size: 11px;
              white-space: nowrap;
              opacity: 0;
              pointer-events: none;
              transition: opacity 0.2s ease;
              background: rgba(0, 0, 0, 0.7);
              padding: 2px 6px;
              border-radius: 4px;
            "
            title="Abrir pasta onde as depend√™ncias devem ser instaladas"
          >
            üìÅ Abrir pasta
          </a>
        </span>
      `;
      
      // Mostra link ao passar o mouse
      const container = dependenciesStatusSpan.querySelector('.dependencies-container');
      const link = container.querySelector('.open-folder-link');
      
      // Mant√©m vis√≠vel quando o mouse est√° sobre o link
      let hideTimeout;
      const hideLink = () => {
        hideTimeout = setTimeout(() => {
          link.style.opacity = '0';
          link.style.pointerEvents = 'none';
        }, 100);
      };
      
      const cancelHide = () => {
        if (hideTimeout) clearTimeout(hideTimeout);
      };
      
      container.addEventListener('mouseenter', () => {
        cancelHide();
        link.style.opacity = '1';
        link.style.pointerEvents = 'auto';
      });
      
      container.addEventListener('mouseleave', hideLink);
      link.addEventListener('mouseenter', cancelHide);
      link.addEventListener('mouseleave', hideLink);
    }
  });

  // Outros handlers IPC necess√°rios
  ipcRenderer.on('update-project', (event, { index, path }) => {
    console.log(`üîÑ [UPDATE-PROJECT] Recebido: index=${index}, path="${path}"`);
    
    const project = currentProjects[index];
    console.log(`üîç [UPDATE-PROJECT] Projeto encontrado:`, project);
    
    const isPampProject = project && project.name && project.name.startsWith('mp-pamp');
    console.log(`üîç [UPDATE-PROJECT] √â projeto PAMP? ${isPampProject}`);
    
    // Se path est√° vazio, √© uma dele√ß√£o - limpa tudo
    const isDeleting = !path || path.trim() === '';
    console.log(`üîç [UPDATE-PROJECT] √â dele√ß√£o? ${isDeleting}`);
    
    if(isPampProject) {
      const pampInput = document.getElementById(`pamp-input-${index}`);
      const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
      const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
      const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
      const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
      const pampFolderIcon = document.getElementById(`pamp-folder-icon-${index}`);
      
      console.log(`üîç [UPDATE-PROJECT PAMP] Elementos encontrados:`, {
        input: !!pampInput,
        move: !!pampMoveButton,
        delete: !!pampDeleteButton,
        download: !!pampDownloadButton,
        start: !!pampStartButton,
        folder: !!pampFolderIcon
      });
  
      if (pampInput) {
        console.log(`‚úÖ [UPDATE-PROJECT PAMP] Atualizando input com: "${path}"`);
        pampInput.value = path;
        pampInput.disabled = false;
      } else {
        console.error(`‚ùå [UPDATE-PROJECT PAMP] Input n√£o encontrado: pamp-input-${index}`);
      }
      
      if (isDeleting) {
        // Dele√ß√£o: mostra bot√£o de download, esconde move/delete
        if (pampMoveButton) pampMoveButton.style.display = 'none';
        if (pampDeleteButton) pampDeleteButton.style.display = 'none';
        if (pampDownloadButton) {
          pampDownloadButton.style.display = 'inline-block';
          pampDownloadButton.disabled = false;
          pampDownloadButton.innerText = 'Baixar';
        }
        if (pampStartButton) pampStartButton.disabled = true;
        if (pampFolderIcon) pampFolderIcon.classList.remove('disabled');
      } else {
        // Download/Atualiza√ß√£o: esconde bot√£o de download, mostra move/delete, habilita start
        if (pampMoveButton) pampMoveButton.style.display = 'inline-block';
        if (pampDeleteButton) pampDeleteButton.style.display = 'inline-block';
        if (pampDownloadButton) {
          pampDownloadButton.style.display = 'none';
        }
        if (pampStartButton) pampStartButton.disabled = false;
        if (pampFolderIcon) pampFolderIcon.classList.remove('disabled');
      }
    } else {
      const input = document.getElementById(`input-${index}`);
      const moveButton = document.getElementById(`btn-move-${index}`);
      const deleteButton = document.getElementById(`btn-delete-${index}`);
      const browseButton = document.getElementById(`btn-browse-${index}`);
      const downloadButton = document.getElementById(`btn-download-${index}`);
      const startButton = document.getElementById(`btn-start-${index}`);
      
      console.log(`üîç [UPDATE-PROJECT PAS] Elementos encontrados:`, {
        input: !!input,
        move: !!moveButton,
        delete: !!deleteButton,
        browse: !!browseButton,
        download: !!downloadButton,
        start: !!startButton
      });
    
      if (input) {
        console.log(`‚úÖ [UPDATE-PROJECT PAS] Atualizando input com: "${path}"`);
        input.value = path;
        input.disabled = false;
      } else {
        console.error(`‚ùå [UPDATE-PROJECT PAS] Input n√£o encontrado: input-${index}`);
      }
      
      if (isDeleting) {
        // Dele√ß√£o: mostra bot√£o de download, esconde move/delete
        if (moveButton) moveButton.style.display = 'none';
        if (deleteButton) deleteButton.style.display = 'none';
        if (browseButton) browseButton.style.display = 'inline-block';
        if (downloadButton) {
          downloadButton.style.display = 'inline-block';
          downloadButton.disabled = false;
          downloadButton.innerText = 'Baixar';
        }
        if (startButton) startButton.disabled = true;
      } else {
        // Download/Atualiza√ß√£o: esconde bot√£o de download, mostra move/delete, habilita start
        if (moveButton) moveButton.style.display = 'inline-block';
        if (deleteButton) deleteButton.style.display = 'inline-block';
        if (browseButton) browseButton.style.display = 'inline-block';
        if (downloadButton) {
          downloadButton.style.display = 'none';
        }
        if (startButton) startButton.disabled = false;
      }
    }
  });
  
  ipcRenderer.on('pamp-process-error', (event, { path, index }) => {
    console.log(`Projeto PAMP com erro, resetando bot√µes para √≠ndice ${index}`);
    const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
    const pampCancelButton = document.getElementById(`pamp-btn-cancel-${index}`);
    const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
    const pampFolderIcon = document.getElementById(`pamp-folder-icon-${index}`);
    
    if (pampStartButton) {
      pampStartButton.disabled = false;
      pampStartButton.innerText = 'Iniciar';
    }
    
    if (pampCancelButton) {
      pampCancelButton.style.display = 'none';
    }
    
    if (pampDeleteButton) {
      pampDeleteButton.disabled = false;
      pampDeleteButton.style.display = 'inline-block';
    }
    
    if (pampFolderIcon) {
      pampFolderIcon.classList.remove('disabled');
    }
  });
  
  ipcRenderer.on('process-error', (event, { path }) => {
    const projectIndex = currentProjects.findIndex(p => p.path === path);
    if (projectIndex !== -1) {
      const startButton = document.getElementById(`btn-start-${projectIndex}`);
      const cancelButton = document.getElementById(`btn-cancel-${projectIndex}`);
      const deleteButton = document.getElementById(`btn-delete-${projectIndex}`);
      
      if (startButton) {
        startButton.disabled = false;
        startButton.innerText = 'Iniciar';
        startButton.style.backgroundColor = '';
        startButton.style.color = 'black';
      }
      
      if (cancelButton) {
        cancelButton.style.display = 'none';
      }
      
      if (deleteButton) {
        deleteButton.disabled = false;
        deleteButton.style.display = 'inline-block';
      }
    }
  });

  ipcRenderer.on('project-path-selected', (event, { index, path, projectName }) => {
    console.log(`Recebida resposta do browse: projeto ${projectName}, √≠ndice ${index}, caminho ${path}`);
    
    const pampInput = document.getElementById(`pamp-input-${index}`);
    const pasInput = document.getElementById(`input-${index}`);
    
    if (pampInput) {
      pampInput.value = path;
      
      const pampDownloadButton = document.getElementById(`pamp-btn-download-${index}`);
      const pampStartButton = document.getElementById(`pamp-btn-start-${index}`);
      const pampMoveButton = document.getElementById(`pamp-btn-move-${index}`);
      const pampDeleteButton = document.getElementById(`pamp-btn-delete-${index}`);
      
      if (pampDownloadButton) pampDownloadButton.style.display = 'none';
      if (pampStartButton) pampStartButton.disabled = false;
      if (pampMoveButton) pampMoveButton.style.display = 'inline-block';
      if (pampDeleteButton) pampDeleteButton.style.display = 'inline-block';
    }
    
    if (pasInput) {
      pasInput.value = path;
      
      const downloadButton = document.getElementById(`btn-download-${index}`);
      const startButton = document.getElementById(`btn-start-${index}`);
      const moveButton = document.getElementById(`btn-move-${index}`);
      const deleteButton = document.getElementById(`btn-delete-${index}`);
      
      if (downloadButton) downloadButton.style.display = 'none';
      if (startButton) startButton.disabled = false;
      if (moveButton) moveButton.style.display = 'inline-block';
      if (deleteButton) deleteButton.style.display = 'inline-block';
    }
    
    ipcRenderer.send('update-project-path', { index: index, path: path });
  });

  // ‚ö° LISTENERS PARA ATUALIZA√á√ÉO DE BRANCHES GIT ‚ö°
  
  // Listener para atualiza√ß√£o de branch enviada do main process quando projeto √© iniciado
  ipcRenderer.on('update-project-branch', (event, { index, branch, path }) => {
    console.log(`üåø [Frontend] Atualizando branch do projeto ${index}: ${branch}`);
    updateProjectBranchDisplay(index, branch, path);
  });

  // Listener para resposta da atualiza√ß√£o manual de branch
  ipcRenderer.on('project-branch-updated', (event, { index, branch, path }) => {
    console.log(`üåø [Frontend] Branch atualizada manualmente para projeto ${index}: ${branch}`);
    updateProjectBranchDisplay(index, branch, path);
  });

  // ‚ö° FUN√á√ÉO PARA ATUALIZAR EXIBI√á√ÉO DA BRANCH ‚ö°
  function updateProjectBranchDisplay(index, branch, path) {
    // Atualiza em projetos PAMP
    const pampBranchElement = document.getElementById(`pamp-branch-${index}`);
    if (pampBranchElement) {
      pampBranchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${branch}`;
      console.log(`üåø Branch PAMP atualizada para √≠ndice ${index}: ${branch}`);
    }

    // Atualiza em projetos PAS
    const pasBranchElement = document.getElementById(`pas-branch-${index}`);
    if (pasBranchElement) {
      pasBranchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${branch}`;
      console.log(`üåø Branch PAS atualizada para √≠ndice ${index}: ${branch}`);
    }

    // Se n√£o existe elemento de branch, cria um novo
    if (!pampBranchElement && !pasBranchElement) {
      const projectCard = document.querySelector(`#pamp-input-${index}, #input-${index}`)?.closest('.project-card');
      if (projectCard) {
        const projectNameContainer = projectCard.querySelector('div > div');
        if (projectNameContainer) {
          // Determina se √© projeto PAMP ou PAS
          const isPamp = !!document.getElementById(`pamp-input-${index}`);
          const branchColor = isPamp ? '#28a745' : '#007bff';
          const branchId = isPamp ? `pamp-branch-${index}` : `pas-branch-${index}`;
          
          // Cria o elemento de branch
          const branchElement = document.createElement('span');
          branchElement.id = branchId;
          branchElement.style.cssText = `background: ${branchColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold; display: flex; align-items: center; gap: 4px;`;
          branchElement.innerHTML = `<img src="branch.png" style="width: 12px; height: 12px;" alt="Branch" />${branch}`;
          
          projectNameContainer.appendChild(branchElement);
          console.log(`üåø Novo elemento de branch criado para √≠ndice ${index}: ${branch}`);
        }
      }
    }

    // Atualiza o array de projetos local
    if (currentProjects[index]) {
      currentProjects[index].gitBranch = branch;
    }
  }

  // ===== FUN√á√ÉO PARA ATUALIZAR CONTADORES DOS PROJETOS =====
  function updateProjectCounters() {
    // Conta projetos PAMP
    const pampCount = document.getElementById('pamp-mfes').querySelectorAll('.project-card').length;
    const pampCountElement = document.getElementById('pamp-count');
    if (pampCountElement) {
      pampCountElement.textContent = pampCount.toString();
    }
    
    // Conta projetos PAS
    const pasCount = document.getElementById('projects').querySelectorAll('.project-card').length;
    const pasCountElement = document.getElementById('pas-count');
    if (pasCountElement) {
      pasCountElement.textContent = pasCount.toString();
    }
    
    console.log(`üìä Contadores atualizados: PAMP Admin=${pampCount}, PAS Site=${pasCount}`);
  }

  // ===== FUN√á√ïES PARA GERENCIAR PORTA DOS PROJETOS =====
  function updatePortDisplay(projectIndex, port, status, isPamp) {
    const portElementId = isPamp ? `pamp-port-${projectIndex}` : `port-${projectIndex}`;
    const portElement = document.getElementById(portElementId);
    
    if (!portElement) {
      console.log(`‚ö†Ô∏è Elemento porta n√£o encontrado: ${portElementId}`);
      return;
    }
    
    console.log(`üîå Atualizando porta para projeto ${projectIndex}: porta ${port}, status ${status}, PAMP: ${isPamp}`);
    
    // Remove classes de status anteriores
    portElement.classList.remove('port-starting', 'port-in-use', 'port-running');
    
    if (status === 'starting') {
      // Laranja - projeto iniciando, porta definida mas ainda n√£o dispon√≠vel
      portElement.style.display = 'inline-flex';
      portElement.style.backgroundColor = '#ff8c00';
      portElement.style.color = 'white';
      portElement.textContent = `Porta: ${port}`;
      portElement.style.cursor = 'default';
      portElement.title = 'Projeto iniciando...';
      portElement.onclick = null;
      portElement.classList.add('port-starting');
      
      // Atualiza tooltip com a porta atual (apenas para PAMP)
      updateTooltipWithPort(projectIndex, port, isPamp);
    } else if (status === 'in-use') {
      // Vermelho - porta em uso, tentando liberar
      portElement.style.display = 'inline-flex';
      portElement.style.backgroundColor = '#dc3545';
      portElement.style.color = 'white';
      portElement.textContent = `Porta: ${port}`;
      portElement.style.cursor = 'default';
      portElement.title = 'Porta em uso, tentando liberar...';
      portElement.onclick = null;
      portElement.classList.add('port-in-use');
      
      // Atualiza tooltip com a porta atual (apenas para PAMP)
      updateTooltipWithPort(projectIndex, port, isPamp);
    } else if (status === 'running') {
      // Verde - projeto rodando, porta clic√°vel
      portElement.style.display = 'inline-flex';
      portElement.style.backgroundColor = '#28a745';
      portElement.style.color = 'white';
      portElement.textContent = `Porta: ${port}`;
      portElement.style.cursor = 'pointer';
      portElement.title = 'Clique para abrir no navegador';
      portElement.classList.add('port-running');
      
      // Atualiza tooltip com a porta atual (apenas para PAMP)
      updateTooltipWithPort(projectIndex, port, isPamp);
      
      portElement.onclick = () => {
        // Define a URL base baseada no tipo de projeto
        let baseUrl;
        if (isPamp) {
          // PAMP projects always open on the root port 4200
          baseUrl = 'http://localhost:4200';
        } else {
          // PAS projects open on the PAS root port 9000
          baseUrl = 'http://localhost:9000';
        }
        
        console.log(`üåê Abrindo navegador: ${baseUrl} (projeto ${isPamp ? 'PAMP' : 'PAS'} detectado na porta ${port})`);
        // Send message to main process to open browser
        require('electron').ipcRenderer.send('open-browser', { url: baseUrl });
      };
    }
  }

  function removePortDisplay(projectIndex, isPamp) {
    const portElementId = isPamp ? `pamp-port-${projectIndex}` : `port-${projectIndex}`;
    const portElement = document.getElementById(portElementId);
    
    if (portElement) {
      portElement.style.display = 'none';
      portElement.onclick = null;
      console.log(`üîå Porta removida para projeto ${projectIndex} (${isPamp ? 'PAMP' : 'PAS'})`);
    }
  }

  // ===== LISTENERS IPC PARA PORTA =====
  ipcRenderer.on('port-detected', (event, { projectIndex, port, status, isPamp }) => {
    console.log(`üì° Port detected IPC recebido:`, { projectIndex, port, status, isPamp });
    updatePortDisplay(projectIndex, port, status, isPamp);
  });

  ipcRenderer.on('port-removed', (event, { projectIndex, isPamp }) => {
    console.log(`üì° Port removed IPC recebido:`, { projectIndex, isPamp });
    removePortDisplay(projectIndex, isPamp);
  });

  // Initialize UI after DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    applyTheme();
  });

  // Fun√ß√£o para mostrar/esconder badges de vers√£o
  function toggleVersionBadges(projectIndex, isPamp) {
    const prefix = isPamp ? 'pamp' : 'pas';
    const container = document.getElementById(`${prefix}-version-badges-${projectIndex}`);
    const btn = event.target; // O bot√£o que foi clicado
    
    if (!container) return;
    
    if (container.classList.contains('visible')) {
      // Esconder badges
      container.classList.remove('visible');
      btn.textContent = '‚Ä∫';
      btn.title = 'Mostrar badges';
    } else {
      // Mostrar badges
      container.classList.add('visible');
      btn.textContent = '‚Äπ';
      btn.title = 'Esconder badges';
    }
  }

  // Fun√ß√£o para atualizar badges de vers√£o de um projeto espec√≠fico
  async function updateProjectVersionBadges(projectName, projectIndex, isPamp = false) {
    try {
      // Buscar configura√ß√µes de vers√£o de Node para todos os projetos
      const versionConfigs = await ipcRenderer.invoke('get-all-node-versions');
      
      // Mapeamento de vers√µes Node -> Angular CLI (sincronizado com node-version-config.js)
      const nodeToAngularMap = {
        '16.10.0': '13.3.11',
        '18.18.2': '15.2.10',
        '20.19.5': '18.2.0'
      };

      // Busca a vers√£o configurada para este projeto ou usa padr√£o
      let nodeVersion = versionConfigs[projectName];
      
      // Se n√£o tem configura√ß√£o, busca o padr√£o do projeto
      if (!nodeVersion) {
        // Valores padr√£o baseados no nome do projeto
        if (projectName === 'mp-pas-configuracoes') {
          nodeVersion = '18.18.2';
        } else {
          nodeVersion = '16.10.0';
        }
      }

      const angularVersion = nodeToAngularMap[nodeVersion] || 'N/A';
      
      // Determina o prefixo do ID baseado no tipo de projeto
      const prefix = isPamp ? 'pamp' : 'pas';

      // Atualiza badges do projeto
      const nodeBadge = document.getElementById(`${prefix}-node-version-${projectIndex}`);
      const angularBadge = document.getElementById(`${prefix}-angular-version-${projectIndex}`);

      if (nodeBadge) {
        nodeBadge.querySelector('.version-text').textContent = nodeVersion;
        nodeBadge.title = `Node.js ${nodeVersion}`;
      }

      if (angularBadge) {
        angularBadge.querySelector('.version-text').textContent = angularVersion;
        angularBadge.title = `Angular CLI ${angularVersion}`;
      }

      console.log(`‚úÖ Badges do projeto ${projectName} atualizados: Node ${nodeVersion}, Angular CLI ${angularVersion}`);
    } catch (error) {
      console.error(`‚ùå Erro ao atualizar badges do projeto ${projectName}:`, error);
    }
  }

  // Atualiza todos os badges de vers√£o dos projetos carregados
  async function updateAllProjectVersionBadges() {
    if (!currentProjects || currentProjects.length === 0) {
      console.log('‚ö†Ô∏è Nenhum projeto carregado ainda');
      return;
    }

    console.log('üîÑ Atualizando badges de vers√£o de todos os projetos...');
    
    for (let i = 0; i < currentProjects.length; i++) {
      const project = currentProjects[i];
      const isPamp = project.name && (project.name.startsWith('mp-pamp') || project.name === 'mp-pamp');
      await updateProjectVersionBadges(project.name, i, isPamp);
    }
  }

  // Atualiza badges quando as configura√ß√µes s√£o alteradas
  ipcRenderer.on('node-versions-updated', () => {
    console.log('üîÑ Configura√ß√µes de vers√£o atualizadas, recarregando badges...');
    updateAllProjectVersionBadges();
  });

  // ===== HANDLERS DE EVENTOS ONBOARDING =====
  
  // Handler para progresso de clone
  ipcRenderer.on('onboarding-clone-progress', (event, { projectName, progress }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div>${progress}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para erro de clone
  ipcRenderer.on('onboarding-clone-error', (event, { projectName, error }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div style="color: #ff6b35;">‚ùå ${error}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para progresso de instala√ß√£o
  ipcRenderer.on('onboarding-install-progress', (event, { projectName, progress }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div>${progress}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para erro de instala√ß√£o
  ipcRenderer.on('onboarding-install-error', (event, { projectName, error }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div style="color: #ff6b35;">‚ùå ${error}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para output do projeto
  ipcRenderer.on('onboarding-output', (event, { projectName, output }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div>${output}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para erro do projeto
  ipcRenderer.on('onboarding-error', (event, { projectName, error }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div style="color: #ff6b35;">‚ùå ${error}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para projeto iniciado
  ipcRenderer.on('onboarding-started', (event, { projectName }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      // Atualizar status do projeto
      currentOnboardingProjects[projectIndex].isRunning = true;
      
      // Atualizar UI para mostrar bot√£o de parar
      updateOnboardingProjectUI();
      
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div style="color: #00ff00;">üöÄ Projeto ${projectName} iniciado com sucesso!</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para projeto parado
  ipcRenderer.on('onboarding-stopped', (event, { projectName }) => {
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      // Atualizar status do projeto
      currentOnboardingProjects[projectIndex].isRunning = false;
      
      // Atualizar UI para mostrar bot√£o de iniciar
      updateOnboardingProjectUI();
      
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div style="color: #ff9500;">‚èπÔ∏è Projeto ${projectName} parado!</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para projeto cancelado (igual ao PAS)
  ipcRenderer.on('onboarding-canceled', (event, { projectName, index, message }) => {
    console.log(`[ONBOARDING] üõë Projeto ${projectName} cancelado`);
    
    const projectIndex = currentOnboardingProjects.findIndex(p => p.name === projectName);
    if (projectIndex >= 0) {
      // Atualizar status do projeto
      currentOnboardingProjects[projectIndex].isRunning = false;
      
      // Atualizar UI
      updateOnboardingProjectUI();
      
      const logDiv = document.getElementById(`onb-log-${projectIndex}`);
      if (logDiv) {
        logDiv.innerHTML += `<div style="color: #dc3545;">${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    }
  });

  // Handler para abrir configura√ß√£o do Onboarding Node.js (via menu)
  ipcRenderer.on('open-onboarding-node-config', () => {
    console.log('[ONBOARDING] üìß Recebido comando para abrir configura√ß√£o Node.js');
    
    // Esconde todos os containers
    hideAllContainers();
    
    // Mostra o container do onboarding
    const onboardingContainer = document.getElementById('onboarding-node-config');
    if (onboardingContainer) {
      onboardingContainer.style.display = 'block';
      console.log('[ONBOARDING] ‚úÖ Container onboarding-node-config exibido');
      
      // Carrega a configura√ß√£o do onboarding
      loadOnboardingNodeConfig();
    } else {
      console.error('[ONBOARDING] ‚ùå Container onboarding-node-config n√£o encontrado');
    }
  });
</script>
</body>
</html>